
================================================================================
🧪 UAT阶段2：Supplier发票生成验证
================================================================================
测试时间: 2025-11-12 18:26:10

================================================================================
📋 创建测试数据
================================================================================
✅ 创建Statement ID: 327
✅ 创建 3 笔Supplier交易 + 3 笔手续费

📊 测试交易:
  - 7SL TECH SDN BHD: RM 1000.00 (本金) + RM 10.00 (手续费)
  - DINAS RESTAURANT: RM 500.00 (本金) + RM 5.00 (手续费)
  - PASAR RAYA: RM 300.00 (本金) + RM 3.00 (手续费)

================================================================================
📄 生成Supplier发票
================================================================================

正在生成发票: 7SL TECH SDN BHD
  ✅ 发票编号: INV-327-7SLTECHSDNBHD-20251112
  ✅ 总金额: RM 1010.00
  ✅ 手续费: RM 10.00
  ✅ PDF路径: static/uploads/invoices/INV-327-7SLTECHSDNBHD-20251112.pdf

正在生成发票: DINAS
  ✅ 发票编号: INV-327-DINAS-20251112
  ✅ 总金额: RM 505.00
  ✅ 手续费: RM 5.00
  ✅ PDF路径: static/uploads/invoices/INV-327-DINAS-20251112.pdf

正在生成发票: PASAR
  ✅ 发票编号: INV-327-PASAR-20251112
  ✅ 总金额: RM 303.00
  ✅ 手续费: RM 3.00
  ✅ PDF路径: static/uploads/invoices/INV-327-PASAR-20251112.pdf

✅ 成功生成 3 份发票

================================================================================
🔍 验证数据库supplier_invoices表
================================================================================

📋 数据库记录 (3 条):

ID     Invoice Number                           Supplier                 Amount      Fee
-----------------------------------------------------------------------------------------------
102    INV-327-7SLTECHSDNBHD-20251112           7SL TECH SDN BHD     RM 1010.00 RM 10.00
103    INV-327-DINAS-20251112                   DINAS                RM  505.00 RM  5.00
104    INV-327-PASAR-20251112                   PASAR                RM  303.00 RM  3.00

================================================================================
💰 核对金额计算（本金 + 1%手续费）
================================================================================

Supplier                Principal     Fee (1%)        Total     Status
---------------------------------------------------------------------------
7SL TECH SDN BHD     RM   1000.00 RM     10.00 RM   1010.00 ✅ PASS
DINAS                RM    500.00 RM      5.00 RM    505.00 ✅ PASS
PASAR                RM    300.00 RM      3.00 RM    303.00 ✅ PASS

✅ 通过: 3/3

================================================================================
📁 验证PDF文件生成
================================================================================

Invoice Number                           PDF Path                                                     Status    
-------------------------------------------------------------------------------------------------------------------
INV-327-7SLTECHSDNBHD-20251112           static/uploads/invoices/INV-327-7SLTECHSDNBHD-20251112.pdf   ✅ EXISTS (2634 bytes)
INV-327-DINAS-20251112                   static/uploads/invoices/INV-327-DINAS-20251112.pdf           ✅ EXISTS (2628 bytes)
INV-327-PASAR-20251112                   static/uploads/invoices/INV-327-PASAR-20251112.pdf           ✅ EXISTS (2624 bytes)

✅ 存在: 3/3

================================================================================
📝 审计日志验证（INVOICE_GENERATED）
================================================================================

发票编号                                     操作类型                 描述                                                          
-----------------------------------------------------------------------------------------------------------------------------
INV-327-PASAR-20251112                   INVOICE_GENERATED    Generated invoice INV-327-PASAR-20251112 for PASAR - Total: RM 303.00
INV-327-DINAS-20251112                   INVOICE_GENERATED    Generated invoice INV-327-DINAS-20251112 for DINAS - Total: RM 505.00
INV-327-7SLTECHSDNBHD-20251112           INVOICE_GENERATED    Generated invoice INV-327-7SLTECHSDNBHD-20251112 for 7SL TECH SDN BHD - Total: RM 1010.00

✅ 审计日志: 3/3

================================================================================
📊 UAT阶段2测试报告
================================================================================

✅ 测试通过标准:
  ✅ 发票生成数: PASS (预期:3, 实际:3)
  ✅ 编号格式: PASS (INV-327-供应商-日期)
  ✅ 金额计算: PASS (本金+1%手续费)
  ✅ PDF文件生成: PASS (文件存在)
  ✅ 数据库记录: PASS (supplier_invoices表)
  ✅ 审计日志: PASS (INVOICE_GENERATED)

================================================================================
🎉 UAT阶段2完成 ✅
================================================================================

✅ 所有测试通过！
  - 发票生成: ✅
  - 金额计算: ✅
  - 文件生成: ✅
  - 数据库记录: ✅
  - 审计日志: ✅

================================================================================
🧹 清理测试数据
================================================================================
✅ 已删除:
  - 3 条发票记录
  - 6 条交易记录
  - 1 条Statement记录
  - 3 个PDF文件
  - 3 条审计日志

✅ 清理验证通过：无数据残留
