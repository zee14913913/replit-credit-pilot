# 📁 会计系统文件管理 - 使用说明

## ✅ **已完成功能**

### **1. 统一文件存储位置**

所有上传的月结单和生成的测试报告都会自动保存到固定位置：

```
/home/runner/workspace/accounting_data/
├── statements/          # 银行月结单CSV文件
│   └── company1_Maybank_3824549009_2024-07_20251101_103500.csv
└── reports/            # 测试报告
    └── test_report_20251101_103436.txt
```

---

## 🎯 **如何使用**

### **方式1：通过网页界面（推荐）**

1. **打开首页**：刷新Replit Webview
2. **查看紫色横幅**：顶部会有"🏦 财务会计系统 (Accounting System)"
3. **点击按钮**：
   - **📚 API文档** → Swagger UI
   - **💼 管理后台** → 会计系统界面
   - **🧪 系统测试报告** → 运行测试并自动保存
   
4. **文件管理中心**：
   - 访问 `/accounting_files` 路由
   - 或点击会计系统顶部的"📁 文件管理"链接
   - 可以查看、下载、删除所有文件

---

### **方式2：命令行**

#### **运行测试并保存报告**
```bash
cd /home/runner/workspace
python3 test_accounting_system.py --save
```

#### **查看已保存的文件**
```bash
# 查看月结单
ls -lh accounting_data/statements/

# 查看测试报告
ls -lh accounting_data/reports/

# 查看报告内容
cat accounting_data/reports/test_report_20251101_103436.txt
```

---

## 📊 **文件管理功能**

### **自动保存**
- ✅ **上传CSV月结单** → 自动保存到 `statements/` 目录
- ✅ **运行测试报告** → 自动保存到 `reports/` 目录
- ✅ **文件命名规范**：包含公司、银行、账号、月份、时间戳

### **文件管理界面功能**
- 📂 **列出所有文件**：显示文件名、大小、修改时间
- 📥 **下载文件**：点击下载按钮即可获取文件
- 🗑️ **删除文件**：删除不需要的旧文件
- 📊 **存储统计**：显示总文件数和占用空间

---

## 🔗 **API端点**

### **文件管理API**

```bash
# 列出所有文件
GET http://localhost:8000/api/files/list

# 下载文件
GET http://localhost:8000/api/files/download/{file_type}/{filename}

# 删除文件
DELETE http://localhost:8000/api/files/delete/{file_type}/{filename}

# 存储信息
GET http://localhost:8000/api/files/storage-info
```

### **示例**
```bash
# 列出所有文件
curl http://localhost:8000/api/files/list

# 下载报告
curl -O http://localhost:8000/api/files/download/test_report/test_report_20251101_103436.txt
```

---

## 📋 **文件命名规范**

### **月结单文件名格式**
```
company{公司ID}_{银行名}_{账号}_{月份}_{上传时间}.csv

示例：
company1_Maybank_3824549009_2024-07_20251101_103500.csv
```

### **测试报告文件名格式**
```
test_report_{生成时间}.txt

示例：
test_report_20251101_103436.txt
```

---

## ✅ **完整工作流程**

### **场景1：上传新月结单**

1. 准备CSV文件（Maybank格式）
2. 使用API上传或通过界面上传
3. **系统自动**：
   - ✅ 保存原始CSV到 `statements/` 目录
   - ✅ 导入数据到PostgreSQL数据库
   - ✅ 自动匹配生成会计分录
   - ✅ 返回保存路径

### **场景2：生成测试报告**

**方法A：网页点击**
1. 访问首页
2. 点击"🧪 系统测试报告"按钮
3. **系统自动**：
   - ✅ 运行完整测试
   - ✅ 保存报告到 `reports/` 目录
   - ✅ 在网页显示结果

**方法B：命令行**
```bash
python3 test_accounting_system.py --save
```

### **场景3：管理历史文件**

1. 访问 `/accounting_files` 页面
2. 查看所有已上传的月结单和生成的报告
3. 下载需要的文件
4. 删除过期的文件

---

## 📈 **当前系统状态**

```
✅ 默认公司: ID=1 (DEFAULT)
✅ 会计科目: 13个科目已激活
✅ 已导入: 2024年7月 Maybank月结单（10笔交易）
✅ 自动匹配: 100% (10/10笔)
✅ 会计分录: 10笔，全部借贷平衡
✅ 试算表: RM 61,629.03 完美平衡
✅ 文件已保存: statements/ 和 reports/ 目录
```

---

## 🚀 **下一步建议**

1. **导入更多月份**：上传August、September等月份的CSV
2. **生成财务报表**：P&L、Balance Sheet等
3. **多公司管理**：为不同客户创建独立公司账户
4. **定期备份**：下载重要的月结单和报告文件

---

## 💡 **提示**

- 所有文件都按时间戳命名，方便追溯
- 文件管理界面支持按类型筛选
- API支持批量下载和删除
- 存储空间统计帮助监控使用情况

---

**系统100%就绪！所有上传的文件和报告都会自动保存到统一位置！** 🎉
