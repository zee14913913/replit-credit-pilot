# ä¿¡ç”¨å¡è´¦å•è®¡ç®—è§„åˆ™ä¿®æ­£æŠ¥å‘Š

## ğŸ“Š PDFæ–‡ä»¶è¦æ±‚ vs å½“å‰ç³»ç»Ÿå¯¹æ¯”

ç”Ÿæˆæ—¶é—´: 2025-11-16
å¯¹æ¯”æ–‡ä»¶: attached_assets/è®¡ç®—ç±»åˆ«ä¸éªŒè¯_1763336835757.pdf

---

## âŒ å…³é”®å·®å¼‚ #1: Owner's Paymentè§„åˆ™é”™è¯¯

### PDFè¦æ±‚
```
Owner's Payment =
1. CCè´¦å•CRä»˜æ¬¾è®°å½•æœ‰å®¢æˆ·åå­—
2. æ²¡æœ‰ä»»ä½•ä»˜æ¬¾detailsæ³¨é‡Šçš„æ— åä»˜æ¬¾ â†’ Owner's Payment
```

### å½“å‰ç³»ç»Ÿï¼ˆé”™è¯¯ï¼‰
```python
# services/ledger_classifier.py ç¬¬71-95è¡Œ
def classify_payment(description, customer_id):
    if not description:
        return 'infinite'  # âŒ é”™è¯¯ï¼åº”è¯¥return 'customer'
```

### ä¿®æ­£æ–¹æ¡ˆ
```python
def classify_payment(description, customer_id):
    # æ— åä»˜æ¬¾ï¼ˆç©ºæè¿°ï¼‰â†’ Owner's Payment
    if not description or description.strip() == '':
        return 'customer'  # âœ… ä¿®æ­£ä¸ºOwner
    
    # å…¶ä»–é€»è¾‘ä¿æŒä¸å˜...
```

---

## âŒ å…³é”®å·®å¼‚ #2: GZ BANK LISTå®Œå…¨ç¼ºå¤±

### PDFè¦æ±‚çš„9ä¸ªINFINITE GZé“¶è¡Œè´¦æˆ·

```
1. tan zee liang Gx bank
2. Yeo chee wang Mbb
3. Yeo chee wang Gx bank
4. Yeo chee wang Uob
5. Yeo chee wang Ocbc
6. Teo yok chu & Yeo chee wang è”å ocbc
7. Infinite gz Sdn Bhd HLB
8. Ai smart tech pbb bank
9. Ai smart tech alliance bank
```

### å½“å‰ç³»ç»Ÿ
- âŒ `payer_aliases`è¡¨ä¸­payer_type='infinite'çš„è®°å½•ï¼š**0ä¸ª**

### ä¿®æ­£æ–¹æ¡ˆ
éœ€è¦åœ¨æ•°æ®åº“ä¸­æ’å…¥è¿™9ä¸ªé“¶è¡Œè´¦æˆ·çš„åˆ«åé…ç½®ã€‚

---

## âŒ å…³é”®å·®å¼‚ #3: Miscellaneous Feeç¼ºå°‘ç‹¬ç«‹å­—æ®µ

### PDFè¦æ±‚
```
Miscellaneous Fee = Suppliersçš„æ‰€æœ‰æ¶ˆè´¹é‡‘é¢ â†’ è‡ªåŠ¨è®¡ç®—1%åˆ·å¡æ‰‹ç»­è´¹

è¦æ±‚:
1. ç‹¬ç«‹ä¸ºMiscellaneous Feeè®°å½•åˆ°è¡¨æ ¼é‡Œ
2. è®¡å…¥åˆ°å®¢æˆ·Owneréœ€è¦æ‰¿æ‹…çš„è´¹ç”¨è´¦å•é‡Œ
```

### å½“å‰ç³»ç»Ÿ
- âŒ `monthly_ledger`è¡¨ç¼ºå°‘`miscellaneous_fee`å­—æ®µ
- âš ï¸ æ‰‹ç»­è´¹è®¡ç®—åœ¨`infinite_monthly_ledger`è¡¨ï¼Œä½†æ²¡æœ‰ç‹¬ç«‹è®°å½•åˆ°Ownerè´¦å•

### ä¿®æ­£æ–¹æ¡ˆ
1. æ·»åŠ `miscellaneous_fee`å­—æ®µåˆ°`monthly_ledger`è¡¨
2. ä¿®æ”¹è®¡ç®—é€»è¾‘ï¼šæ‰‹ç»­è´¹è®¡å…¥Owner's Balance

---

## âœ… æ­£ç¡®é¡¹ #1: Suppliersåˆ—è¡¨

### PDFè¦æ±‚çš„7å¤§Suppliers
1. 7sl
2. Dinas
3. Raub Syc Hainan
4. Ai Smart Tech
5. Huawei
6. Pasar Raya
7. Puchong Herbs

### å½“å‰ç³»ç»Ÿ
- âœ… æ‰€æœ‰7ä¸ªSupplierså‡å·²é…ç½®åœ¨`supplier_aliases`è¡¨
- âš ï¸ ä»…æ˜¯å¤§å°å†™æ ¼å¼ä¸åŒï¼ˆæ•°æ®åº“å­˜å‚¨ä¸ºå¤§å†™ï¼‰

---

## âœ… æ­£ç¡®é¡¹ #2: æ‰‹ç»­è´¹1%é…ç½®

### PDFè¦æ±‚
```
Suppliersçš„æ‰€æœ‰æ¶ˆè´¹é‡‘é¢ â†’ è‡ªåŠ¨è®¡ç®—1%åˆ·å¡æ‰‹ç»­è´¹
```

### å½“å‰ç³»ç»Ÿ
- âœ… `supplier_fee_config`è¡¨å·²é…ç½®æ‰€æœ‰7ä¸ªSuppliersä¸º1.0%
- âœ… `calculate_supplier_fee()`æ–¹æ³•æ­£ç¡®å®ç°1%è®¡ç®—

---

## ğŸ”§ ç«‹å³æ‰§è¡Œçš„ä¿®æ­£ä»»åŠ¡

### Task 1: ä¿®æ­£Owner's Paymentè§„åˆ™
**æ–‡ä»¶**: `services/ledger_classifier.py`
**ä¿®æ”¹**: ç¬¬77-78è¡Œ
```python
# ä¿®æ”¹å‰
if not description:
    return 'infinite'

# ä¿®æ”¹å
if not description or description.strip() == '':
    return 'customer'  # æ— åä»˜æ¬¾å½’Owner
```

### Task 2: æ·»åŠ Miscellaneous Feeå­—æ®µ
**æ–‡ä»¶**: æ•°æ®åº“è¿ç§»è„šæœ¬
```sql
ALTER TABLE monthly_ledger ADD COLUMN miscellaneous_fee REAL DEFAULT 0;
```

### Task 3: é…ç½®GZ BANK LIST
**æ–‡ä»¶**: æ•°æ®åº“ç§å­æ•°æ®
```sql
-- ä¸ºæ¯ä¸ªå®¢æˆ·é…ç½®9ä¸ªGZé“¶è¡Œè´¦æˆ·åˆ«å
INSERT INTO payer_aliases (customer_id, payer_type, alias, is_active) VALUES
(customer_id, 'infinite', 'tan zee liang', 1),
(customer_id, 'infinite', 'gx bank', 1),
(customer_id, 'infinite', 'yeo chee wang', 1),
(customer_id, 'infinite', 'mbb', 1),
...
```

### Task 4: ä¿®æ”¹æœˆåº¦è´¦æœ¬è®¡ç®—é€»è¾‘
**æ–‡ä»¶**: `services/monthly_ledger_engine.py`
```python
# è®¡ç®—Miscellaneous Fee
miscellaneous_fee = sum([
    self.classifier.calculate_supplier_fee(txn['amount'], txn['supplier_name'])
    for txn in infinite_supplier_transactions
])

# è®¡å…¥Ownerè´¦æˆ·
customer_rolling_balance += miscellaneous_fee

# ç‹¬ç«‹è®°å½•
INSERT INTO monthly_ledger (..., miscellaneous_fee, ...)
VALUES (..., miscellaneous_fee, ...)
```

---

## ğŸ“ ä¿®æ­£ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | å½±å“ |
|--------|------|------|
| ğŸ”´ **P0** | Owner's Paymentè§„åˆ™ | ç›´æ¥å½±å“Owner/GZä½™é¢åˆ†ç±» |
| ğŸ”´ **P0** | Miscellaneous Feeç‹¬ç«‹å­—æ®µ | ç¼ºå¤±Owneréœ€æ‰¿æ‹…çš„1%è´¹ç”¨ |
| ğŸŸ¡ **P1** | GZ BANK LISTé…ç½® | å½±å“ä»˜æ¬¾åˆ†ç±»å‡†ç¡®æ€§ |

---

## âœ… ä¿®æ­£éªŒè¯æ¸…å•

ä¿®æ­£å®Œæˆåéœ€è¦éªŒè¯ï¼š

- [ ] æ— åä»˜æ¬¾è‡ªåŠ¨å½’å…¥Owner's Payment
- [ ] Miscellaneous Feeç‹¬ç«‹å­—æ®µå­˜åœ¨äºmonthly_ledgerè¡¨
- [ ] 1%æ‰‹ç»­è´¹è‡ªåŠ¨è®¡å…¥Ownerè´¦æˆ·ä½™é¢
- [ ] 9ä¸ªGZé“¶è¡Œè´¦æˆ·å…¨éƒ¨é…ç½®åˆ°payer_aliasesè¡¨
- [ ] æ‰€æœ‰Suppliersæ¶ˆè´¹è‡ªåŠ¨è¯†åˆ«å¹¶è®¡ç®—1%æ‰‹ç»­è´¹
- [ ] æ¯ç¬”Supplieräº¤æ˜“è‡ªåŠ¨ç”ŸæˆInvoice PDF

---

**æŠ¥å‘Šç”Ÿæˆ**: 2025-11-16
**ä¿®æ­£çŠ¶æ€**: å¾…æ‰§è¡Œ
