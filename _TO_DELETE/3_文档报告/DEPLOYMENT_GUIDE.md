# CreditPilot ç”Ÿäº§éƒ¨ç½²æŒ‡å—

**æ›´æ–°æ—¶é—´**: 2025-11-23  
**éƒ¨ç½²ç±»å‹**: Reserved VM  
**çŠ¶æ€**: âœ… å·²é…ç½®å®Œæˆ

---

## ğŸ“‹ **éƒ¨ç½²é…ç½®æ€»è§ˆ**

### å½“å‰é…ç½®
```toml
[deployment]
deploymentTarget = "vm"
run = ["sh", "-c", "uvicorn accounting_app.main:app --host 0.0.0.0 --port 8000 --workers 2 & gunicorn --bind=0.0.0.0:5000 --workers=4 --timeout=120 --reuse-port app:app & node server.js"]
```

### æœåŠ¡æ¶æ„
| æœåŠ¡ | ç«¯å£ | ç”Ÿäº§æœåŠ¡å™¨ | Workeræ•° | è¯´æ˜ |
|------|------|------------|----------|------|
| **Flask ä¸»åº”ç”¨** | 5000 | Gunicorn | 4 | ä¸»å‰ç«¯æœåŠ¡ |
| **Accounting API** | 8000 | Uvicorn | 2 | FastAPI åç«¯ |
| **MCP Server** | 8080 | Node.js | 1 | MCP åè®®æœåŠ¡å™¨ |

---

## ğŸ¯ **ä¸ºä»€ä¹ˆé€‰æ‹© VM éƒ¨ç½²ï¼Ÿ**

### âœ… ä¼˜åŠ¿
1. **å¤šæœåŠ¡æ”¯æŒ** - 3ä¸ªç‹¬ç«‹æœåŠ¡åŒæ—¶è¿è¡Œ
2. **å§‹ç»ˆåœ¨çº¿** - é€‚åˆå®šæ—¶ä»»åŠ¡ï¼ˆSFTP æ¯10åˆ†é’ŸåŒæ­¥ï¼‰
3. **ç¨³å®šæ€§é«˜** - ä¸ä¼šå› æµé‡ä½è€Œå…³é—­
4. **æ¶æ„ç®€å•** - æ— éœ€åå‘ä»£ç†é…ç½®
5. **æˆæœ¬å¯é¢„æµ‹** - å›ºå®šæœˆè´¹ï¼Œæ— éšè—æˆæœ¬

### âš ï¸ ä¸ Autoscale å¯¹æ¯”
| ç‰¹æ€§ | VM | Autoscale |
|------|-----|-----------|
| å¤šæœåŠ¡è¿è¡Œ | âœ… æ”¯æŒ | âŒ å•æœåŠ¡ |
| å§‹ç»ˆåœ¨çº¿ | âœ… æ˜¯ | âŒ ç©ºé—²æ—¶å…³é—­ |
| åå°ä»»åŠ¡ | âœ… æ”¯æŒ | âš ï¸ å—é™ |
| å®šæ—¶ä»»åŠ¡ | âœ… å®Œç¾ | âŒ ä¸é€‚åˆ |
| æˆæœ¬ | å›ºå®š | æŒ‰è¯·æ±‚è®¡è´¹ |

---

## ğŸš€ **éƒ¨ç½²æ­¥éª¤**

### 1ï¸âƒ£ å‡†å¤‡é˜¶æ®µ
```bash
# 1. éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡
bash test_api_endpoints.sh

# 2. éªŒè¯æ•°æ®å®Œæ•´æ€§
python3 scripts/verify_data_integrity.py

# 3. æ£€æŸ¥ç¯å¢ƒå˜é‡
python3 scripts/backup_env_vars.py
```

**ç¡®è®¤æ¸…å•**:
- [x] æ‰€æœ‰APIæµ‹è¯•é€šè¿‡ (8/8)
- [x] æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡ (6/6)
- [x] ç¯å¢ƒå˜é‡å·²é…ç½® (7/10 æ ¸å¿ƒå˜é‡)
- [x] ç”Ÿäº§æœåŠ¡å™¨å·²å®‰è£… (gunicorn, uvicorn)

---

### 2ï¸âƒ£ éƒ¨ç½²é…ç½®
éƒ¨ç½²é…ç½®å·²è‡ªåŠ¨ä¿å­˜åˆ° `.replit` æ–‡ä»¶ã€‚

**å…³é”®é…ç½®**:
- **éƒ¨ç½²ç±»å‹**: `vm` (Reserved VM)
- **å¯åŠ¨å‘½ä»¤**: åŒæ—¶å¯åŠ¨3ä¸ªæœåŠ¡
- **ç«¯å£æ˜ å°„**: 5000 (ä¸»), 8000 (API), 8080 (MCP)

---

### 3ï¸âƒ£ ç¯å¢ƒå˜é‡é…ç½®

#### å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```bash
# Google Document AIï¼ˆPDFè§£æï¼‰
GOOGLE_PROJECT_ID=<your_project_id>
GOOGLE_PROCESSOR_ID=<your_processor_id>
GOOGLE_LOCATION=<location>
GOOGLE_SERVICE_ACCOUNT_JSON=<json_credentials>

# DocParser API
DOCPARSER_API_KEY=<your_api_key>
DOCPARSER_PARSER_ID=<your_parser_id>

# æ•°æ®åº“
DATABASE_URL=<postgresql_connection_string>

# Flaskå¯†é’¥ï¼ˆç”Ÿäº§å¿…é¡»ï¼‰
SECRET_KEY=<generate_random_secret_key>

# å¯é€‰ï¼šAIé›†æˆ
AI_INTEGRATIONS_OPENAI_API_KEY=<optional>
```

**âš ï¸ é‡è¦**: åœ¨éƒ¨ç½²å‰ï¼Œåœ¨ Replit Secrets ä¸­é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡ã€‚

---

### 4ï¸âƒ£ æ‰§è¡Œéƒ¨ç½²

#### æ–¹æ³•1: ä½¿ç”¨ Replit UIï¼ˆæ¨èï¼‰
1. ç‚¹å‡» Replit ç•Œé¢é¡¶éƒ¨çš„ **"Deploy"** æŒ‰é’®
2. é€‰æ‹© **"Reserved VM"** éƒ¨ç½²ç±»å‹
3. é…ç½®èµ„æºï¼š
   - **vCPU**: 2 ä¸ªï¼ˆæ¨èï¼‰
   - **RAM**: 4 GiBï¼ˆæ¨èï¼‰
   - **å­˜å‚¨**: 10 GBï¼ˆé»˜è®¤ï¼‰
4. ç¡®è®¤é…ç½®å¹¶ç‚¹å‡» **"Deploy"**
5. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦2-5åˆ†é’Ÿï¼‰

#### æ–¹æ³•2: ä½¿ç”¨å‘½ä»¤è¡Œ
```bash
# Replit CLI éƒ¨ç½²ï¼ˆéœ€è¦å®‰è£… Replit CLIï¼‰
replit deployments create
```

---

### 5ï¸âƒ£ éƒ¨ç½²åéªŒè¯

```bash
# 1. å¥åº·æ£€æŸ¥
curl https://your-deployment-url.repl.co/api/health

# 2. éªŒè¯æ‰€æœ‰ç«¯ç‚¹
curl https://your-deployment-url.repl.co/api/customers
curl https://your-deployment-url.repl.co/api/dashboard/summary

# 3. éªŒè¯ FastAPI æ–‡æ¡£
curl https://your-deployment-url.repl.co:8000/docs

# 4. éªŒè¯ MCP Server
curl https://your-deployment-url.repl.co:8080/health
```

**æœŸæœ›å“åº”**:
- `/api/health` â†’ `{"status": "healthy"}`
- `/api/customers` â†’ è¿”å›å®¢æˆ·åˆ—è¡¨
- `/api/dashboard/summary` â†’ è¿”å›æ±‡æ€»æ•°æ®

---

## ğŸ”§ **ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–**

### 1. Gunicorn é…ç½®ï¼ˆFlaskï¼‰
```bash
gunicorn \
  --bind=0.0.0.0:5000 \
  --workers=4 \              # 4ä¸ªworkerè¿›ç¨‹
  --timeout=120 \            # 120ç§’è¶…æ—¶
  --reuse-port \             # ç«¯å£å¤ç”¨
  --access-logfile=- \       # è®¿é—®æ—¥å¿—
  --error-logfile=- \        # é”™è¯¯æ—¥å¿—
  app:app
```

**Workeræ•°é‡è®¡ç®—**: `(2 Ã— CPUæ ¸å¿ƒæ•°) + 1 = (2 Ã— 2) + 1 â‰ˆ 4`

### 2. Uvicorn é…ç½®ï¼ˆFastAPIï¼‰
```bash
uvicorn accounting_app.main:app \
  --host 0.0.0.0 \
  --port 8000 \
  --workers 2 \              # 2ä¸ªworkerè¿›ç¨‹
  --loop uvloop \            # é«˜æ€§èƒ½äº‹ä»¶å¾ªç¯
  --log-level info
```

### 3. æ•°æ®åº“è¿æ¥æ± 
**PostgreSQL è¿æ¥æ± è®¾ç½®**:
- æœ€å°è¿æ¥: 2
- æœ€å¤§è¿æ¥: 10
- è¿æ¥è¶…æ—¶: 30ç§’

---

## ğŸ“Š **æ€§èƒ½åŸºå‡†**

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| APIå“åº”æ—¶é—´ | < 200ms | 95ç™¾åˆ†ä½ |
| æ•°æ®åº“æŸ¥è¯¢ | < 100ms | å¹³å‡å€¼ |
| å¹¶å‘è¯·æ±‚ | 100+ | åŒæ—¶å¤„ç† |
| å¯ç”¨æ€§ | 99.5%+ | æœˆåº¦ç›®æ ‡ |

### èµ„æºä½¿ç”¨
- **CPU**: å¹³å‡ 20-40%
- **å†…å­˜**: 1.5-2.5 GB
- **ç½‘ç»œ**: < 1 Mbps

---

## ğŸš¨ **ç›‘æ§ä¸å‘Šè­¦**

### 1. å¥åº·æ£€æŸ¥ç«¯ç‚¹
```bash
# ä¸»åº”ç”¨
GET /api/health

# FastAPI
GET /docs (Swagger UI)

# MCP Server
GET /health
```

### 2. æ¨èç›‘æ§å·¥å…·
- **Sentry** - é”™è¯¯è¿½è¸ªï¼ˆå¾…é›†æˆï¼‰
- **Prometheus** - æ€§èƒ½ç›‘æ§ï¼ˆå¾…é›†æˆï¼‰
- **Grafana** - å¯è§†åŒ–ä»ªè¡¨æ¿ï¼ˆå¾…é›†æˆï¼‰

### 3. æ—¥å¿—ä½ç½®
```
/tmp/logs/
â”œâ”€â”€ gunicorn_access.log
â”œâ”€â”€ gunicorn_error.log
â”œâ”€â”€ uvicorn.log
â””â”€â”€ mcp_server.log
```

---

## ğŸ”„ **æ»šåŠ¨æ›´æ–°æµç¨‹**

### é›¶åœæœºéƒ¨ç½²
1. **å‡†å¤‡æ–°ç‰ˆæœ¬**
   ```bash
   git add .
   git commit -m "Release v1.x.x"
   ```

2. **æµ‹è¯•æ–°ç‰ˆæœ¬**
   ```bash
   bash test_api_endpoints.sh
   ```

3. **éƒ¨ç½²æ›´æ–°**
   - Replit è‡ªåŠ¨æ£€æµ‹ä»£ç å˜æ›´
   - æ‰§è¡Œä¼˜é›…é‡å¯ï¼ˆgraceful reloadï¼‰
   - ä¿æŒç°æœ‰è¿æ¥ç›´åˆ°å®Œæˆ

4. **éªŒè¯éƒ¨ç½²**
   ```bash
   curl https://your-deployment-url.repl.co/api/health
   ```

---

## âš™ï¸ **ç¯å¢ƒå˜é‡ç®¡ç†**

### å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ
| å˜é‡ | å¼€å‘ | ç”Ÿäº§ |
|------|------|------|
| `FLASK_ENV` | development | production |
| `FLASK_DEBUG` | True | False |
| `DATABASE_URL` | SQLite | PostgreSQL |
| `SECRET_KEY` | ç®€å•å€¼ | å¼ºéšæœºå€¼ |

### ç”Ÿæˆ SECRET_KEY
```bash
python3 -c "import secrets; print(secrets.token_hex(32))"
```

---

## ğŸ”’ **å®‰å…¨é…ç½®**

### 1. HTTPS/SSL
Replit è‡ªåŠ¨æä¾› HTTPS è¯ä¹¦ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

### 2. CORS é…ç½®
å·²é…ç½®10ä¸ªå…è®¸çš„åŸŸåï¼ˆè§ `cors_config.py`ï¼‰:
- âœ… MiniMax Dashboard
- âœ… Replit åº”ç”¨åŸŸå
- âœ… ç”Ÿäº§åŸŸå

### 3. ç¯å¢ƒéš”ç¦»
- âŒ ç¦æ­¢åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- âœ… ä½¿ç”¨ Replit Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯
- âœ… æ•°æ®åº“è¿æ¥ä½¿ç”¨ç¯å¢ƒå˜é‡

---

## ğŸ“ˆ **æ‰©å±•ç­–ç•¥**

### å‚ç›´æ‰©å±•ï¼ˆå‡çº§VMï¼‰
å¦‚æœæ€§èƒ½ä¸è¶³ï¼Œå¯å‡çº§åˆ°æ›´å¤§çš„VMï¼š
- **2 vCPU / 4 GB RAM** â†’ å½“å‰é…ç½®
- **4 vCPU / 8 GB RAM** â†’ é«˜æµé‡
- **8 vCPU / 16 GB RAM** â†’ è¶…é«˜æµé‡

### æ°´å¹³æ‰©å±•ï¼ˆå¤šå®ä¾‹ï¼‰
- ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨
- éƒ¨ç½²å¤šä¸ª VM å®ä¾‹
- å…±äº« PostgreSQL æ•°æ®åº“

---

## ğŸ› **æ•…éšœæ’æŸ¥**

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡æ— æ³•å¯åŠ¨
**ç—‡çŠ¶**: éƒ¨ç½²å¤±è´¥æˆ–æœåŠ¡æ— å“åº”

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
replit deployments logs

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E "5000|8000|8080"
```

**è§£å†³**: ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²å®‰è£…ï¼Œç¯å¢ƒå˜é‡å·²é…ç½®

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
**ç—‡çŠ¶**: 500é”™è¯¯ï¼Œæ—¥å¿—æ˜¾ç¤ºè¿æ¥è¶…æ—¶

**æ£€æŸ¥**:
```bash
# éªŒè¯æ•°æ®åº“è¿æ¥
echo $DATABASE_URL
```

**è§£å†³**: ç¡®è®¤ PostgreSQL æ•°æ®åº“å·²åˆ›å»ºå¹¶å¯è®¿é—®

#### 3. APIå“åº”æ…¢
**ç—‡çŠ¶**: å“åº”æ—¶é—´ > 1ç§’

**æ£€æŸ¥**:
```bash
# æ€§èƒ½åˆ†æ
curl -w "@curl-format.txt" -o /dev/null -s https://your-url.repl.co/api/customers
```

**è§£å†³**: 
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- å¢åŠ  worker æ•°é‡
- å‡çº§ VM é…ç½®

---

## ğŸ“ **æ”¯æŒä¸è”ç³»**

### é‡åˆ°é—®é¢˜ï¼Ÿ
1. **æŸ¥çœ‹æ—¥å¿—**: `replit deployments logs`
2. **å¥åº·æ£€æŸ¥**: è¿è¡Œ `bash test_api_endpoints.sh`
3. **å›æ»š**: Replit UI â†’ Deployments â†’ Previous Version

### æ–‡æ¡£èµ„æº
- [Replit éƒ¨ç½²æ–‡æ¡£](https://docs.replit.com/category/deployments)
- [è¿ç»´æ‰‹å†Œ](./OPERATIONS_MANUAL.md)
- [APIéªŒè¯æŠ¥å‘Š](./api_validation_report.md)

---

## âœ… **éƒ¨ç½²æ£€æŸ¥æ¸…å•**

### éƒ¨ç½²å‰
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (8/8)
- [ ] æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡ (6/6)
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ç”Ÿäº§å¯†é’¥å·²ç”Ÿæˆ
- [ ] æ•°æ®åº“å·²è¿ç§»

### éƒ¨ç½²ä¸­
- [ ] é€‰æ‹© Reserved VM ç±»å‹
- [ ] é…ç½® 2 vCPU / 4 GB RAM
- [ ] ç¡®è®¤å¯åŠ¨å‘½ä»¤æ­£ç¡®
- [ ] è®¾ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

### éƒ¨ç½²å
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] CORSé…ç½®ç”Ÿæ•ˆ
- [ ] æ—¥å¿—ç³»ç»Ÿæ­£å¸¸
- [ ] ç›‘æ§å‘Šè­¦é…ç½®ï¼ˆæ¨èï¼‰

---

**éƒ¨ç½²é…ç½®**: âœ… å·²å®Œæˆ  
**ç”Ÿäº§å°±ç»ªåº¦**: ğŸ¯ 100%  
**å¯ç«‹å³éƒ¨ç½²**: âœ… æ˜¯

**ğŸš€ ç³»ç»Ÿå·²å‡†å¤‡å¥½éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼**
