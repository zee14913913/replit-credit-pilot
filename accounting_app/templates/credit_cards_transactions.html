{% extends "base.html" %}
{% block title %}Credit Cards · Transactions{% endblock %}
{% block head_extra %}
<style>
  :root{ --pink:#FF007F; --card:#322446; --bg:#1a1323; --text:#fff; --line:#3b2b4e; --muted:#c9c6d3; --gap:16px; --radius:16px; --pad:14px; --page-max:1280px }
  body{ background:var(--bg); color:var(--text) }
  .page{ min-height:100vh; display:flex; flex-direction:column }
  .main{ width:100%; max-width:var(--page-max); margin:0 auto; padding:20px }
  .header{ display:flex; align-items:center; gap:12px; margin-bottom:var(--gap) }
  .title{ font-size:22px; font-weight:700; color:var(--text) }
  .toolbar{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:var(--gap) }
  .btn{ background:var(--card); color:#fff; border:1px solid var(--line); border-radius:12px; padding:8px 12px; text-decoration:none; cursor:pointer }
  .btn.primary{ background:var(--pink); border-color:#ff6aa7 }
  .btn.ghost{ background:transparent; border:1px solid #ffffff33 }
  .filters{ display:grid; grid-template-columns:repeat(4,minmax(160px,1fr)); gap:8px }
  .input, select{ background:#0f0a14; color:#fff; border:1px solid var(--line); border-radius:10px; padding:8px 10px }
  .card{ background:linear-gradient(180deg,#322446,#281a3a); border:1px solid var(--line); border-radius:16px; padding:var(--pad); box-shadow:0 6px 18px #0006 }
  .grid-auto{ display:grid; grid-template-columns:1.2fr .8fr; gap:var(--gap) }
  @media (max-width:1024px){ .grid-auto{ grid-template-columns:1fr } }
  table{ width:100%; border-collapse:collapse; }
  th,td{ border:1px solid var(--line); padding:8px; font-size:14px; vertical-align:top }
  th{ background:#271b36; text-align:left }
  .meta{ color:var(--muted); font-size:12px }
  .tag{ display:inline-block; padding:2px 6px; border:1px solid var(--line); border-radius:999px; font-size:12px; margin-right:6px }
  .tag.primary{ border-color:var(--pink); color:#fff }
  .stat{ display:flex; gap:10px; align-items:baseline }
  .stat .v{ font-size:20px; font-weight:700 }
</style>
{% endblock %}
{% block content %}

<div class="page">
  <div class="main">

    <div class="header">
      <div class="title">Credit Cards · Transactions</div>
      <div class="meta">{{ request.query_params.get('lang','en')|upper }}</div>
    </div>

    <div class="toolbar">
      <a class="btn" href="/credit-cards/statements/page{{ '?lang=' + request.query_params.get('lang') if request.query_params.get('lang') else '' }}">Upload Statements</a>
      <a class="btn" href="/credit-cards/receipts{{ '?lang=' + request.query_params.get('lang') if request.query_params.get('lang') else '' }}">Manage Receipts</a>
      <a class="btn" href="/credit-cards/supplier-invoices{{ '?lang=' + request.query_params.get('lang') if request.query_params.get('lang') else '' }}">Supplier Invoices</a>
      <div style="flex:1"></div>
      <a class="btn ghost" href="?lang=en">EN</a>
      <a class="btn ghost" href="?lang=zh">中文</a>
    </div>

    <div class="grid-auto">
      <div class="card">
        <div style="font-weight:700; margin-bottom:8px">All Transactions (This Month)</div>
        <div class="filters" style="margin-bottom:10px">
          <select id="f-card">
            <option value="">All Cards</option>
            <option>Maybank ****1234</option>
            <option>CIMB ****5678</option>
          </select>
          <select id="f-period">
            <option>This Month</option>
            <option>Last Month</option>
            <option>Custom Range</option>
          </select>
          <select id="f-type">
            <option value="">All Types</option>
            <option>Owner Expense</option>
            <option>Owner Payment</option>
            <option>INFINITE Supplier</option>
          </select>
          <input class="input" id="f-q" placeholder="Search description...">
        </div>
        <table id="txTable">
          <thead>
            <tr>
              <th>Date</th><th>Description</th><th>Amount (RM)</th><th>Category</th><th>Receipt</th>
            </tr>
          </thead>
          <tbody>
            {% for t in transactions or [] %}
            <tr>
              <td>{{ t.date }}</td>
              <td>{{ t.desc }}</td>
              <td>{{ '%.2f'|format(t.amount|float) }}</td>
              <td>
                {% if t.category == 'gz_expenses' %}<span class="tag primary">INFINITE Supplier</span>
                {% elif t.category == 'owner_expenses' %}<span class="tag">Owner Expense</span>
                {% elif t.category == 'owner_payments' %}<span class="tag">Owner Payment</span>
                {% else %}<span class="tag">Uncategorized</span>{% endif %}
              </td>
              <td>{{ t.receipt_status or 'Pending' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="card">
        <div style="font-weight:700; margin-bottom:8px">Coverage & Status</div>
        <div class="stat">
          <div class="v">{{ matched_count or 45 }}/{{ total_count or 60 }}</div>
          <div class="meta">Receipts Matched</div>
        </div>
        <div class="stat">
          <div class="v">B</div>
          <div class="meta">Data Integrity Grade</div>
        </div>
        <div style="height:10px"></div>
        <div class="meta">This panel summarizes receipt coverage and grading. Upload missing receipts to improve grade.</div>
      </div>
    </div>

  </div>
</div>

{% endblock %}
