{% extends "base.html" %}
{% block title %}Top-3 Picks 路 INFINITE GZ{% endblock %}
{% block content %}
  <h1 class="section">Top-3 Picks Today</h1>
  <div id="cards" class="grid-3">
    <!-- JS 娓叉 -->
  </div>

  <script>
    async function add(product){
      await fetch('/loans/compare/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({product})});
      alert('Added to Compare: '+product);
    }

    function cardHTML(r, i){
      const crown = i===0 ? ' ' : '';
      return `
        <div class="card tile">
          <div>
            <div class="section">#${i+1}${crown} 路 ${r.bank} 路 ${r.product}</div>
            <div class="meta">APR ${r.apr}% 路 Score ${r.score} 路 Sentiment ${r.sentiment}</div>
            <div class="meta">Preferred: ${r.preferred||'-'}</div>
          </div>
          <div>
            <button class="btn primary" onclick="add('${r.product.replace(/'/g,'\\\'')}')">ユ浠</button>
            <a class="btn" href="/loans/ranking/pdf" target="_blank">涓杞Top-3 PDF</a>
          </div>
        </div>
      `;
    }

    async function init(){
      const r = await fetch('/loans/ranking');
      const list = await r.json();
      const html = list.slice(0,3).map((x,idx)=>cardHTML(x,idx)).join('');
      document.getElementById('cards').innerHTML = html;
    }
    init();
  </script>
{% endblock %}
