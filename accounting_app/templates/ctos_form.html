{% extends "base.html" %}
{% block title %}CTOS Consent Â· INFINITE GZ{% endblock %}
{% block content %}
  <h1 class="section">CTOS Consent Form</h1>
  <div class="grid-2">
    <div class="card">
      <div class="label">Full Name</div>
      <input class="input" name="name" placeholder="e.g. CHEN DA MING">
      <div class="label" style="margin-top:10px">IC / Passport</div>
      <input class="input" name="ic" placeholder="e.g. 850123-10-5678">

      <div class="label" style="margin-top:10px">Email</div>
      <input class="input" name="email" placeholder="name@example.com">
      <div class="label" style="margin-top:10px">Phone</div>
      <input class="input" name="phone" placeholder="+60...">
    </div>

    <div class="card">
      <div class="label">Upload Identification (PDF/JPG/PNG)</div>
      <input class="input" type="file" id="icFile" accept=".pdf,.jpg,.jpeg,.png">
      <div class="label" style="margin-top:10px">Upload SSM (if company)</div>
      <input class="input" type="file" id="ssmFile" accept=".pdf,.jpg,.jpeg,.png">
      <div style="margin-top:12px; display:flex; gap:10px">
        <button class="btn primary" id="submitBtn">Submit</button>
        <a class="btn ghost" href="/loans/page">Back to Loans</a>
      </div>
      <div id="msg" class="meta" style="margin-top:10px"></div>
    </div>
  </div>

  <script>
    document.getElementById('submitBtn').addEventListener('click', async ()=>{
      const fd = new FormData();
      fd.append('name', document.querySelector('[name=name]').value||'');
      fd.append('ic', document.querySelector('[name=ic]').value||'');
      fd.append('email', document.querySelector('[name=email]').value||'');
      fd.append('phone', document.querySelector('[name=phone]').value||'');
      if(document.getElementById('icFile').files[0]) fd.append('ic_file', document.getElementById('icFile').files[0]);
      if(document.getElementById('ssmFile').files[0]) fd.append('ssm_file', document.getElementById('ssmFile').files[0]);

      const res = await fetch('/ctos/submit?key={{ portal_key or "demo" }}', {method:'POST', body:fd});
      const j = await res.json().catch(()=>({ok:false}));
      document.getElementById('msg').textContent = res.ok ? 'Submitted. Ticket: '+(j.ticket||'ok') : 'Failed.';
      if(res.ok) setTimeout(()=>location.href='/loans/compare/page', 600);
    });
  </script>
{% endblock %}
