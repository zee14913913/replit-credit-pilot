{% extends "base.html" %}
{% block title %}CTOS Authorization · CreditPilot{% endblock %}

{% block content %}
<h1 class="title">CTOS Authorization</h1>

<div class="card">
  <div class="meta">请填写授权并上传身份证 / 公司 SSM。提交后将进入队列处理。</div>
  <hr class="sep">

  <form id="ctosForm" action="/ctos/submit{% if key %}?key={{ key }}{% endif %}" method="post" enctype="multipart/form-data" style="display:grid; gap:12px; max-width:780px">
    <div class="grid-2">
      <div>
        <label>Full Name</label><br>
        <input class="input" name="full_name" required placeholder="as per IC">
      </div>
      <div>
        <label>NRIC / Company No.</label><br>
        <input class="input" name="id_no" required placeholder="e.g. 900101-14-5678 / 2024xxxxx">
      </div>
    </div>

    <div class="grid-2">
      <div>
        <label>Email</label><br>
        <input class="input" type="email" name="email" required>
      </div>
      <div>
        <label>Phone</label><br>
        <input class="input" name="phone" required placeholder="+60...">
      </div>
    </div>

    <div>
      <label>Customer Type</label><br>
      <select class="input" name="ctype" style="width:200px">
        <option value="PERSONAL">PERSONAL</option>
        <option value="COMPANY">COMPANY</option>
      </select>
    </div>

    <div class="grid-2">
      <div>
        <label>IC / Passport (PDF/JPG/PNG)</label><br>
        <input class="input" type="file" name="ic_file" accept=".pdf,.jpg,.jpeg,.png" required>
      </div>
      <div>
        <label>SSM / Biz Doc (PDF/JPG/PNG)</label><br>
        <input class="input" type="file" name="ssm_file" accept=".pdf,.jpg,.jpeg,.png">
      </div>
    </div>

    <div style="display:flex; gap:8px; align-items:center">
      <input id="agree" type="checkbox" required>
      <label for="agree" class="meta">我授权 INFINITE GZ SDN. BHD. 代表我向 CTOS 及相关机构查询信用报告用于贷款评估。</label>
    </div>

    <div style="display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn primary" type="submit">提交授权</button>
      <a class="btn" href="/loans/page">返回 Loans</a>
    </div>
  </form>
  
  <pre id="out" class="code" style="margin-top:12px; white-space:pre-wrap"></pre>
</div>

<script>
const frm=document.getElementById('ctosForm');
frm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd=new FormData(frm);
  const res=await fetch(frm.action,{method:'POST',body:fd});
  const js=await res.json();
  document.getElementById('out').textContent=JSON.stringify(js,null,2);
  if(js.status==='success'){
    alert('提交成功！');
  }
});
</script>
{% endblock %}
