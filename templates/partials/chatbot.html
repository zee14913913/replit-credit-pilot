<div id="ai-chatbox" style="position:fixed;bottom:40px;right:40px;z-index:9999;">
  <button id="chat-toggle" style="background:#ff007f;color:#fff;border:none;border-radius:999px;padding:12px 18px;font-weight:700;box-shadow:0 0 18px rgba(255,0,127,0.6);">
    智能顾问
  </button>
  <div id="chat-window" style="display:none;width:340px;height:460px;background:#111;border:1px solid #ff007f;border-radius:16px;padding:10px;color:#fff;">
    <div id="chat-log" style="height:360px;overflow-y:auto;font-size:14px;line-height:1.5;"></div>
    <div style="display:flex;gap:6px;margin-top:6px;">
      <input id="chat-input" placeholder="{{ t('auto_text_1055') }}" 
             style="flex:1;padding:8px;border-radius:10px;border:none;color:#fff;background:#222;">
      <button id="sys-analyze" 
              style="background:#ff007f;border:none;border-radius:10px;padding:8px 10px;color:#fff;">
        系统分析
      </button>
    </div>
  </div>
</div>

<script>
const toggle=document.getElementById("chat-toggle");
const win=document.getElementById("chat-window");
const log=document.getElementById("chat-log");
const input=document.getElementById("chat-input");
const analyze=document.getElementById("sys-analyze");

toggle.onclick=()=>{{ t('winstyledisplaywinstyledisplaynoneblocknoneasync_f') }}<div><b>{{ t('auto_text_1052') }}</b>{{ t('msg') }}</div>{{ t('_const_rawait_fetchendpointmethodpostheadersconten') }}<div style='color:#ff007f;'><b>{{ t('ai_3') }}</b>{{ t('dreplydanalysisderror') }}</div>`;
 log.scrollTop=log.scrollHeight;
}

input.addEventListener("keypress",e=>{
  if(e.key==="Enter"&&input.value.trim()!==""){
    send(input.value,"/api/ai-assistant/query");
    input.value="";
  }
});

analyze.onclick=()=>send("请分析整个系统的资金健康状况","/api/ai-assistant/analyze-system");
</script>
