{% extends "base.html" %}
{% block title %}{{ t('loan_products_marketplace') }}{% endblock %}
{% block content %}

<link rel="stylesheet" href="/static/css/loan_products_catalog.css">
<script defer src="/static/js/loan_products_catalog.js"></script>

<div class="loan-marketplace-container">

    <!-- ========================================================= -->
    <!-- PAGE HEADER -->
    <!-- ========================================================= -->
    <div class="marketplace-header">
        <h1 class="title">{{ t('loan_products_marketplace') }}</h1>
        <p class="subtitle">{{ t('browse_products_desc').replace('{products}', '<span class="highlight">' + total_products|string + '</span>').replace('{banks}', '<span class="highlight">' + total_banks|string + '</span>')|safe }}</p>
    </div>

    <!-- ========================================================= -->
    <!-- SEARCH & FILTER BAR -->
    <!-- ========================================================= -->
    <div class="search-filter-bar">
        <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" id="searchInput" placeholder="{{ t('search_by_bank_or_product') }}">
        </div>

        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">
                <i class="bi bi-grid-fill"></i> {{ t('all_products') }}
            </button>
            <button class="filter-btn" data-filter="traditional_bank">
                <i class="bi bi-bank"></i> {{ t('banks') }}
            </button>
            <button class="filter-btn" data-filter="digital_bank">
                <i class="bi bi-phone"></i> {{ t('digital_banks') }}
            </button>
            <button class="filter-btn" data-filter="fintech">
                <i class="bi bi-lightning-charge"></i> {{ t('fintech') }}
            </button>
            <button class="filter-btn" data-filter="lowest_rate">
                <i class="bi bi-arrow-down-circle"></i> {{ t('lowest_rate') }}
            </button>
            <button class="filter-btn" data-filter="highest_amount">
                <i class="bi bi-cash-stack"></i> {{ t('highest_amount') }}
            </button>
        </div>
    </div>

    <!-- ========================================================= -->
    <!-- PRODUCTS GRID (Masonry Layout) -->
    <!-- ========================================================= -->
    <div id="productsGrid" class="products-grid">
        <!-- Products will be dynamically rendered by JS -->
    </div>

    <!-- ========================================================= -->
    <!-- PRODUCT DETAIL MODAL -->
    <!-- ========================================================= -->
    <div id="productModal" class="product-modal hidden">
        <div class="modal-overlay" onclick="closeProductModal()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeProductModal()">
                <i class="bi bi-x-lg"></i>
            </button>

            <div class="modal-header">
                <div class="bank-logo-large" id="modalBankLogo"></div>
                <div class="modal-title-section">
                    <h2 id="modalProductName"></h2>
                    <p id="modalBankName"></p>
                </div>
            </div>

            <div class="modal-body">
                <!-- Interest Rate Section -->
                <div class="detail-section">
                    <h3><i class="bi bi-percent"></i> {{ t('interest_rate') }}</h3>
                    <div class="rate-display">
                        <span id="modalRateMin"></span> - <span id="modalRateMax"></span>
                    </div>
                </div>

                <!-- Loan Details -->
                <div class="detail-section">
                    <h3><i class="bi bi-info-circle"></i> {{ t('loan_details') }}</h3>
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>{{ t('max_loan_amount') }}</label>
                            <span id="modalMaxAmount"></span>
                        </div>
                        <div class="detail-item">
                            <label>{{ t('max_tenure') }}</label>
                            <span id="modalMaxTenure"></span>
                        </div>
                        <div class="detail-item">
                            <label>{{ t('min_income') }}</label>
                            <span id="modalMinIncome"></span>
                        </div>
                        <div class="detail-item">
                            <label>{{ t('approval_time') }}</label>
                            <span id="modalApprovalTime"></span>
                        </div>
                    </div>
                </div>

                <!-- Features -->
                <div class="detail-section">
                    <h3><i class="bi bi-star-fill"></i> {{ t('features') }}</h3>
                    <div id="modalFeatures" class="features-list"></div>
                </div>

                <!-- Eligibility -->
                <div class="detail-section">
                    <h3><i class="bi bi-check-circle"></i> {{ t('eligibility_requirements') }}</h3>
                    <div id="modalEligibility" class="eligibility-list"></div>
                </div>

                <!-- Action Buttons -->
                <div class="modal-actions">
                    <button class="btn-select-product" onclick="selectProductForEvaluation()">
                        <i class="bi bi-calculator"></i> {{ t('select_for_evaluation') }}
                    </button>
                    <button class="btn-secondary" onclick="closeProductModal()">
                        {{ t('close') }}
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // Pass server data to JavaScript
    window.productsData = {{ products_json|tojson|safe }};
</script>

{% endblock %}
