{% extends "base.html" %}
{% block title %}Loan Products Marketplace{% endblock %}
{% block content %}

<link rel="stylesheet" href="/static/css/loan_products_catalog.css">
<script defer src="/static/js/loan_products_catalog.js"></script>

<div class="loan-marketplace-container">

    <!-- ========================================================= -->
    <!-- PAGE HEADER -->
    <!-- ========================================================= -->
    <div class="marketplace-header">
        <h1 class="title">Loan Products Marketplace</h1>
        <p class="subtitle">Browse <span class="highlight">{{ total_products }}</span> loan products from <span class="highlight">{{ total_banks }}</span> Malaysian banks & fintechs</p>
    </div>

    <!-- ========================================================= -->
    <!-- SEARCH & FILTER BAR -->
    <!-- ========================================================= -->
    <div class="search-filter-bar">
        <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" id="searchInput" placeholder="Search by bank or product name...">
        </div>

        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">
                <i class="bi bi-grid-fill"></i> All Products
            </button>
            <button class="filter-btn" data-filter="traditional_bank">
                <i class="bi bi-bank"></i> Banks
            </button>
            <button class="filter-btn" data-filter="digital_bank">
                <i class="bi bi-phone"></i> Digital Banks
            </button>
            <button class="filter-btn" data-filter="fintech">
                <i class="bi bi-lightning-charge"></i> Fintech
            </button>
            <button class="filter-btn" data-filter="lowest_rate">
                <i class="bi bi-arrow-down-circle"></i> Lowest Rate
            </button>
            <button class="filter-btn" data-filter="highest_amount">
                <i class="bi bi-cash-stack"></i> Highest Amount
            </button>
        </div>
    </div>

    <!-- ========================================================= -->
    <!-- PRODUCTS GRID (Masonry Layout) -->
    <!-- ========================================================= -->
    <div id="productsGrid" class="products-grid">
        <!-- Products will be dynamically rendered by JS -->
    </div>

    <!-- ========================================================= -->
    <!-- PRODUCT DETAIL MODAL -->
    <!-- ========================================================= -->
    <div id="productModal" class="product-modal hidden">
        <div class="modal-overlay" onclick="closeProductModal()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeProductModal()">
                <i class="bi bi-x-lg"></i>
            </button>

            <div class="modal-header">
                <div class="bank-logo-large" id="modalBankLogo"></div>
                <div class="modal-title-section">
                    <h2 id="modalProductName"></h2>
                    <p id="modalBankName"></p>
                </div>
            </div>

            <div class="modal-body">
                <!-- Interest Rate Section -->
                <div class="detail-section">
                    <h3><i class="bi bi-percent"></i> Interest Rate</h3>
                    <div class="rate-display">
                        <span id="modalRateMin"></span> - <span id="modalRateMax"></span>
                    </div>
                </div>

                <!-- Loan Details -->
                <div class="detail-section">
                    <h3><i class="bi bi-info-circle"></i> Loan Details</h3>
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>Max Loan Amount</label>
                            <span id="modalMaxAmount"></span>
                        </div>
                        <div class="detail-item">
                            <label>Max Tenure</label>
                            <span id="modalMaxTenure"></span>
                        </div>
                        <div class="detail-item">
                            <label>Min Income</label>
                            <span id="modalMinIncome"></span>
                        </div>
                        <div class="detail-item">
                            <label>Approval Time</label>
                            <span id="modalApprovalTime"></span>
                        </div>
                    </div>
                </div>

                <!-- Features -->
                <div class="detail-section">
                    <h3><i class="bi bi-star-fill"></i> Features</h3>
                    <div id="modalFeatures" class="features-list"></div>
                </div>

                <!-- Eligibility -->
                <div class="detail-section">
                    <h3><i class="bi bi-check-circle"></i> Eligibility Requirements</h3>
                    <div id="modalEligibility" class="eligibility-list"></div>
                </div>

                <!-- Action Buttons -->
                <div class="modal-actions">
                    <button class="btn-select-product" onclick="selectProductForEvaluation()">
                        <i class="bi bi-calculator"></i> Select For Loan Evaluation
                    </button>
                    <button class="btn-secondary" onclick="closeProductModal()">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // Pass server data to JavaScript
    window.productsData = {{ products_json|tojson|safe }};
</script>

{% endblock %}
