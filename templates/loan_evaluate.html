{% extends "base.html" %}
{% block title %}{{ t('modern_personal_loan_evaluation') }}{% endblock %}
{% block content %}

<link rel="stylesheet" href="/static/css/loan_evaluate.css">
<link rel="stylesheet" href="/static/css/loan_result.css">
<script defer src="/static/js/loan_result_renderer.js"></script>
<script defer src="/static/js/loan_evaluate.js"></script>

<div class="loan-eval-container">

    <!-- ========================================================= -->
    <!-- PAGE HEADER -->
    <!-- ========================================================= -->
    <div class="page-header">
        <h1 class="title">{{ t('modern_personal_loan_evaluation') }}</h1>
        <p class="subtitle">{{ t('ai_driven_malaysia_bank_approval_simulation') }}</p>
    </div>

    <!-- ========================================================= -->
    <!-- MODE SELECTOR -->
    <!-- ========================================================= -->
    <div class="mode-selector">
        <button id="mode_auto"    class="mode-btn active">{{ t('full_automated_mode') }}</button>
        <button id="mode_income"  class="mode-btn">{{ t('quick_estimate_income_only') }}</button>
        <button id="mode_commit"  class="mode-btn">{{ t('quick_estimate_income_commitments') }}</button>
    </div>

    <div class="main-layout">

        <!-- ========================================================= -->
        <!-- LEFT PANEL — INPUT AREA -->
        <!-- ========================================================= -->
        <div class="left-panel">

            <!-- ================= FULL AUTO MODE ================= -->
            <div id="auto_mode_block" class="input-section">
                <h2>{{ t('upload_financial_documents') }}</h2>
                <p class="section-desc">{{ t('ctos_ccris_salary_slip_epf_bank_statement') }}</p>

                <div class="upload-box">
                    <label>{{ t('payslip_pdf') }}</label>
                    <input id="payslip_file" type="file" accept="application/pdf">
                </div>

                <div class="upload-box">
                    <label>{{ t('epf_statement_pdf') }}</label>
                    <input id="epf_file" type="file" accept="application/pdf">
                </div>

                <div class="upload-box">
                    <label>{{ t('bank_statement_pdf') }}</label>
                    <input id="bank_statement_file" type="file" accept="application/pdf">
                </div>

                <div class="upload-box">
                    <label>{{ t('ctos_pdf') }}</label>
                    <input id="ctos_file" type="file" accept="application/pdf">
                </div>

                <div class="upload-box">
                    <label>{{ t('ccris_pdf') }}</label>
                    <input id="ccris_file" type="file" accept="application/pdf">
                </div>

                <button id="btn_auto_submit" class="primary-btn" onclick="handleFullAutoEvaluation()">{{ t('start_automated_evaluation') }}</button>
            </div>

            <!-- ================= QUICK INCOME MODE ================= -->
            <div id="income_mode_block" class="input-section hidden">
                <h2>{{ t('quick_estimate_income_only') }}</h2>
                <p class="section-desc">{{ t('provide_your_monthly_nett_income') }}</p>

                <div class="form-group">
                    <label>{{ t('nett_income_rm') }}</label>
                    <input id="qe_income" type="number" placeholder="{{ t('placeholder_income') }}">
                </div>

                <button id="btn_qe_income" class="primary-btn">{{ t('calculate') }}</button>
            </div>

            <!-- ================= QUICK INCOME + COMMIT ================= -->
            <div id="commit_mode_block" class="input-section hidden">
                <h2>{{ t('quick_estimate_income_commitments') }}</h2>
                <p class="section-desc">{{ t('estimate_your_monthly_income_debts') }}</p>

                <div class="form-group">
                    <label>{{ t('nett_income_rm') }}</label>
                    <input id="qe2_income" type="number" placeholder="{{ t('placeholder_income') }}">
                </div>

                <div class="form-group">
                    <label>{{ t('monthly_commitments_rm') }}</label>
                    <input id="qe2_commit" type="number" placeholder="{{ t('placeholder_commitments') }}">
                </div>

                <button id="btn_qe_commit" class="primary-btn">{{ t('calculate') }}</button>
            </div>

        </div>

        <!-- ========================================================= -->
        <!-- RIGHT PANEL — DYNAMIC RESULT AREA -->
        <!-- ========================================================= -->
        <div class="right-panel">

            <!-- ========== RISK SUMMARY CARD ========== -->
            <div id="risk_card" class="card hidden">
                <h3>{{ t('risk_assessment') }}</h3>
                <div id="risk_grade" class="risk-grade">—</div>
                <p><strong>{{ t('dti') }}:</strong> <span id="r_dti">—</span></p>
                <p><strong>{{ t('foir') }}:</strong> <span id="r_foir">—</span></p>
                <p><strong>{{ t('ccris_bucket') }}:</strong> <span id="r_bucket">—</span></p>
                <p><strong>{{ t('credit_score') }}:</strong> <span id="r_credit">—</span></p>
                <p><strong>{{ t('employment_status') }}:</strong> <span id="r_emp">—</span></p>
            </div>

            <!-- ========== APPROVAL ODDS ========== -->
            <div id="odds_card" class="card hidden">
                <h3>{{ t('approval_odds') }}</h3>
                <div id="odds_circle" class="odds-circle">—%</div>
                <p class="odds-subtext">{{ t('based_on_malaysia_bank_scoring') }}</p>
            </div>

            <!-- ========== LOAN SUMMARY ========== -->
            <div id="loan_summary" class="card hidden">
                <h3>{{ t('loan_eligibility') }}</h3>
                <p><strong>{{ t('max_emi') }}:</strong> RM <span id="r_max_emi">—</span></p>
                <p><strong>{{ t('max_loan_amount_value') }}:</strong> RM <span id="r_max_loan">—</span></p>
            </div>

            <!-- ========== AI ADVISOR ========== -->
            <div id="ai_advisor" class="card hidden">
                <h3>{{ t('ai_loan_advisor') }}</h3>
                <div id="advisor_text" class="advisor-text">—</div>
            </div>

            <!-- ========== TOP 3 PRODUCTS ========== -->
            <div id="product_list" class="product-list hidden">
                <h3>{{ t('recommended_loan_products') }}</h3>
                <div id="products_container"></div>
            </div>

        </div>
    </div>
</div>

{% endblock %}
