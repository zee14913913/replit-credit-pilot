{% extends "base.html" %}

{% block title %}{{ t('admin_dashboard') }} - {{ t('company_name') }}{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 98%; padding: 2rem;">
    <!-- DEBUG TEST BUTTON -->
    <div class="alert" style="background: rgba(255,0,127,0.2); border: 2px solid #FF007F; margin-bottom: 20px; padding: 20px;">
        <button onclick="testEditFunction()" class="btn" style="background: #FF007F; color: white; font-weight: 700; padding: 15px 30px; font-size: 18px;">
            üß™ ÁÇπÂáªËøôÈáåÊµãËØïÁºñËæëÂäüËÉΩ / CLICK TO TEST EDIT
        </button>
        <p id="test_result" style="color: white; margin-top: 10px; font-weight: 600; font-size: 16px;"></p>
    </div>
    
    <div class="section-header">
        <h1 class="section-title" style="color: #FF007F; font-weight: 700;">üìä {{ t('admin_dashboard') }}</h1>
        <p class="section-description" style="color: #FF007F;">{{ t('system_overview_subtitle') }}</p>
    </div>

    <!-- System Summary -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-value" style="font-size: 1.8rem;">{{ customers|length }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('total_customers') }}</div>
                <div class="stat-corner"></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-value" style="font-size: 1.8rem;">{{ statement_count }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('total_statements') }}</div>
                <div class="stat-corner"></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-value" style="font-size: 1.8rem;">{{ txn_count }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('total_transactions') }}</div>
                <div class="stat-corner"></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-value" style="font-size: 1.8rem;">{{ active_cards }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('active_cards') }}</div>
                <div class="stat-corner"></div>
            </div>
        </div>
    </div>

    <!-- Owner's Financial Statistics -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border: 1px solid #FF007F;">
                <div class="stat-value" style="color: #FF007F; font-size: 1.8rem;">RM {{ "{:,.0f}".format(total_owner_expenses) }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">üí≥ Own's Expenses</div>
                <div class="stat-corner" style="background: #FF007F;"></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border: 1px solid #FF007F;">
                <div class="stat-value" style="color: #FF007F; font-size: 1.8rem;">RM {{ "{:,.0f}".format(abs(total_owner_payments)) }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">üí∞ Own's Payment</div>
                <div class="stat-corner" style="background: #FF007F;"></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border: 1px solid #FF007F;">
                <div class="stat-value" style="color: #FF007F; font-size: 1.8rem;">RM {{ "{:,.0f}".format(total_owner_balance) }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">üìä Own's OS Bal</div>
                <div class="stat-corner" style="background: #FF007F;"></div>
            </div>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('invoices_home') }}" style="text-decoration: none;">
                <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border: 1px solid #FF007F; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(255,0,127,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div class="stat-value" style="color: #FF007F; font-size: 1.8rem;">{{ invoices_count }}</div>
                    <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">üìã Supplier Invoices</div>
                    <div class="stat-corner" style="background: #FF007F;"></div>
                </div>
            </a>
        </div>
    </div>

    <!-- GZ's Financial Statistics -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.3) 0%, rgba(0, 0, 0, 0.95) 100%); border: 1px solid #322446;">
                <div class="stat-value" style="color: #FFFEF0; font-size: 1.8rem;">RM {{ "{:,.0f}".format(total_gz_expenses) }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); font-size: 0.9rem;">üè¢ GZ's Expenses</div>
                <div class="stat-corner" style="background: #322446;"></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.3) 0%, rgba(0, 0, 0, 0.95) 100%); border: 1px solid #322446;">
                <div class="stat-value" style="color: #FFFEF0; font-size: 1.8rem;">RM {{ "{:,.0f}".format(abs(total_gz_payments)) }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); font-size: 0.9rem;">üíµ GZ's Payment</div>
                <div class="stat-corner" style="background: #322446;"></div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.3) 0%, rgba(0, 0, 0, 0.95) 100%); border: 1px solid #322446;">
                <div class="stat-value" style="color: #FFFEF0; font-size: 1.8rem;">RM {{ "{:,.0f}".format(total_gz_balance) }}</div>
                <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); font-size: 0.9rem;">üìà GZ's OS Bal</div>
                <div class="stat-corner" style="background: #322446;"></div>
            </div>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('invoices_home') }}" style="text-decoration: none;">
                <div class="stat-card" style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.3) 0%, rgba(0, 0, 0, 0.95) 100%); border: 1px solid #322446; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(50,36,70,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div class="stat-value" style="color: #FFFEF0; font-size: 1.8rem;">RM {{ "{:,.2f}".format(invoices_total) }}</div>
                    <div class="stat-label" style="color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); font-size: 0.9rem;">üíº Total Invoices Amount</div>
                    <div class="stat-corner" style="background: #322446;"></div>
                </div>
            </a>
        </div>
    </div>

    <!-- Quick Actions - ‰∏ì‰∏öÁÆ°ÁêÜÊ®°Âùó -->
    <div class="row g-4 mb-5">
        <div class="col-12 mb-3">
            <h3 style="color: #FF007F; text-shadow: 0 0 15px rgba(255,0,127,0.5); font-weight: 700; font-size: 1.8rem; margin: 0;">
                <i class="bi bi-grid-3x3-gap-fill"></i> {{ t('management_center') }}
            </h3>
            <p style="color: #999; margin: 0.5rem 0 0 0; font-size: 0.95rem;">{{ t('select_module_to_manage') }}</p>
        </div>
        
        <!-- 1. ‰ø°Áî®Âç°Ë¥¶ÂçïÁÆ°ÁêÜ -->
        <div class="col-md-6 col-lg-3">
            <a href="#creditCardStatements" style="text-decoration: none;" onclick="document.getElementById('creditCardStatements').scrollIntoView({behavior: 'smooth'}); return false;">
                <div class="quick-action-card" style="
                    background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%);
                    border: 2px solid #FF007F;
                    border-radius: 15px;
                    padding: 2rem 1.5rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    height: 100%;
                " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 35px rgba(255,0,127,0.4)'; this.style.borderColor='#FF007F'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#FF007F'">
                    <div style="text-align: center; margin-bottom: 1.2rem;">
                        <i class="bi bi-credit-card" style="font-size: 3.5rem; color: #FF007F; text-shadow: 0 0 20px rgba(255,0,127,0.6);"></i>
                    </div>
                    <h4 style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; text-align: center; margin-bottom: 1rem; font-size: 1.2rem;">
                        {{ t('credit_card_statements_management') }}
                    </h4>
                    <div style="background: rgba(255,0,127,0.1); border-radius: 8px; padding: 0.8rem; text-align: center;">
                        <div style="color: #FF007F; font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 10px rgba(255,0,127,0.4);">
                            {{ cc_statements|length }}
                        </div>
                        <div style="color: #FFFEF0; font-size: 0.75rem; margin-top: 0.3rem;">{{ t('statement_count') }}</div>
                    </div>
                </div>
            </a>
        </div>

        <!-- 2. ÂÇ®ËìÑË¥¶Êà∑ÊúàÁªìÂçïÁÆ°ÁêÜ -->
        <div class="col-md-6 col-lg-3">
            <a href="#savingsStatements" style="text-decoration: none;" onclick="document.getElementById('savingsStatements').scrollIntoView({behavior: 'smooth'}); return false;">
                <div class="quick-action-card" style="
                    background: linear-gradient(135deg, rgba(50, 36, 70, 0.3) 0%, rgba(0, 0, 0, 0.95) 100%);
                    border: 2px solid #7B68EE;
                    border-radius: 15px;
                    padding: 2rem 1.5rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    height: 100%;
                    box-shadow: 0 0 15px rgba(123, 104, 238, 0.3);
                " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 40px rgba(123,104,238,0.6)'; this.style.borderColor='#FF007F'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 0 15px rgba(123,104,238,0.3)'; this.style.borderColor='#7B68EE'">
                    <div style="text-align: center; margin-bottom: 1.2rem;">
                        <i class="bi bi-bank" style="font-size: 3.5rem; color: #9370DB; text-shadow: 0 0 25px rgba(147,112,219,0.9), 0 0 40px rgba(123,104,238,0.6);"></i>
                    </div>
                    <h4 style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; text-align: center; margin-bottom: 1rem; font-size: 1.2rem;">
                        {{ t('savings_account_statements_management') }}
                    </h4>
                    <div style="background: rgba(123,104,238,0.2); border-radius: 8px; padding: 0.8rem; text-align: center; box-shadow: inset 0 0 20px rgba(123,104,238,0.3);">
                        <div style="color: #9370DB; font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 15px rgba(147,112,219,0.8), 0 0 25px rgba(123,104,238,0.5);">
                            {{ sa_statements|length }}
                        </div>
                        <div style="color: #FFFEF0; font-size: 0.75rem; margin-top: 0.3rem;">{{ t('statement_count') }}</div>
                    </div>
                </div>
            </a>
        </div>

        <!-- 3. ‰ªòÊ¨æÊî∂ÊçÆÁÆ°ÁêÜ -->
        <div class="col-md-6 col-lg-3">
            <a href="{{ url_for('receipts_home') }}" style="text-decoration: none;">
                <div class="quick-action-card" style="
                    background: linear-gradient(135deg, rgba(211, 211, 211, 0.12) 0%, rgba(0, 0, 0, 0.95) 100%);
                    border: 2px solid #D3D3D3;
                    border-radius: 15px;
                    padding: 2rem 1.5rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    height: 100%;
                " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 35px rgba(211,211,211,0.35)'; this.style.borderColor='#FF007F'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#D3D3D3'">
                    <div style="text-align: center; margin-bottom: 1.2rem;">
                        <i class="bi bi-receipt" style="font-size: 3.5rem; color: #D3D3D3; text-shadow: 0 0 20px rgba(211,211,211,0.6);"></i>
                    </div>
                    <h4 style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; text-align: center; margin-bottom: 1rem; font-size: 1.2rem;">
                        {{ t('receipts_management') }}
                    </h4>
                    <div style="background: rgba(211,211,211,0.12); border-radius: 8px; padding: 0.8rem; text-align: center;">
                        <div style="color: #D3D3D3; font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 15px rgba(211,211,211,0.5);">
                            {{ receipts_count }}
                        </div>
                        <div style="color: #FFFEF0; font-size: 0.75rem; margin-top: 0.3rem;">{{ t('receipt_total') }}</div>
                    </div>
                </div>
            </a>
        </div>

        <!-- 4. Supplier Invoices ÁÆ°ÁêÜ -->
        <div class="col-md-6 col-lg-3">
            <a href="{{ url_for('invoices_home') }}" style="text-decoration: none;">
                <div class="quick-action-card" style="
                    background: linear-gradient(135deg, rgba(220, 200, 150, 0.13) 0%, rgba(0, 0, 0, 0.95) 100%);
                    border: 2px solid #DCC896;
                    border-radius: 15px;
                    padding: 2rem 1.5rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    height: 100%;
                " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 35px rgba(220,200,150,0.35)'; this.style.borderColor='#FF007F'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#DCC896'">
                    <div style="text-align: center; margin-bottom: 1.2rem;">
                        <i class="bi bi-file-earmark-text-fill" style="font-size: 3.5rem; color: #DCC896; text-shadow: 0 0 20px rgba(220,200,150,0.5);"></i>
                    </div>
                    <h4 style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; text-align: center; margin-bottom: 1rem; font-size: 1.2rem;">
                        {{ t('supplier_invoices_management') }}
                    </h4>
                    <div style="background: rgba(220,200,150,0.13); border-radius: 8px; padding: 0.8rem; text-align: center;">
                        <div style="color: #DCC896; font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 15px rgba(220,200,150,0.5);">
                            {{ invoices_count }}
                        </div>
                        <div style="color: #FFFEF0; font-size: 0.75rem; margin-top: 0.3rem;">{{ t('invoice_total') }}</div>
                    </div>
                </div>
            </a>
        </div>

        <!-- 5. Monthly Summary Reports -->
        <div class="col-md-6 col-lg-3">
            <a href="{{ url_for('monthly_summary_index') }}" style="text-decoration: none;">
                <div class="quick-action-card" style="
                    background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(0, 0, 0, 0.95) 100%);
                    border: 2px solid #FFD700;
                    border-radius: 15px;
                    padding: 2rem 1.5rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    height: 100%;
                " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 35px rgba(255,215,0,0.4)'; this.style.borderColor='#FF007F'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#FFD700'">
                    <div style="text-align: center; margin-bottom: 1.2rem;">
                        <i class="bi bi-file-earmark-bar-graph-fill" style="font-size: 3.5rem; color: #FFD700; text-shadow: 0 0 20px rgba(255,215,0,0.6);"></i>
                    </div>
                    <h4 style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; text-align: center; margin-bottom: 1rem; font-size: 1.2rem;">
                        Monthly Summary Reports
                    </h4>
                    <div style="background: rgba(255,215,0,0.15); border-radius: 8px; padding: 0.8rem; text-align: center;">
                        <div style="color: #FFD700; font-size: 1.2rem; font-weight: 700; text-shadow: 0 0 15px rgba(255,215,0,0.5);">
                            View Reports
                        </div>
                        <div style="color: #FFFEF0; font-size: 0.75rem; margin-top: 0.3rem;">Supplier Expenses & Payments</div>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Credit Card Customers Table -->
    <div class="row g-4 mb-5" id="creditCardCustomers">
        <div class="col-12">
            <div class="statement-card" style="border: 2px solid #FF007F;">
                <div class="card-header-custom" style="background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border-bottom: 2px solid #FF007F;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem;">
                        <h3 class="card-title-custom" style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; margin: 0;">
                            <i class="bi bi-credit-card"></i> Credit Card Customers
                        </h3>
                        <span style="background: rgba(255,0,127,0.2); padding: 0.5rem 1rem; border-radius: 8px; color: #FF007F; font-weight: 700;">
                            {{ credit_card_customers|length }} Customers
                        </span>
                    </div>
                </div>
                <div class="card-body-custom" style="padding: 0;">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover elegant-table" style="margin: 0; width: 100%;">
                            <thead style="background: rgba(255, 0, 127, 0.1); border-bottom: 2px solid #FF007F;">
                                <tr>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">Customer Name</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">Email</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">Phone</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">Monthly Income</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); text-align: center;">Total Cards</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); text-align: center;">Total Statements</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; text-align: center;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if credit_card_customers %}
                                    {% for customer in credit_card_customers %}
                                    <tr class="hover-glow-row">
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">
                                            {{ customer['name'] }}
                                        </td>
                                        <td style="font-size: 0.75rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); color: #999;">
                                            {{ customer['email'] if customer['email'] else '-' }}
                                        </td>
                                        <td style="font-size: 0.75rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); color: #999;">
                                            {{ customer['phone'] if customer['phone'] else '-' }}
                                        </td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FF007F;">
                                            RM {{ "{:,.0f}".format(customer['monthly_income']) if customer['monthly_income'] else '-' }}
                                        </td>
                                        <td style="font-size: 0.85rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); text-align: center; font-weight: 700; color: #FF007F;">
                                            {{ customer['total_cards'] }}
                                        </td>
                                        <td style="font-size: 0.85rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); text-align: center; font-weight: 700; color: #FFF;">
                                            {{ customer['total_statements'] }}
                                        </td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; text-align: center;">
                                            <a href="{{ url_for('credit_card_ledger', customer_id=customer['id']) }}" 
                                               class="btn btn-sm btn-view-details"
                                               style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); 
                                                      border: 2px solid #FF007F; 
                                                      color: #FFFFFF;
                                                      font-weight: 600;
                                                      padding: 0.25rem 0.75rem;
                                                      font-size: 0.75rem;">
                                                View Ledger
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 3rem; color: #999;">
                                            No credit card customers found
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Savings Account Customers Table -->
    <div class="row g-4 mb-5" id="savingsCustomers">
        <div class="col-12">
            <div class="statement-card" style="border: 2px solid #7B68EE;">
                <div class="card-header-custom" style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.3) 0%, rgba(0, 0, 0, 0.95) 100%); border-bottom: 2px solid #7B68EE;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem;">
                        <h3 class="card-title-custom" style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; margin: 0;">
                            <i class="bi bi-bank"></i> Savings Account Customers
                        </h3>
                        <span style="background: rgba(123,104,238,0.3); padding: 0.5rem 1rem; border-radius: 8px; color: #9370DB; font-weight: 700;">
                            {{ savings_customers|length }} Customers
                        </span>
                    </div>
                </div>
                <div class="card-body-custom" style="padding: 0;">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover elegant-table" style="margin: 0; width: 100%;">
                            <thead style="background: rgba(50, 36, 70, 0.3); border-bottom: 2px solid #7B68EE;">
                                <tr>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">Customer Name</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">Email</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">Phone</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">Monthly Income</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); text-align: center;">Total Accounts</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); text-align: center;">Total Statements</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; text-align: center;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if savings_customers %}
                                    {% for customer in savings_customers %}
                                    <tr class="hover-glow-row">
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">
                                            {{ customer['name'] }}
                                        </td>
                                        <td style="font-size: 0.75rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); color: #999;">
                                            {{ customer['email'] if customer['email'] else '-' }}
                                        </td>
                                        <td style="font-size: 0.75rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); color: #999;">
                                            {{ customer['phone'] if customer['phone'] else '-' }}
                                        </td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #9370DB;">
                                            RM {{ "{:,.0f}".format(customer['monthly_income']) if customer['monthly_income'] else '-' }}
                                        </td>
                                        <td style="font-size: 0.85rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); text-align: center; font-weight: 700; color: #9370DB;">
                                            {{ customer['total_accounts'] }}
                                        </td>
                                        <td style="font-size: 0.85rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); text-align: center; font-weight: 700; color: #FFF;">
                                            {{ customer['total_statements'] }}
                                        </td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; text-align: center;">
                                            <a href="{{ url_for('savings_customers') }}" 
                                               class="btn btn-sm btn-view-details"
                                               style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); 
                                                      border: 2px solid #7B68EE; 
                                                      color: #FFFFFF;
                                                      font-weight: 600;
                                                      padding: 0.25rem 0.75rem;
                                                      font-size: 0.75rem;">
                                                View Accounts
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 3rem; color: #999;">
                                            No savings account customers found
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Credit Card Statements Card -->
    <div class="row g-4 mb-5" id="creditCardStatements">
        <div class="col-12">
            <div class="statement-card" style="border: 2px solid #FF007F;">
                <div class="card-header-custom" style="background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border-bottom: 2px solid #FF007F;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem;">
                        <h3 class="card-title-custom" style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; margin: 0;">
                            <i class="bi bi-credit-card"></i> {{ t('credit_card_statements') }}
                        </h3>
                        <button id="exportCCTable" class="btn btn-sm" style="background: #FF007F; color: white; border: none;">
                            <i class="bi bi-download"></i> Export Excel
                        </button>
                    </div>
                </div>
                <div class="card-body-custom" style="padding: 0;">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover elegant-table" style="margin: 0; width: 100%; table-layout: auto;">
                            <thead style="background: rgba(255, 0, 127, 0.1); border-bottom: 2px solid #FF007F;">
                                <tr>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">{{ t('month_of_statement') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">{{ t('name') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">{{ t('bank') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">PRE BAL</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">Statement OS</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">{{ t('due_date') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">{{ t('owner_expenses') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">GZ Expenses</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">{{ t('owner_payments') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">GZ Payments</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">{{ t('owner_os_bal') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1);">GZ Balance</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; text-align: center; color: #FFFFFF; text-shadow: 0 0 8px rgba(255,255,255,0.3);">{{ t('actions') }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if cc_statements %}
                                    {% for stmt in cc_statements %}
                                    <tr class="hover-glow-row">
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFFFF; text-shadow: 0 0 8px rgba(255,255,255,0.3); white-space: nowrap;">{{ stmt['statement_date'][:7] }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; white-space: nowrap;">{{ stmt['customer_name'] }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFFFF; text-shadow: 0 0 8px rgba(255,255,255,0.3); white-space: nowrap;">{{ stmt['bank_abbr'] }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['prev_bal']) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 700; color: #FFFFFF; text-shadow: 0 0 8px rgba(255,255,255,0.3); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['closing_balance']) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); white-space: nowrap;">{{ stmt['due_date'] if stmt['due_date'] else '-' }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 700; color: #FF007F; text-shadow: 0 0 6px rgba(255,255,255,0.25); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['owner_expenses']) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 700; color: #FFFFFF; text-shadow: 0 0 10px rgba(255,255,255,0.4); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['infinite_expenses']) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 700; color: #FF007F; text-shadow: 0 0 6px rgba(255,255,255,0.25); white-space: nowrap;">RM {{ "{:,.2f}".format(abs(stmt['owner_payments'])) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 700; color: #FFFFFF; text-shadow: 0 0 10px rgba(255,255,255,0.4); white-space: nowrap;">RM {{ "{:,.2f}".format(abs(stmt['infinite_payments'])) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 700; color: #FF007F; text-shadow: 0 0 6px rgba(255,255,255,0.25); white-space: nowrap;">
                                            RM {{ "{:,.2f}".format(stmt['owner_os_bal']) }}
                                        </td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 700; color: #FFFFFF; text-shadow: 0 0 10px rgba(255,255,255,0.4); white-space: nowrap;">
                                            RM {{ "{:,.2f}".format(stmt['infinite_os_bal']) }}
                                        </td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; text-align: center; white-space: nowrap;">
                                            <a href="{{ url_for('monthly_statement_detail', monthly_statement_id=stmt['statement_id']) }}" 
                                               class="btn btn-sm btn-view-details"
                                               style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); 
                                                      border: 2px solid #FF007F; 
                                                      color: #FFFFFF;
                                                      text-shadow: 0 0 8px rgba(255,255,255,0.3);
                                                      font-weight: 600;
                                                      padding: 0.25rem 0.75rem;
                                                      font-size: 0.75rem;
                                                      margin-right: 0.5rem;">
                                                {{ t('view_details') }}
                                            </a>
                                            <button 
                                               class="btn btn-sm"
                                               onclick="openEditModal({{ stmt['statement_id'] }}, '{{ stmt['customer_name'] }}', '{{ stmt['bank_abbr'] }}', '{{ stmt['statement_date'][:7] }}', {{ stmt['prev_bal'] }}, {{ stmt['owner_os_bal'] }}, {{ stmt['infinite_os_bal'] }}, {{ stmt['owner_expenses'] }}, {{ stmt['owner_payments'] }}, {{ stmt['infinite_expenses'] }}, {{ stmt['infinite_payments'] }}, {{ stmt['closing_balance'] }})"
                                               style="background: linear-gradient(135deg, #322446 0%, #4a3268 100%); 
                                                      border: 2px solid #FF007F; 
                                                      color: #FFFFFF;
                                                      text-shadow: 0 0 8px rgba(255,255,255,0.3);
                                                      font-weight: 600;
                                                      padding: 0.25rem 0.75rem;
                                                      font-size: 0.75rem;">
                                                <i class="bi bi-pencil-square"></i> Edit
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="13" style="text-align: center; padding: 3rem; color: #999;">
                                            {{ t('no_cc_statements_found') }}
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bank Account Statements Card -->
    <div class="row g-4 mb-5" id="savingsStatements">
        <div class="col-12">
            <div class="statement-card" style="border: 2px solid #322446;">
                <div class="card-header-custom" style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.3) 0%, rgba(0, 0, 0, 0.95) 100%); border-bottom: 2px solid #322446;">
                    <h3 class="card-title-custom" style="color: #FFFEF0; text-shadow: 0 0 10px rgba(255,254,240,0.4); font-weight: 700; margin: 0; padding: 1.5rem;">
                        <i class="bi bi-bank"></i> {{ t('bank_account_statements') }}
                    </h3>
                </div>
                <div class="card-body-custom" style="padding: 0;">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover elegant-table" style="margin: 0; width: 100%; table-layout: auto;">
                            <thead style="background: rgba(50, 36, 70, 0.3); border-bottom: 2px solid #322446;">
                                <tr>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('month_of_statement') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('name') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('bank') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('monthly_credit') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('monthly_debit') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('closing_bal') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('cc_sum_payment') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.1); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('total_transfer') }}</th>
                                    <th style="font-size: 0.85rem; padding: 1rem 1.2rem; text-align: center; color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3);">{{ t('actions') }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if sa_statements %}
                                    {% for stmt in sa_statements %}
                                    <tr class="hover-glow-row">
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">{{ stmt['statement_date'][:7] }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">{{ stmt['customer_name'] }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">{{ stmt['bank_abbr'] }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['monthly_credit']) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['monthly_debit']) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['closing_bal'] if stmt['closing_bal'] else 0) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['cc_sum_payment']) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; border-right: 1px solid rgba(255,255,255,0.05); color: #FFFEF0; text-shadow: 0 0 8px rgba(255,254,240,0.3); white-space: nowrap;">RM {{ "{:,.2f}".format(stmt['total_transfer']) }}</td>
                                        <td style="font-size: 0.80rem; padding: 0.9rem 1.2rem; text-align: center; white-space: nowrap;">
                                            <a href="{{ url_for('verify_savings_statement', statement_id=stmt['statement_id']) }}" 
                                               class="btn btn-sm btn-view-details"
                                               style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); 
                                                      border: 2px solid #322446; 
                                                      color: #FFFEF0;
                                                      text-shadow: 0 0 8px rgba(255,254,240,0.3);
                                                      font-weight: 600;
                                                      padding: 0.25rem 0.75rem;
                                                      font-size: 0.75rem;">
                                                {{ t('view_details') }}
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="9" style="text-align: center; padding: 3rem; color: #999;">
                                            {{ t('no_sa_statements_found') }}
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.stat-card {
    background: linear-gradient(135deg, rgba(15, 15, 15, 0.95) 0%, rgba(26, 26, 26, 0.95) 100%);
    border: 1px solid rgba(192, 192, 192, 0.2);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.stat-value {
    font-family: 'Montserrat', sans-serif;
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, #FFFFFF 0%, rgba(192, 192, 192, 0.9) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #A1A1AA;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.stat-corner {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, transparent 50%, rgba(255, 255, 255, 0.05) 50%);
}

.statement-card {
    background: #000000;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
}

.elegant-table {
    background: #000000;
}

.elegant-table thead th {
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.9rem;
    padding: 1.2rem;
    border: none;
    white-space: nowrap;
}

.elegant-table tbody td {
    padding: 1rem 1.2rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    vertical-align: middle;
    white-space: nowrap;
}

.hover-glow-row {
    transition: all 0.3s ease;
}

.hover-glow-row:hover {
    background: rgba(255, 255, 255, 0.03) !important;
    transform: translateX(5px);
}

.btn-view-details {
    transition: all 0.3s ease;
    white-space: nowrap;
}

.btn-view-details:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 0, 127, 0.4);
}

.datatable-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: rgba(255, 255, 255, 0.02);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.datatable-pagination {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.datatable-pagination button {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.datatable-pagination button:hover:not(:disabled) {
    background: rgba(255, 0, 127, 0.2);
    border-color: #FF007F;
}

.datatable-pagination button:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.datatable-pagination button.active {
    background: #FF007F;
    border-color: #FF007F;
}
</style>

<script>
// Simple DataTable Implementation with Pagination and Export
class SimpleDataTable {
    constructor(tableId, options = {}) {
        this.table = document.getElementById(tableId);
        this.currentPage = 1;
        this.rowsPerPage = options.rowsPerPage || 25;
        this.rows = [];
        this.init();
    }

    init() {
        if (!this.table) return;
        
        // Get all rows except header
        const tbody = this.table.querySelector('tbody');
        if (!tbody) return;
        
        this.rows = Array.from(tbody.querySelectorAll('tr'));
        
        // Add controls
        this.addControls();
        
        // Display first page
        this.displayPage(1);
    }

    addControls() {
        const wrapper = this.table.closest('.table-responsive');
        if (!wrapper) return;

        const controls = document.createElement('div');
        controls.className = 'datatable-controls';
        controls.innerHTML = `
            <div>
                <span style="color: #999;">Show: </span>
                <select id="${this.table.id}_pageSize" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 0.25rem 0.5rem; border-radius: 4px;">
                    <option value="10">10</option>
                    <option value="25" selected>25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="-1">All</option>
                </select>
                <span style="color: #999; margin-left: 1rem;">entries</span>
            </div>
            <div id="${this.table.id}_pagination" class="datatable-pagination"></div>
        `;
        
        wrapper.insertBefore(controls, this.table);

        // Page size change handler
        document.getElementById(`${this.table.id}_pageSize`).addEventListener('change', (e) => {
            this.rowsPerPage = parseInt(e.target.value);
            this.currentPage = 1;
            this.displayPage(1);
        });
    }

    displayPage(page) {
        const totalRows = this.rows.length;
        const totalPages = this.rowsPerPage === -1 ? 1 : Math.ceil(totalRows / this.rowsPerPage);
        
        this.currentPage = Math.max(1, Math.min(page, totalPages));

        // Hide all rows first
        this.rows.forEach(row => row.style.display = 'none');

        // Show rows for current page
        if (this.rowsPerPage === -1) {
            // Show all
            this.rows.forEach(row => row.style.display = '');
        } else {
            const start = (this.currentPage - 1) * this.rowsPerPage;
            const end = start + this.rowsPerPage;
            
            for (let i = start; i < end && i < totalRows; i++) {
                this.rows[i].style.display = '';
            }
        }

        // Update pagination buttons
        this.updatePagination(totalPages);
    }

    updatePagination(totalPages) {
        const paginationDiv = document.getElementById(`${this.table.id}_pagination`);
        if (!paginationDiv) return;

        let html = '';
        
        // Previous button
        html += `<button ${this.currentPage === 1 ? 'disabled' : ''} onclick="window.${this.table.id}_dt.displayPage(${this.currentPage - 1})">‚Äπ Prev</button>`;
        
        // Page numbers
        const maxButtons = 5;
        let startPage = Math.max(1, this.currentPage - Math.floor(maxButtons / 2));
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);
        
        if (endPage - startPage < maxButtons - 1) {
            startPage = Math.max(1, endPage - maxButtons + 1);
        }

        for (let i = startPage; i <= endPage; i++) {
            html += `<button class="${i === this.currentPage ? 'active' : ''}" onclick="window.${this.table.id}_dt.displayPage(${i})">${i}</button>`;
        }
        
        // Next button
        html += `<button ${this.currentPage === totalPages ? 'disabled' : ''} onclick="window.${this.table.id}_dt.displayPage(${this.currentPage + 1})">Next ‚Ä∫</button>`;
        
        paginationDiv.innerHTML = html;
    }
}

// Export to Excel (CSV format)
function exportTableToExcel(tableId, filename = 'export.csv') {
    const table = document.getElementById(tableId);
    if (!table) return;

    const rows = table.querySelectorAll('tr');
    const csv = [];

    rows.forEach(row => {
        const cols = row.querySelectorAll('td, th');
        const rowData = [];
        
        cols.forEach(col => {
            // Clean text and handle special characters
            let text = col.innerText || col.textContent;
            text = text.replace(/"/g, '""'); // Escape quotes
            
            // Skip "View Details" buttons
            if (!text.includes('View Details')) {
                rowData.push(`"${text}"`);
            }
        });
        
        if (rowData.length > 0) {
            csv.push(rowData.join(','));
        }
    });

    // Create download link
    const csvContent = csv.join('\n');
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', filename);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    // Initialize datatables
    window.ccStatementsTable_dt = new SimpleDataTable('ccStatementsTable', { rowsPerPage: 25 });
    
    // Export button handlers
    document.getElementById('exportCCTable')?.addEventListener('click', function() {
        exportTableToExcel('ccStatementsTable', 'Credit_Card_Statements.csv');
    });
});

// TEST FUNCTION
function testEditFunction() {
    const resultDiv = document.getElementById('test_result');
    resultDiv.innerHTML = '‚è≥ Ê≠£Âú®ÊµãËØï...';
    
    try {
        // Test 1: Check if modal exists
        const modalElement = document.getElementById('editStatementModal');
        if (!modalElement) {
            resultDiv.innerHTML = '‚ùå ÈîôËØØÔºöÊâæ‰∏çÂà∞ÁºñËæëÂØπËØùÊ°ÜÂÖÉÁ¥†ÔºÅ';
            return;
        }
        
        // Test 2: Try to open modal
        const modal = new bootstrap.Modal(modalElement);
        modal.show();
        
        // Test 3: Fill test data
        setTimeout(() => {
            document.getElementById('edit_prev_bal').value = '123.45';
            document.getElementById('edit_gz_bal').value = '678.90';
            
            // Test 4: Try to focus on input
            const input = document.getElementById('edit_prev_bal');
            input.focus();
            
            resultDiv.innerHTML = `
                ‚úÖ <strong>ÊµãËØïÊàêÂäüÔºÅ</strong><br>
                - ÂØπËØùÊ°ÜÂ∑≤ÂºπÂá∫<br>
                - ËæìÂÖ•Ê°ÜÂ∑≤Â°´ÂÖÖÊµãËØïÊï∞ÊçÆ<br>
                - ËæìÂÖ•Ê°ÜÂ∑≤ËÅöÁÑ¶<br>
                <br>
                <strong style="color: #FF007F;">üëâ ËØ∑Â∞ùËØïÂú®ËæìÂÖ•Ê°Ü‰∏≠ËæìÂÖ•Êï∞Â≠óÔºÅ</strong><br>
                <small>Â¶ÇÊûúËøòÊòØÊó†Ê≥ïËæìÂÖ•ÔºåËØ∑ÂëäËØâÊàëÊÇ®ÁúãÂà∞‰∫Ü‰ªÄ‰πà„ÄÇ</small>
            `;
        }, 500);
        
    } catch (error) {
        resultDiv.innerHTML = '‚ùå ÈîôËØØÔºö' + error.message;
    }
}

function openEditModal(stmtId, customerName, bank, month, prevBal, ownerBal, gzBal, ownerExp, ownerPay, gzExp, gzPay, closingBal) {
    // Fill modal with statement info
    document.getElementById('edit_statement_id').value = stmtId;
    document.getElementById('modal_customer_name').textContent = customerName;
    document.getElementById('modal_bank').textContent = bank;
    document.getElementById('modal_month').textContent = month;
    
    // Fill editable fields
    document.getElementById('edit_prev_bal').value = prevBal.toFixed(2);
    document.getElementById('edit_owner_bal').value = ownerBal.toFixed(2);
    document.getElementById('edit_gz_bal').value = gzBal.toFixed(2);
    document.getElementById('edit_owner_expenses').value = ownerExp.toFixed(2);
    document.getElementById('edit_owner_payments').value = Math.abs(ownerPay).toFixed(2);
    document.getElementById('edit_gz_expenses').value = gzExp.toFixed(2);
    document.getElementById('edit_gz_payments').value = Math.abs(gzPay).toFixed(2);
    document.getElementById('edit_closing_bal').value = closingBal.toFixed(2);
    
    // Show modal
    var editModal = new bootstrap.Modal(document.getElementById('editStatementModal'));
    editModal.show();
}

function saveStatementEdit() {
    const stmtId = document.getElementById('edit_statement_id').value;
    const formData = {
        previous_balance: parseFloat(document.getElementById('edit_prev_bal').value),
        owner_balance: parseFloat(document.getElementById('edit_owner_bal').value),
        gz_balance: parseFloat(document.getElementById('edit_gz_bal').value),
        owner_expenses: parseFloat(document.getElementById('edit_owner_expenses').value),
        owner_payments: -Math.abs(parseFloat(document.getElementById('edit_owner_payments').value)),
        gz_expenses: parseFloat(document.getElementById('edit_gz_expenses').value),
        gz_payments: -Math.abs(parseFloat(document.getElementById('edit_gz_payments').value)),
        closing_balance: parseFloat(document.getElementById('edit_closing_bal').value)
    };
    
    // Send update request
    fetch('/monthly_statement/' + stmtId + '/edit', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ ' + data.message);
            location.reload(); // Reload page to show updated values
        } else {
            alert('‚ùå ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('‚ùå Êõ¥Êñ∞Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ');
    });
}
</script>

<!-- Edit Statement Modal -->
<div class="modal fade" id="editStatementModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background: #1a1a1a; border: 2px solid #FF007F;">
            <div class="modal-header" style="border-bottom: 2px solid #FF007F;">
                <h5 class="modal-title" style="color: #FF007F; font-weight: 700;">
                    <i class="bi bi-pencil-square"></i> ÁºñËæëÊúàÂ∫¶Ë¥¶Âçï / Edit Monthly Statement
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="color: #FFFEF0;">
                <div class="alert alert-info" style="background: rgba(255,0,127,0.15); border: 1px solid #FF007F; color: #FFFFFF;">
                    <strong>üìù ÊèêÁ§∫Ôºö</strong> ËØ∑Áõ¥Êé•ÁÇπÂáª‰∏ãÈù¢ÁöÑËæìÂÖ•Ê°ÜÔºåÁÑ∂ÂêéËæìÂÖ•Êñ∞ÁöÑÊï∞ÂÄº„ÄÇËæìÂÖ•Ê°ÜËÉåÊôØÊòØÊ∑±Ëâ≤ÁöÑÔºåÁÇπÂáªÂêé‰ºöÊúâÁôΩËâ≤ÂÖâÊ†áÈó™ÁÉÅ„ÄÇ
                </div>
                <form id="editStatementForm">
                    <input type="hidden" id="edit_statement_id" name="statement_id">
                    
                    <!-- Statement Info -->
                    <div class="mb-4 p-3" style="background: rgba(255,0,127,0.1); border: 1px solid #FF007F; border-radius: 8px;">
                        <div class="row">
                            <div class="col-md-4">
                                <strong style="color: #FF007F;">ÂÆ¢Êà∑ / Customer:</strong><br>
                                <span id="modal_customer_name"></span>
                            </div>
                            <div class="col-md-4">
                                <strong style="color: #FF007F;">Èì∂Ë°å / Bank:</strong><br>
                                <span id="modal_bank"></span>
                            </div>
                            <div class="col-md-4">
                                <strong style="color: #FF007F;">Ë¥¶ÂçïÊúà / Month:</strong><br>
                                <span id="modal_month"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Editable Fields -->
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label" style="color: #FFFEF0; font-weight: 600;">
                                <i class="bi bi-arrow-left-circle"></i> Previous Balance / ÂâçÊúü‰ΩôÈ¢ù
                            </label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: #322446; color: #FFFEF0; border-color: #FF007F;">RM</span>
                                <input type="text" 
                                       class="form-control" 
                                       id="edit_prev_bal" 
                                       name="previous_balance" 
                                       style="background: white !important; 
                                              color: black !important; 
                                              border: 2px solid #FF007F !important; 
                                              font-size: 18px !important; 
                                              padding: 10px !important;
                                              pointer-events: auto !important;
                                              user-select: text !important;" 
                                       placeholder="ËæìÂÖ•Êï∞Â≠ó / Enter number">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" style="color: #FFFEF0; font-weight: 600;">
                                <i class="bi bi-check-circle"></i> Closing Balance / ÊúüÊú´‰ΩôÈ¢ù
                            </label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: #322446; color: #FFFEF0; border-color: #FF007F;">RM</span>
                                <input type="text" 
                                       class="form-control" 
                                       id="edit_closing_bal" 
                                       name="closing_balance" 
                                       style="background: white !important; 
                                              color: black !important; 
                                              border: 2px solid #FF007F !important; 
                                              font-size: 18px !important; 
                                              padding: 10px !important;
                                              pointer-events: auto !important;
                                              user-select: text !important;" 
                                       placeholder="ËæìÂÖ•Êï∞Â≠ó / Enter number">
                            </div>
                        </div>

                        <div class="col-12"><hr style="border-color: rgba(255,0,127,0.3);"></div>

                        <div class="col-md-6">
                            <label class="form-label" style="color: #FF007F; font-weight: 600;">
                                üí≥ OWNER Expenses / OWNERÊ∂àË¥π
                            </label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: #322446; color: #FF007F; border-color: #FF007F;">RM</span>
                                <input type="text" 
                                       class="form-control" 
                                       id="edit_owner_expenses" 
                                       name="owner_expenses" 
                                       style="background: white !important; 
                                              color: black !important; 
                                              border: 2px solid #FF007F !important; 
                                              font-size: 18px !important; 
                                              padding: 10px !important;
                                              pointer-events: auto !important;
                                              user-select: text !important;" 
                                       placeholder="ËæìÂÖ•Êï∞Â≠ó / Enter number">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" style="color: #FF007F; font-weight: 600;">
                                üí∞ OWNER Payments / OWNERËøòÊ¨æ
                            </label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: #322446; color: #FF007F; border-color: #FF007F;">RM</span>
                                <input type="text" 
                                       class="form-control" 
                                       id="edit_owner_payments" 
                                       name="owner_payments" 
                                       style="background: white !important; 
                                              color: black !important; 
                                              border: 2px solid #FF007F !important; 
                                              font-size: 18px !important; 
                                              padding: 10px !important;
                                              pointer-events: auto !important;
                                              user-select: text !important;" 
                                       placeholder="ËæìÂÖ•Êï∞Â≠ó / Enter number">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" style="color: #FFFEF0; font-weight: 600;">
                                üè¢ INFINITE Expenses / INFINITEÊ∂àË¥π
                            </label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: #322446; color: #FFFFFF; border-color: #322446;">RM</span>
                                <input type="text" 
                                       class="form-control" 
                                       id="edit_gz_expenses" 
                                       name="gz_expenses" 
                                       style="background: white !important; 
                                              color: black !important; 
                                              border: 2px solid #FF007F !important; 
                                              font-size: 18px !important; 
                                              padding: 10px !important;
                                              pointer-events: auto !important;
                                              user-select: text !important;" 
                                       placeholder="ËæìÂÖ•Êï∞Â≠ó / Enter number">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" style="color: #FFFEF0; font-weight: 600;">
                                üíµ INFINITE Payments / INFINITEËøòÊ¨æ
                            </label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: #322446; color: #FFFFFF; border-color: #322446;">RM</span>
                                <input type="text" 
                                       class="form-control" 
                                       id="edit_gz_payments" 
                                       name="gz_payments" 
                                       style="background: white !important; 
                                              color: black !important; 
                                              border: 2px solid #FF007F !important; 
                                              font-size: 18px !important; 
                                              padding: 10px !important;
                                              pointer-events: auto !important;
                                              user-select: text !important;" 
                                       placeholder="ËæìÂÖ•Êï∞Â≠ó / Enter number">
                            </div>
                        </div>

                        <div class="col-12"><hr style="border-color: rgba(255,0,127,0.3);"></div>

                        <div class="col-md-6">
                            <label class="form-label" style="color: #FF007F; font-weight: 600;">
                                üìä OWNER Balance / OWNER‰ΩôÈ¢ù
                            </label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: #322446; color: #FF007F; border-color: #FF007F;">RM</span>
                                <input type="text" 
                                       class="form-control" 
                                       id="edit_owner_bal" 
                                       name="owner_balance" 
                                       style="background: white !important; 
                                              color: black !important; 
                                              border: 2px solid #FF007F !important; 
                                              font-size: 18px !important; 
                                              padding: 10px !important;
                                              pointer-events: auto !important;
                                              user-select: text !important;" 
                                       placeholder="ËæìÂÖ•Êï∞Â≠ó / Enter number">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label" style="color: #FFFEF0; font-weight: 600;">
                                üìà INFINITE Balance / INFINITE‰ΩôÈ¢ù
                            </label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: #322446; color: #FFFFFF; border-color: #322446;">RM</span>
                                <input type="text" 
                                       class="form-control" 
                                       id="edit_gz_bal" 
                                       name="gz_balance" 
                                       style="background: white !important; 
                                              color: black !important; 
                                              border: 2px solid #FF007F !important; 
                                              font-size: 18px !important; 
                                              padding: 10px !important;
                                              pointer-events: auto !important;
                                              user-select: text !important;" 
                                       placeholder="ËæìÂÖ•Êï∞Â≠ó / Enter number">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="border-top: 2px solid #FF007F;">
                <button type="button" class="btn" style="background: #322446; color: #FFFEF0; border: 1px solid #999;" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> ÂèñÊ∂à / Cancel
                </button>
                <button type="button" class="btn" style="background: linear-gradient(135deg, #FF007F 0%, #c9005f 100%); color: #FFFFFF; border: none;" onclick="saveStatementEdit()">
                    <i class="bi bi-save"></i> ‰øùÂ≠ò / Save Changes
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
