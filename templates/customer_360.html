<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer 360° - Loan Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/galaxy-theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/customer_360.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: #000; border-bottom: 2px solid #FF007F;">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-person-circle" style="color: #FF007F;"></i>
                <span style="color: #fff; margin-left: 10px;">Customer 360°</span>
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard" style="color: #FF007F;">
                    <i class="bi bi-house-door"></i> Dashboard
                </a>
                <a class="nav-link" href="/loan-evaluate" style="color: #FF007F;">
                    <i class="bi bi-calculator"></i> Loan Evaluate
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid customer-360-container">
        <div class="page-header">
            <h1><i class="bi bi-person-badge"></i> Customer 360° Loan Profile</h1>
            <p class="subtitle">Comprehensive Credit & Loan Intelligence Dashboard</p>
        </div>

        <div class="customer-info-banner" id="customerBanner">
            <div class="customer-name">
                <i class="bi bi-person-circle"></i>
                <span id="customerName">Loading...</span>
            </div>
            <div class="customer-id">
                <span>Customer ID: <strong id="customerId">-</strong></span>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="panel credit-profile-panel">
                <div class="panel-header">
                    <h2><i class="bi bi-shield-check"></i> Credit Profile Overview</h2>
                </div>
                <div class="panel-body">
                    <div class="risk-grade-section">
                        <div class="risk-grade-badge" id="riskGradeBadge">
                            <div class="grade-text">-</div>
                            <div class="grade-label">Risk Grade</div>
                        </div>
                        <div class="approval-odds-circle">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <circle cx="90" cy="90" r="75" fill="none" stroke="#322446" stroke-width="15"/>
                                <circle id="approvalOddsArc" cx="90" cy="90" r="75" fill="none" stroke="#FF007F" stroke-width="15" 
                                    stroke-dasharray="471" stroke-dashoffset="471" 
                                    stroke-linecap="round" transform="rotate(-90 90 90)"/>
                            </svg>
                            <div class="odds-text">
                                <span id="approvalOddsValue">-</span>%
                                <div class="odds-label">Approval Odds</div>
                            </div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">DTI Ratio</div>
                            <div class="metric-value" id="dtiValue">-%</div>
                            <div class="metric-status" id="dtiStatus">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">FOIR</div>
                            <div class="metric-value" id="foirValue">-%</div>
                            <div class="metric-status" id="foirStatus">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">CCRIS Bucket</div>
                            <div class="metric-value" id="ccrisBucket">-</div>
                            <div class="metric-status" id="ccrisStatus">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">CTOS Score</div>
                            <div class="metric-value" id="ctosScore">-</div>
                            <div class="metric-status" id="ctosStatus">-</div>
                        </div>
                    </div>

                    <div class="income-summary">
                        <div class="summary-row">
                            <span class="summary-label">Monthly Income</span>
                            <span class="summary-value income-value" id="monthlyIncome">RM -</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Total Commitments</span>
                            <span class="summary-value commitment-value" id="totalCommitments">RM -</span>
                        </div>
                        <div class="summary-row highlight-row">
                            <span class="summary-label">Disposable Income</span>
                            <span class="summary-value disposable-value" id="disposableIncome">RM -</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel cashflow-panel">
                <div class="panel-header">
                    <h2><i class="bi bi-graph-up-arrow"></i> Cashflow Insights</h2>
                </div>
                <div class="panel-body">
                    <div class="chart-container">
                        <canvas id="cashflowChart"></canvas>
                    </div>
                    <div class="chart-container" style="margin-top: 30px;">
                        <canvas id="spendingHeatmapChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="panel loan-capabilities-panel">
                <div class="panel-header">
                    <h2><i class="bi bi-piggy-bank"></i> Loan Capabilities</h2>
                </div>
                <div class="panel-body">
                    <div class="capability-cards">
                        <div class="capability-card">
                            <div class="capability-icon">
                                <i class="bi bi-cash-coin"></i>
                            </div>
                            <div class="capability-label">Maximum EMI Capacity</div>
                            <div class="capability-value" id="maxEmi">RM -</div>
                        </div>
                        <div class="capability-card highlight">
                            <div class="capability-icon">
                                <i class="bi bi-currency-dollar"></i>
                            </div>
                            <div class="capability-label">Maximum Loan Amount</div>
                            <div class="capability-value" id="maxLoanAmount">RM -</div>
                        </div>
                        <div class="capability-card">
                            <div class="capability-icon">
                                <i class="bi bi-shield-fill-check"></i>
                            </div>
                            <div class="capability-label">Risk-Adjusted Amount</div>
                            <div class="capability-value" id="riskAdjustedAmount">RM -</div>
                        </div>
                    </div>

                    <div class="loan-simulator">
                        <h3><i class="bi bi-calculator-fill"></i> Loan Simulator</h3>
                        <div class="simulator-inputs">
                            <div class="input-group">
                                <label>Loan Amount (RM)</label>
                                <input type="number" id="simLoanAmount" class="form-control" placeholder="50000" min="1000" step="1000">
                            </div>
                            <div class="input-group">
                                <label>Tenure (months)</label>
                                <input type="number" id="simTenure" class="form-control" placeholder="60" min="12" max="360" step="12">
                            </div>
                            <button class="btn-simulate" onclick="simulateLoan()">
                                <i class="bi bi-play-circle"></i> Simulate
                            </button>
                        </div>
                        <div class="simulator-results" id="simulatorResults" style="display: none;">
                            <div class="result-row">
                                <span>Monthly EMI</span>
                                <strong id="simEmi">RM -</strong>
                            </div>
                            <div class="result-row">
                                <span>New DTI</span>
                                <strong id="simDti" class="dti-value">-%</strong>
                            </div>
                            <div class="result-row">
                                <span>New FOIR</span>
                                <strong id="simFoir" class="foir-value">-%</strong>
                            </div>
                            <div class="result-row highlight-row">
                                <span>Approval Odds Impact</span>
                                <strong id="simApprovalOdds" class="odds-value">-%</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel product-matches-panel">
                <div class="panel-header">
                    <h2><i class="bi bi-stars"></i> Personalized Product Matches</h2>
                </div>
                <div class="panel-body">
                    <div id="productMatchesList">
                        <div class="loading-state">
                            <i class="bi bi-hourglass-split"></i> Loading product recommendations...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/customer_360.js') }}"></script>
    <script>
        const customerId = "{{ customer_id }}";
        window.addEventListener('DOMContentLoaded', function() {
            initCustomer360Dashboard(customerId);
        });
    </script>
</body>
</html>
