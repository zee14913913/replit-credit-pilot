{% extends "base.html" %}

{% block title %}{{ t('smart_loan_matcher') }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Page Header -->
            <div class="text-center mb-5">
                <h1 class="galaxy-gradient-text mb-3">
                    <i class="bi bi-calculator-fill me-2"></i>{{ t('smart_loan_matcher') }}
                </h1>
                <p class="fs-5" style="color: #FF007F; font-weight: 700;">
                    {{ t('loan_matcher_subtitle') }}
                </p>
            </div>

            <!-- Features Card -->
            <div class="galaxy-card mb-5">
                <div class="card-body">
                    <!-- Section Header -->
                    <div class="section-header mb-5">
                        <h5 class="galaxy-gradient-text mb-3">
                            <i class="bi bi-info-circle-fill me-2"></i>{{ t('system_features') }}
                        </h5>
                        <div class="title-divider"></div>
                    </div>
                    
                    <!-- Content Area -->
                    <div class="row g-4">
                        <div class="col-md-4">
                            <div class="d-flex align-items-start">
                                <i class="bi bi-file-earmark-pdf text-golden fs-4 me-3"></i>
                                <div>
                                    <h6 class="text-white mb-1">{{ t('ctos_smart_parsing') }}</h6>
                                    <small class="text-silver-pearl">{{ t('ctos_smart_parsing_desc') }}</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex align-items-start">
                                <i class="bi bi-graph-up-arrow text-golden fs-4 me-3"></i>
                                <div>
                                    <h6 class="text-white mb-1">{{ t('dsr_calculation') }}</h6>
                                    <small class="text-silver-pearl">{{ t('dsr_calculation_desc') }}</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex align-items-start">
                                <i class="bi bi-bank text-golden fs-4 me-3"></i>
                                <div>
                                    <h6 class="text-white mb-1">{{ t('smart_product_matching') }}</h6>
                                    <small class="text-silver-pearl">{{ t('smart_product_matching_desc') }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Information Form -->
            <div class="galaxy-card">
                <div class="card-body">
                    <!-- Section Header -->
                    <div class="section-header mb-5">
                        <h5 class="galaxy-gradient-text mb-3">
                            <i class="bi bi-person-badge-fill me-2"></i>{{ t('customer_information') }}
                        </h5>
                        <div class="title-divider"></div>
                    </div>
                    
                    <!-- Form Content -->
                    <form action="{{ url_for('loan_matcher_analyze') }}" method="post" enctype="multipart/form-data">
                        <div class="row g-5">
                            <!-- Basic Information -->
                            <div class="col-md-6">
                                <label class="form-label text-silver-pearl">
                                    <i class="bi bi-person-fill me-2"></i>{{ t('customer_name') }}
                                </label>
                                <input type="text" name="client_name" class="form-control galaxy-input" required placeholder="{{ t('customer_name_placeholder') }}">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label text-silver-pearl">
                                    <i class="bi bi-flag-fill me-2"></i>{{ t('citizenship') }}
                                </label>
                                <select name="citizenship" class="form-select galaxy-input">
                                    <option value="MY">{{ t('malaysian') }}</option>
                                    <option value="PR">{{ t('permanent_resident') }}</option>
                                    <option value="OTH">{{ t('foreigner') }}</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label text-silver-pearl">
                                    <i class="bi bi-calendar-check me-2"></i>{{ t('age') }}
                                </label>
                                <input type="number" name="age" class="form-control galaxy-input" required min="18" max="100" placeholder="18-100">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label text-silver-pearl">
                                    <i class="bi bi-cash-stack me-2"></i>{{ t('monthly_income_rm') }}
                                </label>
                                <input type="number" name="monthly_income" class="form-control galaxy-input" required step="0.01" min="0" placeholder="{{ t('income_placeholder') }}">
                            </div>

                            <!-- CTOS Upload -->
                            <div class="col-12 mt-4">
                                <div class="border border-golden border-opacity-25 rounded p-4" style="background: rgba(212, 175, 55, 0.05);">
                                    <label class="form-label text-golden fw-bold">
                                        <i class="bi bi-cloud-upload-fill me-2"></i>{{ t('upload_ctos_optional') }}
                                    </label>
                                    <div class="custom-file-upload mb-3">
                                        <input type="file" name="ctos_file" id="ctos_file_input" class="d-none" accept="application/pdf" onchange="updateFileName(this)">
                                        <label for="ctos_file_input" class="btn w-100 text-start d-flex justify-content-between align-items-center" 
                                               style="cursor: pointer;
                                                      background: rgba(20, 20, 20, 0.5);
                                                      border: 1px solid rgba(229, 228, 226, 0.3);
                                                      padding: 0.75rem 1rem;
                                                      transition: all 0.3s ease;">
                                            <span id="file_name_display" class="text-silver-pearl">{{ t('no_file_chosen') }}</span>
                                            <span class="nav-link-file-button">{{ t('choose_file') }}</span>
                                        </label>
                                    </div>
                                    <small class="text-silver-pearl d-block">
                                        <i class="bi bi-info-circle me-1"></i>
                                        {{ t('ctos_auto_extract_note') }}
                                    </small>
                                </div>
                            </div>

                            <!-- Manual Override -->
                            <div class="col-12">
                                <label class="form-label text-silver-pearl">
                                    <i class="bi bi-pencil-square me-2"></i>{{ t('monthly_commitment_manual') }}
                                </label>
                                <input type="number" name="manual_commitment" class="form-control galaxy-input" step="0.01" min="0" placeholder="{{ t('leave_blank_ctos') }}">
                                <small class="text-silver-pearl">
                                    {{ t('ctos_manual_note') }}
                                </small>
                            </div>
                            
                            <!-- Company Age (for SME Loans) -->
                            <div class="col-md-6">
                                <label class="form-label text-silver-pearl">
                                    <i class="bi bi-building me-2"></i>{{ t('company_operating_years') }}
                                </label>
                                <input type="number" name="company_age" class="form-control galaxy-input" min="0" placeholder="{{ t('company_age_placeholder') }}">
                                <small class="text-silver-pearl">
                                    {{ t('sme_loan_only') }}
                                </small>
                            </div>

                            <!-- Submit Button -->
                            <div class="col-12 text-center pt-5 mt-4">
                                <button type="submit" class="btn btn-lg px-5 py-3 galaxy-shimmer white-glow-btn" style="font-size: 1.2rem; box-shadow: 0 0 30px rgba(229, 228, 226, 0.3);">
                                    <i class="bi bi-lightning-charge-fill me-2"></i>
                                    {{ t('start_matching_analysis') }}
                                </button>
                                <div class="mt-3">
                                    <small class="text-silver-pearl">
                                        <i class="bi bi-shield-check me-1"></i>
                                        {{ t('complete_required_fields') }}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Back Button -->
            <div class="text-center mt-4">
                <a href="{{ url_for('index') }}" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left me-2"></i>{{ t('back_to_home') }}
                </a>
            </div>
        </div>
    </div>
</div>

<style>
/* Section Header */
.section-header {
    position: relative;
    padding-bottom: 1.5rem;
}

/* Elegant Divider */
.title-divider {
    height: 2px;
    background: linear-gradient(90deg, 
        transparent 0%,
        rgba(229, 228, 226, 0.15) 10%,
        rgba(229, 228, 226, 0.5) 30%,
        rgba(229, 228, 226, 0.8) 50%,
        rgba(229, 228, 226, 0.5) 70%,
        rgba(229, 228, 226, 0.15) 90%,
        transparent 100%
    );
    position: relative;
    margin: 1rem 0;
}

/* Divider Center Decoration */
.title-divider::after {
    content: 'â—†';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: rgba(229, 228, 226, 0.8);
    font-size: 0.6rem;
    background: #000000;
    padding: 0 0.8rem;
    letter-spacing: 0.5rem;
}

/* Button White Glow Effect */
.white-glow-btn {
    color: #ffffff !important;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.6),
                 0 0 12px rgba(255, 255, 255, 0.3);
}

/* Placeholder Light Gray */
.galaxy-input::placeholder {
    color: #9CA3AF !important;
    opacity: 1;
}

.galaxy-input::-webkit-input-placeholder {
    color: #9CA3AF !important;
}

.galaxy-input::-moz-placeholder {
    color: #9CA3AF !important;
}

.galaxy-input:-ms-input-placeholder {
    color: #9CA3AF !important;
}

/* Form Field Spacing Optimization */
.form-label {
    margin-bottom: 0.75rem;
}

.galaxy-input {
    margin-bottom: 0.5rem;
}

/* Small Help Text Top Margin */
small.text-silver-pearl {
    margin-top: 0.5rem;
    display: block;
}

/* Custom File Upload Styling */
.custom-file-upload .btn:hover {
    background: rgba(229, 228, 226, 0.1);
    border-color: rgba(229, 228, 226, 0.5);
}

/* Navigation Style Button for File Upload */
.nav-link-file-button {
    background: linear-gradient(135deg, #FF007F 0%, #E6007A 100%);
    color: #FFFFFF;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    border: 2px solid #FF007F;
    font-weight: 700;
    font-size: 0.9rem;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    box-shadow: 0 0 15px rgba(255, 0, 127, 0.4);
    white-space: nowrap;
    transition: all 0.3s ease;
}

.nav-link-file-button:hover {
    background: linear-gradient(135deg, #FF1A8C 0%, #F0008A 100%);
    box-shadow: 0 0 25px rgba(255, 0, 127, 0.6);
    transform: translateY(-2px);
}
</style>

<script>
function updateFileName(input) {
    const fileNameDisplay = document.getElementById('file_name_display');
    const noFileText = "{{ t('no_file_chosen') }}";
    
    if (input.files && input.files.length > 0) {
        fileNameDisplay.textContent = input.files[0].name;
        fileNameDisplay.classList.remove('text-silver-pearl');
        fileNameDisplay.classList.add('text-white', 'fw-semibold');
    } else {
        fileNameDisplay.textContent = noFileText;
        fileNameDisplay.classList.remove('text-white', 'fw-semibold');
        fileNameDisplay.classList.add('text-silver-pearl');
    }
}
</script>
{% endblock %}
