{% extends "base.html" %}

{% block title %}{{ statement.customer_name }} - {{ statement.bank_name }} - {{ statement.statement_date }}{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Header -->
    <div class="section-header">
        <h1 class="section-title">
            <i class="bi bi-journal-text"></i> {{ statement.customer_name }}
        </h1>
        <p class="section-subtitle">
            {{ statement.bank_name }} ****{{ statement.card_number_last4 }} - {{ t('statement_date') }}: {{ statement.statement_date }}
        </p>
    </div>

    <!-- Navigation -->
    <div class="mb-4">
        <a href="{{ url_for('credit_card_ledger') }}" class="btn-professional-outline">
            <i class="bi bi-arrow-left"></i> {{ t('back_to_all_customers') }}
        </a>
        <a href="{{ url_for('view_statement_file', statement_id=statement.statement_id) }}" 
           class="btn-professional-outline ms-2" 
           target="_blank">
            <i class="bi bi-file-pdf"></i> {{ t('view_pdf') }}
        </a>
    </div>

    <!-- 区域 1: 账单总览 -->
    <div class="professional-card mb-4">
        <h2 class="section-title mb-4">
            <i class="bi bi-receipt"></i> {{ t('statement') }} {{ t('customer_overview') }}
        </h2>
        
        <div class="row g-4">
            <div class="col-md-3">
                <div style="text-align: center; padding: 1.5rem; background: rgba(192, 192, 192, 0.05); border-radius: 8px;">
                    <i class="bi bi-calendar-event" style="font-size: 2.5rem; color: #C0C0C0;"></i>
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-top: 0.5rem;">
                        {{ statement.statement_date }}
                    </div>
                    <small style="color: var(--text-secondary);">{{ t('statement_date') }}</small>
                </div>
            </div>
            
            <div class="col-md-3">
                <div style="text-align: center; padding: 1.5rem; background: rgba(192, 192, 192, 0.05); border-radius: 8px;">
                    <i class="bi bi-cash-stack" style="font-size: 2.5rem; color: #330066;"></i>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #330066; margin-top: 0.5rem;">
                        RM {{ "{:,.2f}".format(statement.statement_total) }}
                    </div>
                    <small style="color: var(--text-secondary);">{{ t('statement_total') }}</small>
                </div>
            </div>
            
            <div class="col-md-3">
                <div style="text-align: center; padding: 1.5rem; background: rgba(192, 192, 192, 0.05); border-radius: 8px;">
                    <i class="bi bi-arrow-up-circle" style="font-size: 2.5rem; color: var(--text-secondary);"></i>
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-secondary); margin-top: 0.5rem;">
                        RM {{ "{:,.2f}".format(statement.previous_balance) }}
                    </div>
                    <small style="color: var(--text-secondary);">{{ t('previous_balance') }}</small>
                </div>
            </div>
            
            <div class="col-md-3">
                <div style="text-align: center; padding: 1.5rem; background: rgba(192, 192, 192, 0.05); border-radius: 8px;">
                    <i class="bi bi-list-ul" style="font-size: 2.5rem; color: #FF007F;"></i>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #FF007F; margin-top: 0.5rem;">
                        {{ statement.transaction_count }}
                    </div>
                    <small style="color: var(--text-secondary);">{{ t('transactions') }}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- 区域 2: 基线信息 -->
    {% if statement.baseline %}
    <div class="professional-card mb-4">
        <h2 class="section-title mb-4">
            <i class="bi bi-flag"></i> {{ t('first_statement_baseline') }}
        </h2>
        
        <div class="row g-3">
            <div class="col-md-4">
                <div style="padding: 1rem; background: rgba(192, 192, 192, 0.05); border-radius: 8px; border: 1px solid rgba(192, 192, 192, 0.1);">
                    <small style="color: var(--text-secondary);">{{ t('previous_balance') }}</small>
                    <div style="font-size: 1.5rem; font-weight: 600; color: var(--text-primary); margin-top: 0.5rem;">
                        RM {{ "{:,.2f}".format(statement.baseline.previous_balance) }}
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div style="padding: 1rem; background: rgba(192, 192, 192, 0.05); border-radius: 8px; border: 1px solid rgba(192, 192, 192, 0.1);">
                    <small style="color: #C0C0C0;">{{ t('owner') }} Baseline</small>
                    <div style="font-size: 1.5rem; font-weight: 600; color: #330066; margin-top: 0.5rem;">
                        RM {{ "{:,.2f}".format(statement.baseline.owner_baseline) }}
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div style="padding: 1rem; background: rgba(218, 165, 32, 0.05); border-radius: 8px; border: 1px solid rgba(218, 165, 32, 0.2);">
                    <small style="color: #322446;">{{ t('infinite') }} Baseline</small>
                    <div style="font-size: 1.5rem; font-weight: 600; color: #322446; margin-top: 0.5rem;">
                        RM {{ "{:,.2f}".format(statement.baseline.infinite_baseline) }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- 区域 3: OWNER vs INFINITE 汇总 -->
    <div class="professional-card mb-4">
        <h2 class="section-title mb-4">
            <i class="bi bi-pie-chart"></i> {{ t('owner_vs_infinite_summary') }}
        </h2>
        
        <div class="row g-4">
            <!-- OWNER Column -->
            <div class="col-md-6">
                <div style="padding: 2rem; background: linear-gradient(135deg, rgba(192, 192, 192, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%); border-radius: 12px; border: 1px solid rgba(192, 192, 192, 0.2); height: 100%;">
                    <div class="text-center mb-4">
                        <h3 style="color: #C0C0C0; font-size: 1.5rem;">
                            <i class="bi bi-person-fill"></i> {{ t('owner') }}
                        </h3>
                    </div>
                    
                    <!-- OWNER Expenses -->
                    <div class="mb-3" style="padding: 1rem; background: rgba(135, 206, 235, 0.1); border-radius: 8px;">
                        <div class="d-flex justify-content-between align-items-center">
                            <span style="color: var(--text-secondary);">
                                <i class="bi bi-cart"></i> {{ t('expenses') }}
                            </span>
                            <span style="color: #330066; font-size: 1.5rem; font-weight: 700;">
                                RM {{ "{:,.2f}".format(statement.owner_expenses) }}
                            </span>
                        </div>
                    </div>
                    
                    <!-- OWNER Payments -->
                    <div style="padding: 1rem; background: rgba(144, 238, 144, 0.1); border-radius: 8px;">
                        <div class="d-flex justify-content-between align-items-center">
                            <span style="color: var(--text-secondary);">
                                <i class="bi bi-wallet2"></i> {{ t('payments') }}
                            </span>
                            <span style="color: #FF007F; font-size: 1.5rem; font-weight: 700;">
                                -RM {{ "{:,.2f}".format(statement.owner_payments) }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- INFINITE Column -->
            <div class="col-md-6">
                <div style="padding: 2rem; background: linear-gradient(135deg, rgba(218, 165, 32, 0.05) 0%, rgba(255, 215, 0, 0.02) 100%); border-radius: 12px; border: 1px solid rgba(218, 165, 32, 0.3); height: 100%;">
                    <div class="text-center mb-4">
                        <h3 style="color: #322446; font-size: 1.5rem;">
                            <i class="bi bi-infinity"></i> {{ t('infinite') }}
                        </h3>
                    </div>
                    
                    <!-- INFINITE Expenses -->
                    <div class="mb-3" style="padding: 1rem; background: rgba(255, 215, 0, 0.1); border-radius: 8px;">
                        <div class="d-flex justify-content-between align-items-center">
                            <span style="color: var(--text-secondary);">
                                <i class="bi bi-cart"></i> {{ t('supplier_expenses') }}
                            </span>
                            <span style="color: #322446; font-size: 1.5rem; font-weight: 700;">
                                RM {{ "{:,.2f}".format(statement.infinite_expenses) }}
                            </span>
                        </div>
                    </div>
                    
                    <!-- INFINITE Payments -->
                    <div class="mb-3" style="padding: 1rem; background: rgba(144, 238, 144, 0.1); border-radius: 8px;">
                        <div class="d-flex justify-content-between align-items-center">
                            <span style="color: var(--text-secondary);">
                                <i class="bi bi-wallet2"></i> {{ t('third_party_payments') }}
                            </span>
                            <span style="color: #FF007F; font-size: 1.5rem; font-weight: 700;">
                                -RM {{ "{:,.2f}".format(statement.infinite_payments) }}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Supplier Fees -->
                    {% if statement.supplier_fees > 0 %}
                    <div style="padding: 1rem; background: rgba(218, 165, 32, 0.15); border-radius: 8px; border: 1px solid rgba(218, 165, 32, 0.3);">
                        <div class="d-flex justify-content-between align-items-center">
                            <span style="color: var(--text-secondary);">
                                <i class="bi bi-percent"></i> {{ t('supplier_fees') }}
                            </span>
                            <span style="color: #322446; font-size: 1.5rem; font-weight: 700;">
                                RM {{ "{:,.2f}".format(statement.supplier_fees) }}
                            </span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- 区域 4: 交易明细表 -->
    <div class="professional-card mb-4">
        <h2 class="section-title mb-4">
            <i class="bi bi-list-check"></i> {{ t('transaction') }} {{ t('details') }}
        </h2>
        
        {% if transactions %}
        <div class="table-responsive">
            <table class="table-professional">
                <thead>
                    <tr>
                        <th>{{ t('date') }}</th>
                        <th>{{ t('description') }}</th>
                        <th>{{ t('amount') }}</th>
                        <th>{{ t('type') }}</th>
                        <th>{{ t('category') }}</th>
                        <th>{{ t('details') }}</th>
                        <th>CR/DR</th>
                    </tr>
                </thead>
                <tbody>
                    {% for txn in transactions %}
                    <tr>
                        <td style="color: var(--text-secondary);">{{ txn.transaction_date }}</td>
                        <td style="color: var(--text-primary);">{{ txn.description }}</td>
                        <td style="font-weight: 600; {% if txn.amount > 0 %}color: #330066;{% else %}color: #FF007F;{% endif %}">
                            RM {{ "{:,.2f}".format(txn.amount|abs) }}
                        </td>
                        <td>
                            {% if txn.transaction_type == 'payment' %}
                            <span class="badge-professional badge-success-pro">{{ t('payment') }}</span>
                            {% else %}
                            <span class="badge-professional badge-info-pro">{{ t('expense') }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if txn.category == 'owner_expense' %}
                            <span style="color: #330066;"><i class="bi bi-person-fill"></i> OWNER</span>
                            {% elif txn.category == 'infinite_expense' %}
                            <span style="color: #322446;"><i class="bi bi-infinity"></i> INFINITE</span>
                            {% elif txn.category == 'owner_payment' %}
                            <span style="color: #FF007F;"><i class="bi bi-person-fill"></i> {{ t('owner_pay') }}</span>
                            {% elif txn.category == 'infinite_payment' %}
                            <span style="color: #FF007F;"><i class="bi bi-infinity"></i> {{ t('third_party') }}</span>
                            {% endif %}
                        </td>
                        <td style="color: var(--text-secondary); font-size: 0.85rem;">
                            {% if txn.is_supplier %}
                            <div><i class="bi bi-building"></i> {{ txn.supplier_name }}</div>
                            <div style="color: #322446;"><i class="bi bi-percent"></i> {{ t('fee') }}: RM {{ "{:,.2f}".format(txn.supplier_fee) }}</div>
                            {% endif %}
                            {% if txn.payer_name %}
                            <div><i class="bi bi-person-badge"></i> Payer: {{ txn.payer_name }}</div>
                            {% endif %}
                        </td>
                        <td style="font-weight: 700; text-align: center;">
                            {% if txn.transaction_type == 'payment' %}
                            <span style="color: #FF007F;">CR</span>
                            {% else %}
                            <span style="color: #FFFEF0;">DR</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center" style="padding: 2rem; color: var(--text-secondary);">
            <i class="bi bi-inbox" style="font-size: 3rem;"></i>
            <p class="mt-3">{{ t('no_transactions_found') }}</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
