{% extends "base.html" %}

{% block title %}PDF解析状态监控 - PDF Parsing Monitor{% endblock %}

{% block content %}
<div class="container-fluid" style="padding: 2rem; max-width: 98%;">
    
    <!-- Page Header -->
    <div class="section-header" style="margin-bottom: 2rem;">
        <h1 style="color: #FF007F; font-weight: 700; font-size: 2.5rem;">
            <i class="bi bi-file-earmark-pdf"></i> PDF解析状态监控
        </h1>
        <p style="color: rgba(255,255,255,0.7); font-size: 1.1rem;">PDF Parsing Status Monitor - 372个信用卡账单PDF实时监控</p>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border: 2px solid #FF007F; padding: 2rem;">
                <div style="font-size: 3rem; color: #FF007F; font-weight: 700;">{{ stats.total_pdfs }}</div>
                <div style="color: rgba(255,255,255,0.8); margin-top: 0.5rem;">总PDF文件数</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(0, 255, 0, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border: 2px solid #00FF00; padding: 2rem;">
                <div style="font-size: 3rem; color: #00FF00; font-weight: 700;">{{ stats.parsed }}</div>
                <div style="color: rgba(255,255,255,0.8); margin-top: 0.5rem;">已成功解析</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 165, 0, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border: 2px solid #FFA500; padding: 2rem;">
                <div style="font-size: 3rem; color: #FFA500; font-weight: 700;">{{ stats.pending }}</div>
                <div style="color: rgba(255,255,255,0.8); margin-top: 0.5rem;">待处理</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.3) 0%, rgba(0, 0, 0, 0.95) 100%); border: 2px solid #322446; padding: 2rem;">
                <div style="font-size: 3rem; color: #FFFEF0; font-weight: 700;">{{ "%.1f"|format(avg_accuracy) }}%</div>
                <div style="color: rgba(255,255,255,0.8); margin-top: 0.5rem;">平均准确率</div>
            </div>
        </div>
    </div>

    <!-- Bank Groups -->
    {% for bank_name, bank_data in bank_groups.items() %}
    <div class="professional-card" style="margin-bottom: 2rem; border: 2px solid #FF007F;">
        <div style="background: linear-gradient(135deg, rgba(255, 0, 127, 0.1) 0%, rgba(0, 0, 0, 0.95) 100%); border-bottom: 2px solid #FF007F; padding: 1.5rem;">
            <h3 style="color: #FF007F; font-weight: 700; margin: 0;">
                <i class="bi bi-bank"></i> {{ bank_name }} ({{ bank_data.count }} PDFs)
            </h3>
        </div>
        <div class="table-responsive">
            <table class="table table-dark table-hover" style="margin: 0;">
                <thead>
                    <tr style="background: rgba(50, 36, 70, 0.3);">
                        <th style="color: #FFFEF0; padding: 1rem;">文件名</th>
                        <th style="color: #FFFEF0; padding: 1rem;">大小</th>
                        <th style="color: #FFFEF0; padding: 1rem;">状态</th>
                        <th style="color: #FFFEF0; padding: 1rem;">准确率</th>
                        <th style="color: #FFFEF0; padding: 1rem;">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in bank_data.files[:20] %}
                    <tr>
                        <td style="color: rgba(255,255,255,0.9); padding: 1rem; font-family: monospace;">{{ file.name }}</td>
                        <td style="color: rgba(255,255,255,0.7); padding: 1rem;">{{ "%.1f"|format(file.size/1024) }} KB</td>
                        <td style="padding: 1rem;">
                            {% if file.status == 'parsed' %}
                            <span style="background: #00FF00; color: #000; padding: 0.4rem 0.8rem; border-radius: 6px; font-weight: 700;">✓ 已解析</span>
                            {% elif file.status == 'failed' %}
                            <span style="background: #FF0000; color: #FFF; padding: 0.4rem 0.8rem; border-radius: 6px; font-weight: 700;">✗ 失败</span>
                            {% else %}
                            <span style="background: #FFA500; color: #000; padding: 0.4rem 0.8rem; border-radius: 6px; font-weight: 700;">⏳ 待处理</span>
                            {% endif %}
                        </td>
                        <td style="color: #FF007F; padding: 1rem; font-weight: 700;">{{ "%.1f"|format(file.accuracy) }}%</td>
                        <td style="padding: 1rem;">
                            <a href="/static/uploads/{{ file.path }}" target="_blank" class="btn btn-sm" style="background: linear-gradient(135deg, #FF007F 0%, #322446 100%); color: white; padding: 0.4rem 0.8rem; border-radius: 6px; border: none; text-decoration: none;">
                                <i class="bi bi-eye"></i> 查看
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if bank_data.count > 20 %}
                    <tr>
                        <td colspan="5" style="text-align: center; color: rgba(255,255,255,0.5); padding: 1rem;">
                            ... 还有 {{ bank_data.count - 20 }} 个文件
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    {% endfor %}

</div>
{% endblock %}
