{% extends "base.html" %}

{% block title %}{{ customer.name }} - {{ period_display }}{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Header -->
    <div class="section-header">
        <h1 class="section-title">
            <i class="bi bi-file-earmark-text"></i> Credit Card Statement Report
        </h1>
        <p class="section-subtitle">
            {{ t('customer') }}: {{ customer.name }} | {{ t('period') }}: {{ period_display }}
        </p>
    </div>

    <!-- Navigation -->
    <div class="mb-4">
        <a href="{{ url_for('credit_card_ledger_timeline', customer_id=customer.id) }}" class="btn-professional-outline" style="border-color: #FF1493; color: #FF1493; padding: 0.75rem 1.5rem; font-size: 1.1rem;">
            {{ t('back_to_timeline') }}
        </a>
    </div>

    <!-- ðŸ”¥ æŒ‰é“¶è¡Œåˆ†ç»„æ˜¾ç¤ºæŠ¥å‘Š -->
    {% for bank_name, bank_data in bank_summaries.items() %}
    <div style="margin-bottom: 4rem; padding-bottom: 2rem; border-bottom: 3px solid rgba(255, 20, 147, 0.3);">
        
        <!-- {{ t('i_') }} (Client Summary) -->
        <div class="professional-card mb-4">
            <h2 class="section-title mb-4" style="color: #FF1493;">
                I. {{ t('client_summary') }} - {{ bank_name }}
            </h2>
            
            <div class="table-responsive">
                <table class="table-professional">
                    <tbody>
                        <tr>
                            <td style="color: var(--text-secondary); width: 30%; white-space: nowrap;">{{ t('customer_name') }}</td>
                            <td style="color: var(--text-primary); font-weight: 600; white-space: nowrap;">{{ customer.name }}</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('bank') }}</td>
                            <td style="color: #FF1493; font-weight: 600; white-space: nowrap;">{{ bank_name }}</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('report_code') }}</td>
                            <td style="color: #FF1493; font-weight: 600; white-space: nowrap;">{{ customer.code }}_{{ bank_name }}_{{ year }}{{ month }}</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('period') }}</td>
                            <td style="color: var(--text-primary); font-weight: 600; white-space: nowrap;">{{ period_display }}</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('total_accounts') }}</td>
                            <td style="color: #FF1493; font-weight: 600; white-space: nowrap;">{{ bank_data.statements|length }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- {{ t('ii_') }} (Accounts Overview) -->
        <div class="professional-card mb-4">
            <h2 class="section-title mb-4" style="color: #FF1493;">
                II. {{ t('accounts_overview') }}
            </h2>
            
            <div class="table-responsive">
                <table class="table-professional">
                    <thead>
                        <tr>
                            <th>{{ t('card_number') }}</th>
                            <th>{{ t('account_type') }}</th>
                            <th>{{ t('previous_balance') }}</th>
                            <th>{{ t('current_balance') }}</th>
                            <th>{{ t('transactions') }}</th>
                            <th>{{ t('actions') }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stmt in bank_data.statements %}
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">****{{ stmt.card_number_last4 }}</td>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('main_card') }}</td>
                            <td style="color: {% if stmt.previous_balance < 0 %}#FF007F{% else %}#FFFEF0{% endif %}; font-weight: 600; white-space: nowrap;">
                                RM {{ "{:,.2f}".format(stmt.previous_balance) }}
                            </td>
                            <td style="color: {% if stmt.statement_total < 0 %}#FF007F{% else %}#FFFEF0{% endif %}; font-weight: 600; white-space: nowrap;">
                                RM {{ "{:,.2f}".format(stmt.statement_total) }}
                            </td>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ stmt.txn_count }}</td>
                            <td style="white-space: nowrap;">
                                <a href="{{ url_for('view_statement_file', statement_id=stmt.id) }}" 
                                   class="btn-professional-outline" 
                                   style="padding: 0.5rem 1rem; font-size: 0.9rem; border-color: #330066; color: #330066;" 
                                   target="_blank">
                                    PDF
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- {{ t('iii_') }} (Transaction Details) -->
        <div class="professional-card mb-4">
            <h2 class="section-title mb-4" style="color: #FF1493;">
                III. {{ t('transaction_details') }}
            </h2>
            
            {% for stmt in bank_data.statements %}
        <div class="mb-4">
            <h4 style="color: #FF1493; margin-bottom: 1rem;">
                {{ stmt.bank_name }} ****{{ stmt.card_number_last4 }}
            </h4>
            
            <div class="table-responsive">
                <table class="table-professional">
                    <thead>
                        <tr>
                            <th>{{ t('date') }}</th>
                            <th>{{ t('description') }}</th>
                            <th>{{ t('amount') }} (RM)</th>
                            <th>{{ t('category') }}</th>
                            <th>{{ t('notes') }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ä¸ŠæœŸç»“ä½™ -->
                        <tr style="background: rgba(255, 20, 147, 0.05);">
                            <td style="color: var(--text-secondary); white-space: nowrap;">-</td>
                            <td style="color: var(--text-primary); font-weight: 600; white-space: nowrap;">{{ t('previous_balance') }}</td>
                            <td style="color: {% if stmt.previous_balance < 0 %}#FF007F{% else %}#FFFEF0{% endif %}; font-weight: 700; white-space: nowrap;">
                                {{ "{:,.2f}".format(stmt.previous_balance) }}
                            </td>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('baseline') }}</td>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('included_in_owner_debt') }}</td>
                        </tr>
                        
                        <!-- äº¤æ˜“æ˜Žç»† -->
                        {% for txn in stmt.transactions %}
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ txn.transaction_date }}</td>
                            <td style="color: var(--text-primary); white-space: nowrap;">{{ txn.description }}</td>
                            <td style="white-space: nowrap;" style="font-weight: 600; color: {% if txn.amount > 0 %}#FF1493{% else %}#FF007F{% endif %};">
                                {{ "{:,.2f}".format(txn.amount) }}
                            </td>
                            <td style="white-space: nowrap;">
                                {% if txn.category == 'owner_expense' %}
                                <span style="color: #FF1493;">{{ t('owner') }}</span>
                                {% elif txn.category == 'infinite_expense' %}
                                <span style="color: #330066;">{{ t('infinite') }}</span>
                                {% elif txn.category == 'owner_payment' %}
                                <span style="color: #FF007F;">Owner {{ t('payment') }}</span>
                                {% elif txn.category == 'infinite_payment' %}
                                <span style="color: #FF007F;">INFINITE {{ t('payment') }}</span>
                                {% endif %}
                            </td>
                            <td style="color: var(--text-secondary); font-size: 0.85rem; white-space: nowrap;">
                                {% if txn.transaction_type == 'payment' %}
                                {{ t('customer_payment') }}
                                {% elif txn.is_supplier %}
                                {{ t('supplier') }}: {{ txn.supplier_name }}
                                {% else %}
                                {{ t('non_supplier') }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- è´¦æˆ·æ±‡æ€» -->
            <div style="margin-top: 1rem; padding: 1rem; background: rgba(192, 192, 192, 0.05); border-radius: 8px;">
                <div class="row g-3">
                    <div class="col-md-3">
                        <div style="text-align: center;">
                            <small style="color: var(--text-secondary);">Owner {{ t('expenses') }}</small>
                            <div style="color: #FF1493; font-weight: 700; font-size: 1.2rem;">RM {{ "{:,.2f}".format(stmt.owner_expenses) }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div style="text-align: center;">
                            <small style="color: var(--text-secondary);">Owner {{ t('payments') }}</small>
                            <div style="color: #FF007F; font-weight: 700; font-size: 1.2rem;">RM {{ "{:,.2f}".format(stmt.owner_payments) }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div style="text-align: center;">
                            <small style="color: var(--text-secondary);">INFINITE {{ t('expenses') }}</small>
                            <div style="color: #330066; font-weight: 700; font-size: 1.2rem;">RM {{ "{:,.2f}".format(stmt.infinite_expenses) }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div style="text-align: center;">
                            <small style="color: var(--text-secondary);">{{ t('supplier_fees') }}</small>
                            <div style="color: #FFFEF0; font-weight: 700; font-size: 1.2rem;">RM {{ "{:,.2f}".format(stmt.supplier_fees) }}</div>
                        </div>
                    </div>
                </div>
                
                <!-- ðŸ”¥ è¯¥å¡çš„ç´¯è®¡ä½™é¢ -->
                <div style="border-top: 2px solid rgba(255, 20, 147, 0.3); margin-top: 1rem; padding-top: 1rem;">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div style="text-align: center; padding: 1rem; background: rgba(255, 20, 147, 0.05); border-radius: 8px;">
                                <small style="color: #FF1493; font-weight: 600;">{{ t('owner_') }}</small>
                                <div style="color: #FF1493; font-weight: 900; font-size: 1.4rem;">RM {{ "{:,.2f}".format(stmt.owner_cumulative_balance) }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div style="text-align: center; padding: 1rem; background: rgba(51, 0, 102, 0.05); border-radius: 8px;">
                                <small style="color: #330066; font-weight: 600;">{{ t('infinite_') }}</small>
                                <div style="color: #330066; font-weight: 900; font-size: 1.4rem;">RM {{ "{:,.2f}".format(stmt.infinite_cumulative_balance) }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            {% endfor %}
        </div>

        <!-- {{ t('iv__monthly_summary__') }} -->
        <div class="professional-card mb-4">
            <h2 class="section-title mb-4" style="color: #FF1493;">
                IV. {{ t('monthly_summary') }} - {{ bank_name }}
            </h2>
            
            <div class="row g-4">
                <div class="col-md-6">
                    <div style="padding: 2rem; background: linear-gradient(135deg, rgba(255, 20, 147, 0.1) 0%, rgba(255, 20, 147, 0.02) 100%); border-radius: 12px; border: 1px solid rgba(255, 20, 147, 0.3);">
                        <h3 style="color: #FF1493; text-align: center; margin-bottom: 1.5rem;">
                            OWNER
                        </h3>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span style="color: var(--text-secondary);">{{ t('total_expenses') }}</span>
                                <span style="color: #FF1493; font-weight: 700; font-size: 1.3rem;">RM {{ "{:,.2f}".format(bank_data.owner_expenses) }}</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span style="color: var(--text-secondary);">{{ t('total_payments') }}</span>
                                <span style="color: #FF007F; font-weight: 700; font-size: 1.3rem;">RM {{ "{:,.2f}".format(bank_data.owner_payments) }}</span>
                            </div>
                        </div>
                        <div style="border-top: 2px solid rgba(255, 20, 147, 0.5); padding-top: 1rem; margin-top: 1rem;">
                            <div class="d-flex justify-content-between">
                                <span style="color: #FF1493; font-weight: 600;">{{ t('__cumulative_balance') }}</span>
                                <span style="color: #FF1493; font-weight: 900; font-size: 1.5rem;">RM {{ "{:,.2f}".format(bank_data.owner_cumulative_balance) }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div style="padding: 2rem; background: linear-gradient(135deg, rgba(147, 112, 219, 0.1) 0%, rgba(147, 112, 219, 0.02) 100%); border-radius: 12px; border: 1px solid rgba(147, 112, 219, 0.3);">
                        <h3 style="color: #330066; text-align: center; margin-bottom: 1.5rem;">
                            INFINITE
                        </h3>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span style="color: var(--text-secondary);">{{ t('total_expenses') }}</span>
                                <span style="color: #330066; font-weight: 700; font-size: 1.3rem;">RM {{ "{:,.2f}".format(bank_data.infinite_expenses) }}</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span style="color: var(--text-secondary);">{{ t('total_payments') }}</span>
                                <span style="color: #FF007F; font-weight: 700; font-size: 1.3rem;">RM {{ "{:,.2f}".format(bank_data.infinite_payments) }}</span>
                            </div>
                        </div>
                        <div class="mb-3" style="border-top: 1px solid rgba(51, 0, 102, 0.3); padding-top: 0.75rem;">
                            <div class="d-flex justify-content-between">
                                <span style="color: var(--text-secondary);">{{ t('supplier_fees') }} (1%)</span>
                                <span style="color: #FFFEF0; font-weight: 700; font-size: 1.3rem;">RM {{ "{:,.2f}".format(bank_data.supplier_fees) }}</span>
                            </div>
                        </div>
                        <div style="border-top: 2px solid rgba(51, 0, 102, 0.5); padding-top: 1rem; margin-top: 1rem;">
                            <div class="d-flex justify-content-between">
                                <span style="color: #330066; font-weight: 600;">{{ t('__cumulative_balance') }}</span>
                                <span style="color: #330066; font-weight: 900; font-size: 1.5rem;">RM {{ "{:,.2f}".format(bank_data.infinite_cumulative_balance) }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- {{ t('v_') }} (Reconciliation Check) -->
        <div class="professional-card mb-4">
            <h2 class="section-title mb-4" style="color: #FF1493;">
                V. {{ t('reconciliation_check') }} - {{ bank_name }}
            </h2>
            
            <div class="table-responsive">
                <table class="table-professional">
                    <thead>
                        <tr>
                            <th>{{ t('check_item') }}</th>
                            <th>{{ t('system_result') }}</th>
                            <th>{{ t('status') }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('total_accounts') }}</td>
                            <td style="color: var(--text-primary); font-weight: 600; white-space: nowrap;">{{ bank_data.statements|length }}</td>
                            <td style="white-space: nowrap;"><span class="badge-professional badge-success-pro">âœ“</span></td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">{{ t('total_transactions') }}</td>
                            <td style="color: var(--text-primary); font-weight: 600; white-space: nowrap;">{{ bank_data.total_txn_count }}</td>
                            <td style="white-space: nowrap;"><span class="badge-professional badge-success-pro">âœ“</span></td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">Owner {{ t('total_expenses') }}</td>
                            <td style="color: #FF1493; font-weight: 700; white-space: nowrap;">RM {{ "{:,.2f}".format(bank_data.owner_expenses) }}</td>
                            <td style="white-space: nowrap;"><span class="badge-professional badge-success-pro">âœ“</span></td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">INFINITE {{ t('total_expenses') }}</td>
                            <td style="color: #330066; font-weight: 700; white-space: nowrap;">RM {{ "{:,.2f}".format(bank_data.infinite_expenses) }}</td>
                            <td style="white-space: nowrap;"><span class="badge-professional badge-success-pro">âœ“</span></td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">Owner {{ t('cumulative_balance') }}</td>
                            <td style="color: #FF1493; font-weight: 900; white-space: nowrap;">RM {{ "{:,.2f}".format(bank_data.owner_cumulative_balance) }}</td>
                            <td style="white-space: nowrap;"><span class="badge-professional badge-success-pro">âœ“</span></td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary); white-space: nowrap;">INFINITE {{ t('cumulative_balance') }}</td>
                            <td style="color: #330066; font-weight: 900; white-space: nowrap;">RM {{ "{:,.2f}".format(bank_data.infinite_cumulative_balance) }}</td>
                            <td style="white-space: nowrap;"><span class="badge-professional badge-success-pro">âœ“</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
