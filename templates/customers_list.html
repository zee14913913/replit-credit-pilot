{% extends "base.html" %}

{% block title %}客户列表 - Customers List{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Page Header -->
    <div class="section-header mb-4">
        <h1 class="section-title">客户列表</h1>
        <a href="{{ url_for('add_customer_page') }}" class="btn-professional">
            <i class="bi bi-person-plus"></i> 添加新客户
        </a>
    </div>

    <!-- Customers Table -->
    <div class="card-professional">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th style="width: 20%;">客户名称</th>
                        <th style="width: 12%;">客户代码</th>
                        <th style="width: 25%;">收款账户</th>
                        <th style="width: 18%;">联系方式</th>
                        <th style="width: 10%; text-align: center;">信用卡</th>
                        <th style="width: 10%; text-align: center;">储蓄账户</th>
                        <th style="width: 5%; text-align: center;">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% if customers %}
                        {% for customer in customers %}
                        <tr>
                            <td>
                                <div class="customer-name">{{ customer.name }}</div>
                            </td>
                            <td>
                                <span class="badge-purple">{{ customer.customer_code }}</span>
                            </td>
                            <td>
                                <div class="single-line">
                                    {% if customer.accounts %}
                                        {% for account in customer.accounts %}
                                            {% if account.account_type == 'personal' %}
                                                <span class="account-tag tag-personal">{% if account.is_primary %}★{% endif %} {{ account.account_name }} ({{ account.account_number }})</span>
                                            {% else %}
                                                <span class="account-tag tag-company">{% if account.is_primary %}★{% endif %} {{ account.account_name }} ({{ account.account_number }})</span>
                                            {% endif %}
                                            {% if not loop.last %} · {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <span class="text-muted-custom">-</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                <div class="single-line">
                                    {% if customer.email %}<span>{{ customer.email }}</span>{% endif %}
                                    {% if customer.email and customer.phone %} · {% endif %}
                                    {% if customer.phone %}<span>{{ customer.phone }}</span>{% endif %}
                                    {% if not customer.email and not customer.phone %}<span class="text-muted-custom">-</span>{% endif %}
                                </div>
                            </td>
                            <td style="text-align: center;">
                                {% if customer.total_cards > 0 %}
                                    <span class="badge-pink">{{ customer.total_cards }}</span>
                                {% else %}
                                    <span class="text-muted-custom">0</span>
                                {% endif %}
                            </td>
                            <td style="text-align: center;">
                                {% if customer.total_savings_accounts > 0 %}
                                    <span class="badge-purple">{{ customer.total_savings_accounts }}</span>
                                {% else %}
                                    <span class="text-muted-custom">0</span>
                                {% endif %}
                            </td>
                            <td style="text-align: center;">
                                <div class="action-buttons">
                                    <a href="{{ url_for('customer_dashboard', customer_id=customer.id) }}" 
                                       class="btn-icon" 
                                       title="Dashboard">
                                        <i class="bi bi-speedometer2"></i>
                                    </a>
                                    <a href="{{ url_for('edit_customer_page', customer_id=customer.id) }}" 
                                       class="btn-icon" 
                                       title="编辑">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="7" class="text-center" style="padding: 2rem;">
                                <i class="bi bi-inbox" style="font-size: 2rem; color: #666;"></i><br>
                                <span class="text-muted-custom">暂无客户数据</span>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Summary -->
    <div class="mt-3 summary-text">
        <i class="bi bi-info-circle"></i> 总共 <strong>{{ customers|length }}</strong> 位客户
    </div>
</div>

<style>
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.section-title {
    color: #FF007F;
    font-size: 1.8rem;
    font-weight: 700;
    margin: 0;
}

.card-professional {
    background: #0a0a0a;
    border: 1px solid #322446;
    border-radius: 8px;
    padding: 0;
    overflow: hidden;
}

.table {
    color: #fff;
    margin-bottom: 0;
    font-size: 0.9rem;
    border-collapse: collapse;
}

.table thead th {
    background: #000;
    border: 1px solid #322446;
    border-bottom: 2px solid #FF007F;
    color: #FF007F;
    font-weight: 600;
    padding: 0.75rem;
    white-space: nowrap;
}

.table tbody td {
    background: #0a0a0a;
    border: 1px solid #322446;
    padding: 0.75rem;
    vertical-align: middle;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.table tbody tr:hover td {
    background: #111;
    border-color: #FF007F;
}

.customer-name {
    color: #fff;
    font-weight: 600;
}

.single-line {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    color: rgba(255, 255, 255, 0.95);
    font-size: 0.85rem;
    font-weight: 500;
}

.account-tag {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    white-space: nowrap;
}

.tag-personal {
    background: rgba(255, 0, 127, 0.15);
    color: #FF007F;
    border: 1px solid #FF007F;
}

.tag-company {
    background: rgba(50, 36, 70, 0.3);
    color: #9370DB;
    border: 1px solid #322446;
}

.badge-pink {
    background: #FF007F;
    color: #fff;
    font-size: 0.85rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-weight: 600;
    display: inline-block;
}

.badge-purple {
    background: #322446;
    color: #fff;
    font-size: 0.85rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-weight: 600;
    display: inline-block;
}

.text-muted-custom {
    color: #555;
}

.btn-professional {
    background: linear-gradient(135deg, #FF007F, #322446);
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    font-weight: 500;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s ease;
}

.btn-professional:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 0, 127, 0.3);
    color: white;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
}

.btn-icon {
    color: #FF007F;
    text-decoration: none;
    font-size: 1.1rem;
    transition: all 0.2s;
}

.btn-icon:hover {
    color: #fff;
    transform: scale(1.2);
}

.summary-text {
    color: #888;
    font-size: 0.9rem;
}

.summary-text strong {
    color: #FF007F;
}
</style>
{% endblock %}
