{% extends "base.html" %}

{% block title %}{{ t('__monthly_summary_report') }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆ -->
    <div class="row mb-3">
        <div class="col-12 text-end">
            <button id="langToggle" class="btn" style="background: linear-gradient(135deg, #FF007F 0%, #C1006C 100%); color: white; border: none; padding: 0.6rem 1.5rem; font-size: 1rem; font-weight: 600; border-radius: 25px; box-shadow: 0 4px 15px rgba(255, 0, 127, 0.3);">
                <i class="bi bi-translate"></i> <span id="langBtnText">{{ t('english') }}</span>
            </button>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-center" style="color: #FF007F;">
                <i class="bi bi-calendar3"></i> <span class="lang-text" data-zh="ÊúàÂ∫¶Ê±áÊÄªÊä•Âëä" data-en="Monthly Summary Report">{{ t('auto_text_901') }}</span>
            </h1>
            <p class="text-center lang-text" style="color: #FFFFFF;" data-zh="{{ t('supplier_4') }}Ê∂àË¥π‰∏é‰ªòÊ¨æÂØπË¥¶ÊÉÖÂÜµÔºåÊ∏ÖÊô∞ÈÄèÊòéÔºåÈÅøÂÖçËØØ‰ºö" data-en="View monthly supplier expenses and payment reconciliation - clear, transparent, and accurate">
                {{ t('supplier_4') }}Ê∂àË¥π‰∏é‰ªòÊ¨æÂØπË¥¶ÊÉÖÂÜµÔºåÊ∏ÖÊô∞ÈÄèÊòéÔºåÈÅøÂÖçËØØ‰ºö
            </p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-9">
            <div style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.6) 0%, rgba(36, 25, 52, 0.8) 100%); border: 2px solid rgba(255, 0, 127, 0.4); border-radius: 24px; padding: 4rem 3.5rem; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 0, 127, 0.2);">
                
                <!-- ÂÆ¢Êà∑ÈÄâÊã© -->
                <div class="mb-5">
                    <label class="form-label" style="color: #F0F0F0; font-weight: bold; font-size: 1.3rem; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(240, 240, 240, 0.5);">
                        <i class="bi bi-person-circle"></i> <span class="lang-text" data-zh="ÈÄâÊã©ÂÆ¢Êà∑" data-en="Select Customer">{{ t('auto_text_903') }}</span>
                    </label>
                    <select id="customerSelect" class="form-select form-select-lg" style="background: #000000; color: #F0F0F0; font-weight: 700; border: 2px solid #FF007F; padding: 1rem; font-size: 1.15rem; border-radius: 12px; box-shadow: 0 0 15px rgba(255, 0, 127, 0.3);">
                        <option value="" class="lang-text" data-zh="-- ËØ∑ÈÄâÊã©ÂÆ¢Êà∑ --" data-en="-- Select Customer --">{{ t('___1') }}</option>
                        {% for customer in customers %}
                        <option value="{{ customer.id }}">
                            {{ customer.name }} ({{ customer.customer_code }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Âπ¥‰ªΩÂíåÊúà‰ªΩÈÄâÊã© -->
                <div class="row mb-5 g-4">
                    <div class="col-md-6">
                        <label class="form-label" style="color: #F0F0F0; font-weight: bold; font-size: 1.3rem; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(240, 240, 240, 0.5);">
                            <i class="bi bi-calendar-event"></i> <span class="lang-text" data-zh="Âπ¥‰ªΩ" data-en="Year">{{ t('auto_text_905') }}</span>
                        </label>
                        <select id="yearSelect" class="form-select form-select-lg" style="background: #000000; color: #F0F0F0; font-weight: 700; border: 2px solid #FF007F; padding: 1rem; font-size: 1.15rem; border-radius: 12px; box-shadow: 0 0 15px rgba(255, 0, 127, 0.3);">
                            {% for year in years %}
                            <option value="{{ year }}" {% if year == current_year %}selected{% endif %}>
                                {{ year }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" style="color: #F0F0F0; font-weight: bold; font-size: 1.3rem; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(240, 240, 240, 0.5);">
                            <i class="bi bi-calendar-month"></i> <span class="lang-text" data-zh="Êúà‰ªΩ" data-en="Month">{{ t('auto_text_906') }}</span>
                        </label>
                        <select id="monthSelect" class="form-select form-select-lg" style="background: #000000; color: #F0F0F0; font-weight: 700; border: 2px solid #FF007F; padding: 1rem; font-size: 1.15rem; border-radius: 12px; box-shadow: 0 0 15px rgba(255, 0, 127, 0.3);">
                            {% for month in months %}
                            <option value="{{ month }}" {% if month == current_month %}selected{% endif %}>
                                {{ month }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- ÊåâÈíÆÁªÑ -->
                <div class="row g-4">
                    <div class="col-md-6 mb-2">
                        <button id="viewMonthlyBtn" class="btn w-100" style="background: linear-gradient(135deg, #FF007F 0%, #C1006C 100%); color: white; border: 2px solid #F0F0F0; padding: 1.2rem 2rem; font-size: 1.2rem; font-weight: 600; border-radius: 12px; box-shadow: 0 4px 15px rgba(255, 0, 127, 0.3), 0 0 20px rgba(240, 240, 240, 0.3);">
                            <i class="bi bi-file-text"></i> <span class="lang-text" data-zh="Êü•ÁúãÊúàÂ∫¶Êä•Âëä" data-en="View Monthly Report">{{ t('auto_text_907') }}</span>
                        </button>
                    </div>
                    <div class="col-md-6 mb-2">
                        <button id="viewYearlyBtn" class="btn w-100" style="background: linear-gradient(135deg, #322446 0%, #4A3564 100%); color: white; border: 2px solid #F0F0F0; padding: 1.2rem 2rem; font-size: 1.2rem; font-weight: 600; border-radius: 12px; box-shadow: 0 4px 15px rgba(75, 53, 100, 0.3), 0 0 20px rgba(240, 240, 240, 0.3);">
                            <i class="bi bi-calendar3-range"></i> <span class="lang-text" data-zh="Êü•ÁúãÂπ¥Â∫¶Ê±áÊÄª" data-en="View Annual Summary">{{ t('auto_text_908') }}</span>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Âø´ÈÄüËØ¥Êòé -->
    <div class="row justify-content-center mt-5">
        <div class="col-lg-10 col-xl-9">
            <div style="background: #000000; border: 2px solid #FF007F; border-radius: 20px; padding: 3rem 3.5rem; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6), 0 0 25px rgba(255, 0, 127, 0.4);">
                <h6 style="color: #F0F0F0; margin-bottom: 2rem; font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 15px rgba(240, 240, 240, 0.6); padding-bottom: 1rem; border-bottom: 2px solid #FF007F;">
                    <i class="bi bi-info-circle"></i> <span class="lang-text" data-zh="Êä•ÂëäËØ¥Êòé" data-en="Report Description">{{ t('auto_text_909') }}</span>
                </h6>
                <div style="color: #F0F0F0; font-size: 1.05rem; line-height: 2;">
                    <p style="font-size: 1.15rem; margin-bottom: 1.5rem;">
                        <strong style="color: #FF007F;">üìä <span class="lang-text" data-zh="ÊúàÂ∫¶Ê±áÊÄªÊä•Âëä" data-en="Monthly Summary Report">{{ t('auto_text_901') }}</span></strong> 
                        <span style="color: #F0F0F0;" class="lang-text" data-zh="{{ t('supplier_5') }}Ê∂àË¥π‰∏é‰ªòÊ¨æÊÉÖÂÜµÔºö" data-en="Consolidates supplier expenses and payment records across all credit cards for this customer:">{{ t('supplier_2') }}</span>
                    </p>
                    <ul style="list-style: none; padding-left: 0; margin-left: 2rem;">
                        <li style="margin-bottom: 1.2rem; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 0, 127, 0.2);">
                            <strong style="color: #FF007F;">‚ú¶ <span class="lang-text" data-zh="SupplierÊ∂àË¥π" data-en="Supplier Expenses">{{ t('supplier_1') }}</span></strong>
                            <span style="color: #F0F0F0;" class="lang-text" data-zh="ÔºöËØ•ÊúàÂú®ÊâÄÊúâ‰ø°Áî®Âç°‰∏äÁöÑ‰æõÂ∫îÂïÜÊ∂àË¥πÊÄªÈ¢ù" data-en=": Total supplier expenses across all cards for the month">{{ t('auto_text_910') }}</span>
                        </li>
                        <li style="margin-bottom: 1.2rem; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 0, 127, 0.2);">
                            <strong style="color: #FF007F;">‚ú¶ <span class="lang-text" data-zh="ÊâãÁª≠Ë¥π(1%)" data-en="Service Fee (1%)">{{ t('1') }}</span></strong>
                            <span style="color: #F0F0F0;" class="lang-text" data-zh="ÔºöÁ≥ªÁªüËá™Âä®ËÆ°ÁÆóÁöÑ1%ÊúçÂä°Ë¥π" data-en=": Automatically calculated 1% service fee">{{ t('1_1') }}</span>
                        </li>
                        <li style="margin-bottom: 1.2rem; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 0, 127, 0.2);">
                            <strong style="color: #FF007F;">‚ú¶ <span class="lang-text" data-zh="‰ªòÊ¨æËÆ∞ÂΩï" data-en="Payment Records">{{ t('auto_text_913') }}</span></strong>
                            <span style="color: #F0F0F0;" class="lang-text" data-zh="ÔºöÈÄöËøáËΩ¨Ë¥¶/ËøòÊ¨æ‰∏∫ÂÆ¢Êà∑ÊîØ‰ªòÁöÑÈáëÈ¢ù" data-en=": Amount paid through bank transfers/repayments">{{ t('auto_text_914') }}</span>
                        </li>
                        <li style="margin-bottom: 1.2rem; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 0, 127, 0.2);">
                            <strong style="color: #FF007F;">‚ú¶ <span class="lang-text" data-zh="ÂáÄ‰ΩôÈ¢ù" data-en="Net Balance">{{ t('auto_text_915') }}</span></strong>
                            <span style="color: #F0F0F0;" class="lang-text" data-zh="ÔºöÊ∂àË¥π+Ë¥πÁî®-‰ªòÊ¨æÁöÑÂØπË¥¶ÁªìÊûú" data-en=": Reconciliation result (Expenses + Fee - Payments)">{{ t('auto_text_916') }}</span>
                        </li>
                    </ul>
                    <p class="mb-0" style="color: #F0F0F0; font-size: 1.15rem; margin-top: 1.5rem; padding: 1rem; background: rgba(255, 0, 127, 0.1); border-left: 4px solid #FF007F; border-radius: 8px; text-shadow: 0 0 10px rgba(240, 240, 240, 0.5);">
                        <i class="bi bi-check-circle"></i> <span class="lang-text" data-zh="ÊØèÊúàÂèäÊó∂Êü•ÁúãÔºåÊ∏ÖÊ•öÊòé‰∫ÜÔºåÈÅøÂÖçËØØ‰ºöÔºÅ" data-en="Review monthly to stay clear and avoid misunderstandings!">{{ t('auto_text_917') }}</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const customerSelect = document.getElementById('customerSelect');
    const yearSelect = document.getElementById('yearSelect');
    const monthSelect = document.getElementById('monthSelect');
    const viewMonthlyBtn = document.getElementById('viewMonthlyBtn');
    const viewYearlyBtn = document.getElementById('viewYearlyBtn');
    const langToggle = document.getElementById('langToggle');
    const langBtnText = document.getElementById('langBtnText');

    // {{ t('____let_currentlang__localstoragegetitem') }}('preferredLanguage') || 'zh';
    
    function switchLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('preferredLanguage', {{ t('lang__________________langtext_') }}
        document.querySelectorAll('.lang-text').forEach(element => {
            const text = element.getAttribute(`data-${lang}`);
            if (text) {
                element.textContent = text;
            }
        });
        
        // {{ t('________langbtntexttextcontent__lang') }} === 'zh' ? 'English' : '‰∏≠Êñá';
    }
    
    // {{ t('____switchlanguagecurrentlang_________') }}
    switchLanguage(currentLang);
    
    langToggle.addEventListener('click', function() {
        const newLang = currentLang === 'zh' ? 'en' : 'zh';
        switchLanguage(newLang);
    });

    // {{ t('____viewmonthlybtnaddeventlistener') }}('click', function() {
        const customerId = customerSelect.value;
        const year = yearSelect.value;
        const month = monthSelect.value;

        if (!customerId) {
            const alertMsg = currentLang === 'zh' ? 'ËØ∑ÂÖàÈÄâÊã©ÂÆ¢Êà∑' : 'Please select a customer first';
            alert(alertMsg);
            return;
        }

        window.location.href = `/monthly-summary/report/${customerId}/${year}/${month}`;
    });

    // {{ t('____viewyearlybtnaddeventlistener') }}('click', function() {
        const customerId = customerSelect.value;
        const year = yearSelect.value;

        if (!customerId) {
            const alertMsg = currentLang === 'zh' ? 'ËØ∑ÂÖàÈÄâÊã©ÂÆ¢Êà∑' : 'Please select a customer first';
            alert(alertMsg);
            return;
        }

        window.location.href = `/monthly-summary/yearly/${customerId}/${year}`;
    });
});
</script>
{% endblock %}
