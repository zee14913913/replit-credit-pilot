{% extends "base.html" %}

{% block title %}æœˆåº¦æ±‡æ€»æŠ¥å‘Š - Monthly Summary Report{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
    <div class="row mb-3">
        <div class="col-12 text-end">
            <button id="langToggle" class="btn" style="background: linear-gradient(135deg, #FF007F 0%, #C1006C 100%); color: white; border: none; padding: 0.6rem 1.5rem; font-size: 1rem; font-weight: 600; border-radius: 25px; box-shadow: 0 4px 15px rgba(255, 0, 127, 0.3);">
                <i class="bi bi-translate"></i> <span id="langBtnText">{{ t('english') }}</span>
            </button>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-center" style="color: #FF007F;">
                <i class="bi bi-calendar3"></i> <span class="lang-text" data-zh="æœˆåº¦æ±‡æ€»æŠ¥å‘Š" data-en="Monthly Summary Report">æœˆåº¦æ±‡æ€»æŠ¥å‘Š</span>
            </h1>
            <p class="text-center lang-text" style="color: #FFFFFF;" data-zh="æŒ‰æœˆæŸ¥çœ‹Supplieræ¶ˆè´¹ä¸ä»˜æ¬¾å¯¹è´¦æƒ…å†µï¼Œæ¸…æ™°é€æ˜ï¼Œé¿å…è¯¯ä¼š" data-en="View monthly supplier expenses and payment reconciliation - clear, transparent, and accurate">
                æŒ‰æœˆæŸ¥çœ‹Supplieræ¶ˆè´¹ä¸ä»˜æ¬¾å¯¹è´¦æƒ…å†µï¼Œæ¸…æ™°é€æ˜ï¼Œé¿å…è¯¯ä¼š
            </p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-9">
            <div style="background: linear-gradient(135deg, rgba(50, 36, 70, 0.6) 0%, rgba(36, 25, 52, 0.8) 100%); border: 2px solid rgba(255, 0, 127, 0.4); border-radius: 24px; padding: 4rem 3.5rem; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 0, 127, 0.2);">
                
                <!-- å®¢æˆ·é€‰æ‹© -->
                <div class="mb-5">
                    <label class="form-label" style="color: #F0F0F0; font-weight: bold; font-size: 1.3rem; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(240, 240, 240, 0.5);">
                        <i class="bi bi-person-circle"></i> <span class="lang-text" data-zh="é€‰æ‹©å®¢æˆ·" data-en="Select Customer">é€‰æ‹©å®¢æˆ·</span>
                    </label>
                    <select id="customerSelect" class="form-select form-select-lg" style="background: #000000; color: #F0F0F0; font-weight: 700; border: 2px solid #FF007F; padding: 1rem; font-size: 1.15rem; border-radius: 12px; box-shadow: 0 0 15px rgba(255, 0, 127, 0.3);">
                        <option value="" class="lang-text" data-zh="-- è¯·é€‰æ‹©å®¢æˆ· --" data-en="-- Select Customer --">-- è¯·é€‰æ‹©å®¢æˆ· --</option>
                        {% for customer in customers %}
                        <option value="{{ customer.id }}">
                            {{ customer.name }} ({{ customer.customer_code }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- å¹´ä»½å’Œæœˆä»½é€‰æ‹© -->
                <div class="row mb-5 g-4">
                    <div class="col-md-6">
                        <label class="form-label" style="color: #F0F0F0; font-weight: bold; font-size: 1.3rem; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(240, 240, 240, 0.5);">
                            <i class="bi bi-calendar-event"></i> <span class="lang-text" data-zh="å¹´ä»½" data-en="Year">å¹´ä»½</span>
                        </label>
                        <select id="yearSelect" class="form-select form-select-lg" style="background: #000000; color: #F0F0F0; font-weight: 700; border: 2px solid #FF007F; padding: 1rem; font-size: 1.15rem; border-radius: 12px; box-shadow: 0 0 15px rgba(255, 0, 127, 0.3);">
                            {% for year in years %}
                            <option value="{{ year }}" {% if year == current_year %}selected{% endif %}>
                                {{ year }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" style="color: #F0F0F0; font-weight: bold; font-size: 1.3rem; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(240, 240, 240, 0.5);">
                            <i class="bi bi-calendar-month"></i> <span class="lang-text" data-zh="æœˆä»½" data-en="Month">æœˆä»½</span>
                        </label>
                        <select id="monthSelect" class="form-select form-select-lg" style="background: #000000; color: #F0F0F0; font-weight: 700; border: 2px solid #FF007F; padding: 1rem; font-size: 1.15rem; border-radius: 12px; box-shadow: 0 0 15px rgba(255, 0, 127, 0.3);">
                            {% for month in months %}
                            <option value="{{ month }}" {% if month == current_month %}selected{% endif %}>
                                {{ month }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- æŒ‰é’®ç»„ -->
                <div class="row g-4">
                    <div class="col-md-6 mb-2">
                        <button id="viewMonthlyBtn" class="btn w-100" style="background: linear-gradient(135deg, #FF007F 0%, #C1006C 100%); color: white; border: 2px solid #F0F0F0; padding: 1.2rem 2rem; font-size: 1.2rem; font-weight: 600; border-radius: 12px; box-shadow: 0 4px 15px rgba(255, 0, 127, 0.3), 0 0 20px rgba(240, 240, 240, 0.3);">
                            <i class="bi bi-file-text"></i> <span class="lang-text" data-zh="æŸ¥çœ‹æœˆåº¦æŠ¥å‘Š" data-en="View Monthly Report">æŸ¥çœ‹æœˆåº¦æŠ¥å‘Š</span>
                        </button>
                    </div>
                    <div class="col-md-6 mb-2">
                        <button id="viewYearlyBtn" class="btn w-100" style="background: linear-gradient(135deg, #322446 0%, #4A3564 100%); color: white; border: 2px solid #F0F0F0; padding: 1.2rem 2rem; font-size: 1.2rem; font-weight: 600; border-radius: 12px; box-shadow: 0 4px 15px rgba(75, 53, 100, 0.3), 0 0 20px rgba(240, 240, 240, 0.3);">
                            <i class="bi bi-calendar3-range"></i> <span class="lang-text" data-zh="æŸ¥çœ‹å¹´åº¦æ±‡æ€»" data-en="View Annual Summary">æŸ¥çœ‹å¹´åº¦æ±‡æ€»</span>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- å¿«é€Ÿè¯´æ˜ -->
    <div class="row justify-content-center mt-5">
        <div class="col-lg-10 col-xl-9">
            <div style="background: #000000; border: 2px solid #FF007F; border-radius: 20px; padding: 3rem 3.5rem; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6), 0 0 25px rgba(255, 0, 127, 0.4);">
                <h6 style="color: #F0F0F0; margin-bottom: 2rem; font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 15px rgba(240, 240, 240, 0.6); padding-bottom: 1rem; border-bottom: 2px solid #FF007F;">
                    <i class="bi bi-info-circle"></i> <span class="lang-text" data-zh="æŠ¥å‘Šè¯´æ˜" data-en="Report Description">æŠ¥å‘Šè¯´æ˜</span>
                </h6>
                <div style="color: #F0F0F0; font-size: 1.05rem; line-height: 2;">
                    <p style="font-size: 1.15rem; margin-bottom: 1.5rem;">
                        <strong style="color: #FF007F;">ğŸ“Š <span class="lang-text" data-zh="æœˆåº¦æ±‡æ€»æŠ¥å‘Š" data-en="Monthly Summary Report">æœˆåº¦æ±‡æ€»æŠ¥å‘Š</span></strong> 
                        <span style="color: #F0F0F0;" class="lang-text" data-zh="æ•´åˆè¯¥å®¢æˆ·æ‰€æœ‰ä¿¡ç”¨å¡çš„Supplieræ¶ˆè´¹ä¸ä»˜æ¬¾æƒ…å†µï¼š" data-en="Consolidates supplier expenses and payment records across all credit cards for this customer:">{{ t('supplier_2') }}</span>
                    </p>
                    <ul style="list-style: none; padding-left: 0; margin-left: 2rem;">
                        <li style="margin-bottom: 1.2rem; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 0, 127, 0.2);">
                            <strong style="color: #FF007F;">âœ¦ <span class="lang-text" data-zh="Supplieræ¶ˆè´¹" data-en="Supplier Expenses">{{ t('supplier_1') }}</span></strong>
                            <span style="color: #F0F0F0;" class="lang-text" data-zh="ï¼šè¯¥æœˆåœ¨æ‰€æœ‰ä¿¡ç”¨å¡ä¸Šçš„ä¾›åº”å•†æ¶ˆè´¹æ€»é¢" data-en=": Total supplier expenses across all cards for the month">ï¼šè¯¥æœˆåœ¨æ‰€æœ‰ä¿¡ç”¨å¡ä¸Šçš„ä¾›åº”å•†æ¶ˆè´¹æ€»é¢</span>
                        </li>
                        <li style="margin-bottom: 1.2rem; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 0, 127, 0.2);">
                            <strong style="color: #FF007F;">âœ¦ <span class="lang-text" data-zh="æ‰‹ç»­è´¹(1%)" data-en="Service Fee (1%)">æ‰‹ç»­è´¹(1%)</span></strong>
                            <span style="color: #F0F0F0;" class="lang-text" data-zh="ï¼šç³»ç»Ÿè‡ªåŠ¨è®¡ç®—çš„1%æœåŠ¡è´¹" data-en=": Automatically calculated 1% service fee">ï¼šç³»ç»Ÿè‡ªåŠ¨è®¡ç®—çš„1%æœåŠ¡è´¹</span>
                        </li>
                        <li style="margin-bottom: 1.2rem; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 0, 127, 0.2);">
                            <strong style="color: #FF007F;">âœ¦ <span class="lang-text" data-zh="ä»˜æ¬¾è®°å½•" data-en="Payment Records">ä»˜æ¬¾è®°å½•</span></strong>
                            <span style="color: #F0F0F0;" class="lang-text" data-zh="ï¼šé€šè¿‡è½¬è´¦/è¿˜æ¬¾ä¸ºå®¢æˆ·æ”¯ä»˜çš„é‡‘é¢" data-en=": Amount paid through bank transfers/repayments">ï¼šé€šè¿‡è½¬è´¦/è¿˜æ¬¾ä¸ºå®¢æˆ·æ”¯ä»˜çš„é‡‘é¢</span>
                        </li>
                        <li style="margin-bottom: 1.2rem; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 0, 127, 0.2);">
                            <strong style="color: #FF007F;">âœ¦ <span class="lang-text" data-zh="å‡€ä½™é¢" data-en="Net Balance">å‡€ä½™é¢</span></strong>
                            <span style="color: #F0F0F0;" class="lang-text" data-zh="ï¼šæ¶ˆè´¹+è´¹ç”¨-ä»˜æ¬¾çš„å¯¹è´¦ç»“æœ" data-en=": Reconciliation result (Expenses + Fee - Payments)">ï¼šæ¶ˆè´¹+è´¹ç”¨-ä»˜æ¬¾çš„å¯¹è´¦ç»“æœ</span>
                        </li>
                    </ul>
                    <p class="mb-0" style="color: #F0F0F0; font-size: 1.15rem; margin-top: 1.5rem; padding: 1rem; background: rgba(255, 0, 127, 0.1); border-left: 4px solid #FF007F; border-radius: 8px; text-shadow: 0 0 10px rgba(240, 240, 240, 0.5);">
                        <i class="bi bi-check-circle"></i> <span class="lang-text" data-zh="æ¯æœˆåŠæ—¶æŸ¥çœ‹ï¼Œæ¸…æ¥šæ˜äº†ï¼Œé¿å…è¯¯ä¼šï¼" data-en="Review monthly to stay clear and avoid misunderstandings!">æ¯æœˆåŠæ—¶æŸ¥çœ‹ï¼Œæ¸…æ¥šæ˜äº†ï¼Œé¿å…è¯¯ä¼šï¼</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const customerSelect = document.getElementById('customerSelect');
    const yearSelect = document.getElementById('yearSelect');
    const monthSelect = document.getElementById('monthSelect');
    const viewMonthlyBtn = document.getElementById('viewMonthlyBtn');
    const viewYearlyBtn = document.getElementById('viewYearlyBtn');
    const langToggle = document.getElementById('langToggle');
    const langBtnText = document.getElementById('langBtnText');

    // è¯­è¨€åˆ‡æ¢åŠŸèƒ½
    let currentLang = localStorage.getItem('preferredLanguage') || 'zh';
    
    function switchLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('preferredLanguage', lang);
        
        // æ›´æ–°æ‰€æœ‰å¸¦æœ‰ lang-text ç±»çš„å…ƒç´ 
        document.querySelectorAll('.lang-text').forEach(element => {
            const text = element.getAttribute(`data-${lang}`);
            if (text) {
                element.textContent = text;
            }
        });
        
        // æ›´æ–°æŒ‰é’®æ–‡å­—
        langBtnText.textContent = lang === 'zh' ? 'English' : 'ä¸­æ–‡';
    }
    
    // åˆå§‹åŒ–è¯­è¨€
    switchLanguage(currentLang);
    
    // è¯­è¨€åˆ‡æ¢æŒ‰é’®äº‹ä»¶
    langToggle.addEventListener('click', function() {
        const newLang = currentLang === 'zh' ? 'en' : 'zh';
        switchLanguage(newLang);
    });

    // æŸ¥çœ‹æœˆåº¦æŠ¥å‘Š
    viewMonthlyBtn.addEventListener('click', function() {
        const customerId = customerSelect.value;
        const year = yearSelect.value;
        const month = monthSelect.value;

        if (!customerId) {
            const alertMsg = currentLang === 'zh' ? 'è¯·å…ˆé€‰æ‹©å®¢æˆ·' : 'Please select a customer first';
            alert(alertMsg);
            return;
        }

        window.location.href = `/monthly-summary/report/${customerId}/${year}/${month}`;
    });

    // æŸ¥çœ‹å¹´åº¦æ±‡æ€»
    viewYearlyBtn.addEventListener('click', function() {
        const customerId = customerSelect.value;
        const year = yearSelect.value;

        if (!customerId) {
            const alertMsg = currentLang === 'zh' ? 'è¯·å…ˆé€‰æ‹©å®¢æˆ·' : 'Please select a customer first';
            alert(alertMsg);
            return;
        }

        window.location.href = `/monthly-summary/yearly/${customerId}/${year}`;
    });
});
</script>
{% endblock %}
