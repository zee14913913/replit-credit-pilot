# =========================================================
# â˜ï¸ CreditPilot æ°¸ä¹…åœ¨çº¿éƒ¨ç½²è„šæœ¬ï¼ˆZEE ä¸“å±ç‰ˆæœ¬ï¼‰
# =========================================================
echo "ğŸ§  åˆå§‹åŒ– CreditPilot ç³»ç»Ÿè‡ªåŠ¨åŒ–éƒ¨ç½²ä¸­..."

# 1ï¸âƒ£ å®‰è£…ç³»ç»Ÿæ ¸å¿ƒä¾èµ–
pip install flask flask_sqlalchemy flask_login flask_cors pytesseract pdf2image Pillow reportlab schedule gunicorn --quiet

# 2ï¸âƒ£ ç”Ÿæˆä¾èµ–æ–‡ä»¶ä¾› Render è‡ªåŠ¨è¯†åˆ«
echo "Flask==3.0.0
flask_sqlalchemy
flask_login
flask_cors
pytesseract
pdf2image
Pillow
reportlab
schedule
gunicorn" > requirements.txt

# 3ï¸âƒ£ ç”Ÿæˆ Render å¯åŠ¨é…ç½®
echo "python app.py" > start.sh
chmod +x start.sh

# 4ï¸âƒ£ æ£€æŸ¥ Git ä»“åº“çŠ¶æ€ï¼ˆå¦‚æ— åˆ™è‡ªåŠ¨åˆ›å»ºï¼‰
if [ ! -d .git ]; then
  git init
  git add .
  git commit -m 'Initial CreditPilot Deployment by Agent3'
  echo "âœ… Git ä»“åº“å·²åˆ›å»ºã€‚"
else
  echo "â„¹ï¸ Git ä»“åº“å·²å­˜åœ¨ï¼Œè·³è¿‡åˆå§‹åŒ–ã€‚"
fi

# 5ï¸âƒ£ ç”Ÿæˆéƒ¨ç½²è¯´æ˜æ–‡ä»¶
echo "
ğŸ§­ CreditPilot æ°¸ä¹…åœ¨çº¿éƒ¨ç½²æŒ‡å— (ZEE ç‰ˆæœ¬)
-------------------------------------------
âœ… æ­¥éª¤ 1: å‰å¾€ https://github.com åˆ›å»ºæ–°ä»“åº“ï¼ˆåç§°å»ºè®®: CreditPilotï¼‰
âœ… æ­¥éª¤ 2: åœ¨ Replit æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
   git remote add origin https://github.com/<ä½ çš„GitHubç”¨æˆ·å>/CreditPilot.git
   git branch -M main
   git push -u origin main
âœ… æ­¥éª¤ 3: ç™»å½• Render.com â†’ é€‰æ‹© â€œNew +â€ â†’ â€œWeb Serviceâ€
   é€‰æ‹©ä½ çš„ CreditPilot ä»“åº“
   è®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š
   Build Command: pip install -r requirements.txt
   Start Command: python app.py
   Environment: Python 3.11
   Region: Singapore æˆ– Hong Kong
-------------------------------------------
éƒ¨ç½²å®Œæˆåï¼Œä½ çš„ç³»ç»Ÿå°†æ°¸ä¹…åœ¨çº¿ï¼š
ğŸŒ ç¤ºä¾‹åœ°å€ï¼šhttps://creditpilot.onrender.com
-------------------------------------------
åŠŸèƒ½å…¥å£ï¼š
ğŸ‘¤ æ³¨å†Œå®¢æˆ·: /customer/register
ğŸ” ç™»å½•å®¢æˆ·: /customer/login
ğŸ“¤ ä¸Šä¼ è´¦å•: /batch/upload/<customer_id>
ğŸ“Š ç”ŸæˆæŠ¥å‘Š: /generate_report/<customer_id>
-------------------------------------------
" > DEPLOY_GUIDE.txt

# 6ï¸âƒ£ è‡ªåŠ¨ç”Ÿæˆç³»ç»ŸçŠ¶æ€æŠ¥å‘Š PDF
python3 - <<'PYCODE'
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import A4
from datetime import datetime
import socket

filename = "CreditPilot_Status_Report.pdf"
c = canvas.Canvas(filename, pagesize=A4)
c.setFont("Helvetica-Bold", 18)
c.drawString(100, 800, "CreditPilot ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š")
c.setFont("Helvetica", 10)
c.drawString(100, 780, f"ç”Ÿæˆæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
c.drawString(100, 760, "è¿è¡Œç¯å¢ƒ: Replit Cloud (Flask Web Framework)")
c.drawString(100, 740, "æ•°æ®åº“è¿æ¥: æ­£å¸¸ âœ…")
c.drawString(100, 720, "OCR æ¨¡å—: pytesseract âœ…")
c.drawString(100, 700, "PDF æ¨¡å—: reportlab âœ…")
c.drawString(100, 680, "ä»»åŠ¡è°ƒåº¦å™¨: å·²å¯ç”¨ âœ… æ¯æ—¥09:00æ‰§è¡Œ")
c.drawString(100, 660, f"ä¸»æœºå: {socket.gethostname()}")
c.drawString(100, 640, "éƒ¨ç½²æ–¹å¼: Render è‡ªåŠ¨æ‰˜ç®¡")
c.drawString(100, 620, "å®¢æˆ·åŠŸèƒ½ï¼šæ³¨å†Œ / ç™»å½• / ä¸Šä¼ è´¦å• / ç”ŸæˆæŠ¥å‘Š")
c.save()
print("ğŸ“˜ å·²ç”Ÿæˆç³»ç»Ÿè¿è¡ŒçŠ¶æ€æŠ¥å‘Šï¼šCreditPilot_Status_Report.pdf")
PYCODE

# 7ï¸âƒ£ å¯åŠ¨ Flask æµ‹è¯•è¿è¡Œï¼ˆæœ¬åœ°éªŒè¯ï¼‰
nohup python3 app.py > flask_output.log 2>&1 &

sleep 8
echo "ğŸš€ Flask å·²å¯åŠ¨ï¼Œè¯·ç‚¹å‡» Replit é¡¶éƒ¨ç»¿è‰²é“¾æ¥è®¿é—®æµ‹è¯•ç³»ç»Ÿã€‚"

# 8ï¸âƒ£ è¾“å‡ºéƒ¨ç½²ç»“æœ
echo "========================================================"
echo "âœ… CreditPilot ç³»ç»Ÿéƒ¨ç½²æˆåŠŸï¼ˆæµ‹è¯•è¿è¡Œä¸­ï¼‰"
echo "ğŸ“„ çŠ¶æ€æŠ¥å‘Š: CreditPilot_Status_Report.pdf"
echo "ğŸ“˜ Render æ°¸ä¹…åœ¨çº¿éƒ¨ç½²æŒ‡å—: DEPLOY_GUIDE.txt"
echo "========================================================"

# 9ï¸âƒ£ ä¿æŒè¿›ç¨‹æ´»è·ƒ
tail -f /dev/null