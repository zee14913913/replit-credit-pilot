çˆ½ã€‚è¿™å°±æ˜¯â€œä¸Šçº¿æ€â€ã€‚ä½ å·²ç»æŠŠå…³é”®ä»¶å…¨åˆ°äº†ä½ã€‚ğŸ‘

ä¸å¤šè¯´åºŸè¯ï¼Œç»™ä½ æ”¶å°¾ä¸‰ä»¶äº‹ï¼Œåšå®Œå°±å¯ä»¥é•¿æœŸè·‘ï¼š

1) é”å®šç°åœ¨è¿™ç‰ˆ
	â€¢	åœ¨ Replit çš„ History ç«‹åˆ»å»ºä¸ªå¿«ç…§ï¼šprod-2025-11-05
	â€¢	ä»¥åæ¯æ¬¡æ”¹åŠ¨ï¼Œéƒ½å…ˆæ–°å»ºå¿«ç…§ï¼›å‡ºäº‹ä¸€é”®å›æ»šã€‚

2) æ‰“å¼€â€œè‡ªæˆ‘æŠ¥è­¦â€

ç”¨ä½ ç°æˆçš„å·¥å…·å°±èƒ½åšä¸ªè½»é‡å‘Šè­¦ï¼ˆ5xx æ¿€å¢ â†’ å‘é‚®ä»¶/çŸ­ä¿¡ï¼‰ã€‚ç¤ºä¾‹ï¼ˆæ”¾åœ¨ main.py åŒçº§ä»»æ„æ¨¡å—å³å¯ï¼‰ï¼š

# accounting_app/alerts.py
import time, threading, collections, requests, os
WINDOW=60  # ç›‘æ§çª—å£ç§’
THRESH=5   # 1åˆ†é’Ÿå†…â‰¥5æ¬¡5xxå°±å‘Šè­¦
WEBHOOK=os.getenv("ALERT_WEBHOOK")  # ä½ è‡ªå·±å»ºä¸ª Slack/Discord/Webhook

events=collections.deque()

def record(status: int):
    now=time.time()
    events.append((now, status>=500))
    # æ»šåŠ¨çª—å£
    while events and now - events[0][0] > WINDOW:
        events.popleft()
    errs=sum(1 for t,e in events if e)
    if errs>=THRESH and WEBHOOK:
        try:
            requests.post(WEBHOOK, json={"text": f"[ALERT] {errs} errors in last {WINDOW}s"})
        except Exception: pass

åœ¨ä½ çš„è®¿é—®æ—¥å¿—ä¸­é—´ä»¶é‡ŒåŠ ä¸€è¡Œï¼š

from accounting_app.alerts import record
# ...
record(resp.status_code)

ç¯å¢ƒé‡ŒåŠ  ALERT_WEBHOOK=... å°±ç”Ÿæ•ˆï¼›ä¸é…å°±é™é»˜ã€‚

3) æ¯æ—¥è‡ªåŠ¨å¤‡ä»½ï¼ˆPostgresï¼‰

å¦‚æœä½ åœ¨ç”¨ Postgresï¼Œå‡†å¤‡ä¸ªç®€æ˜“æ—¥å¤‡ä»½ï¼ˆä¿å­˜è¿‘7å¤©ï¼‰ï¼Œæ”¾åå°çº¿ç¨‹å³å¯ï¼š

# accounting_app/backup.py
import os, time, threading, subprocess, datetime, shutil

def _dump():
    url=os.getenv("DATABASE_URL")  # ä½ å·²æœ‰
    if not url: return
    d=datetime.datetime.utcnow().strftime("%Y%m%d")
    out=f"/home/runner/pgdump_{d}.sql"
    subprocess.run(["pg_dump", url, "-f", out], check=False)
    # åªä¿ç•™7ä¸ª
    base="/home/runner"
    snaps=sorted([f for f in os.listdir(base) if f.startswith("pgdump_")])[-7:]
    for f in os.listdir(base):
        if f.startswith("pgdump_") and f not in snaps:
            try: os.remove(os.path.join(base,f))
            except: pass

def start_daily():
    def loop():
        while True:
            _dump()
            time.sleep(24*3600)
    threading.Thread(target=loop, daemon=True).start()

åœ¨ main.py å¯åŠ¨åæŒ‚ä¸Šï¼š

from accounting_app.backup import start_daily
start_daily()


â¸»

è¿è¥å°æŠ„ï¼ˆæ”¾åœ¨ README é¡¶éƒ¨å³å¯ï¼‰
	â€¢	å¥åº·ï¼šGET /healthï¼ˆhealthy/connected å³å¯ï¼‰
	â€¢	é™æµï¼šå¤§äº 10MB è¿”å› 413ï¼ˆå¯ç”¨ MAX_UPLOAD_MB è°ƒï¼‰
	â€¢	æ–‡æ¡£ï¼šENV=prod éšè— /docs
	â€¢	æ—¥å¿—ï¼šConsole è¾“å‡º JSONï¼Œæ…¢è¯·æ±‚ç›´æ¥çœ‹ ms å­—æ®µ
	â€¢	ä»»åŠ¡ï¼šæƒ³â€œé‡å¯ä¸ä¸¢â€ï¼Œé… REDIS_URL åé‡å¯
	â€¢	å›æ»šï¼šReplit â†’ History â†’ é€‰ prod-2025-11-05 â†’ Restore

åˆ°è¿™å„¿ï¼ŒåŸºæœ¬ç›˜ä½ å·²ç»æ‹¿ç¨³äº†ã€‚åé¢è¦åŠ åŠŸèƒ½ï¼ˆå¯¼å‡ºã€å¯¹è´¦ã€Webhook ç­‰ï¼‰ï¼Œä½ ä¸¢ç»™æˆ‘â€œè¦ä»€ä¹ˆâ€ï¼Œæˆ‘å°±ç»™ä½ å¯ç›´æ¥è¦†ç›–çš„æ–‡ä»¶ï¼Œä¸ç»•å¼¯ã€‚