éå¸¸å¥½ âœ…
æˆ‘çœ‹åˆ°ä½ ç°åœ¨ Replit çš„åç«¯ï¼ˆFlask + FastAPIï¼‰éƒ¨åˆ†è¿è¡Œç¨³å®šã€Blueprints å·²æ³¨å†Œå®Œæ¯•ï¼Œè¯´æ˜ç³»ç»Ÿå·²ç»å‡†å¤‡å¥½è¿›è¡Œä¸‹ä¸€é˜¶æ®µå·¥ä½œã€‚
ç›®å‰å»ºè®®ä½ æ‰§è¡Œä»¥ä¸‹ **API æµ‹è¯•é˜¶æ®µï¼ˆPhase Tï¼‰**ï¼Œç¡®ä¿æ‰€æœ‰ç«¯ç‚¹ã€è´¦æœ¬æ‹†åˆ†ä¸æ™ºèƒ½ä¼˜åŒ–é€»è¾‘å®Œå…¨ä¸€è‡´ï¼š

---

## ğŸ§ª Phase Tï¼šAPI æµ‹è¯•ä¸éªŒè¯æŒ‡å—ï¼ˆé€‚ç”¨äº Replit ç¯å¢ƒï¼‰

### 1ï¸âƒ£ æ ¸å¿ƒæµ‹è¯•ç›®æ ‡

| æ¨¡å—      | ç›®çš„                                     |
| ------- | -------------------------------------- |
| æ‰‹ç»­è´¹æ‹†åˆ†éªŒè¯ | ç¡®è®¤ 1% merchant fee è¢«ç‹¬ç«‹è®¡å…¥ Owner è´¦æœ¬      |
| æ™ºèƒ½æ’å¡ä¼˜åŒ–  | ç¡®è®¤ generate-plan ä¸ confirm-plan è¿”å›ç»“æ„æ­£ç¡® |
| é£é™©éªŒè¯    | æ¨¡æ‹Ÿé«˜åˆ©ç”¨ç‡å¡ > 90% è§¦å‘ risk_validator        |
| å¯¹è´¦ä¸€è‡´æ€§   | ç¡®è®¤æœˆç»“ owner + gz ä½™é¢ = è´¦å•æ€»é¢ Â± 0.01       |

---

### 2ï¸âƒ£ Postman / cURL æµ‹è¯•æ ·ä¾‹

#### ç”Ÿæˆæ’å¡è®¡åˆ’

```bash
POST https://<your-replit-url>/api/card-optimizer/generate-plan
Content-Type: application/json

{
  "customer_id": "CJY001",
  "cards": [
    {"card_id": "MBB1234", "limit": 20000, "used": 12000, "due_date": "2025-12-05"},
    {"card_id": "CIMB4567", "limit": 15000, "used": 3000, "due_date": "2025-12-12"}
  ]
}
```

âœ… **é¢„æœŸè¿”å›**

* æ¯å¡è¯„åˆ† (score)
* æ¨èåˆ·å¡çª—å£ (optimal_start / end)
* å…æ¯æœŸ (free_days â‰ˆ 50)
* é£é™©ç­‰çº§ risk_level = LOW/MEDIUM/HIGH

---

#### ç¡®è®¤æ‰§è¡Œè®¡åˆ’

```bash
POST https://<your-replit-url>/api/card-optimizer/confirm-plan
Content-Type: application/json

{
  "plan_id": "PLAN-202511-CJY001",
  "consent": true,
  "confirmed_by": "admin"
}
```

âœ… **é¢„æœŸ**

* çŠ¶æ€ "executed"
* card_risk_consents è¡¨æ–°å¢ä¸€è¡Œï¼ˆå« timestamp + userï¼‰

---

#### æ¨¡æ‹Ÿ Supplier æ¶ˆè´¹ + æ‰‹ç»­è´¹æ‹†åˆ†

```bash
POST https://<your-replit-url>/api/accounting/import-transaction
Content-Type: application/json

{
  "customer_id": "CJY001",
  "description": "7SL TECH SDN BHD",
  "amount": 1000.00,
  "type": "DEBIT"
}
```

âœ… **é¢„æœŸæ•°æ®åº“ç»“æœ**

| è¡¨            | æ–°çºªå½•                                                                   |
| ------------ | --------------------------------------------------------------------- |
| transactions | 2 æ¡ â†’ (1) GZ æ¶ˆè´¹ 1000 (infinite_expense)  (2) Owner æ‰‹ç»­è´¹ 10 (owner_fee) |
| å­—æ®µéªŒè¯         | `is_fee_split=true`, `fee_reference_id` æŒ‡å‘åŸäº¤æ˜“                         |

---

#### é£é™©è§¦å‘æµ‹è¯•

ä¿®æ”¹è¯·æ±‚ used > limit Ã— 0.9 â†’ è¿”å›ï¼š

```json
{"risk_flag": "EXTREME", "advice": "Do not use this card until repayment."}
```

---

### 3ï¸âƒ£ éªŒè¯è´¦æœ¬ä¸ç»“ç®—

æ‰§è¡Œï¼š

```bash
GET /api/accounting/monthly-summary?customer_id=CJY001&month=2025-11
```

âœ… **éªŒè¯è¦ç‚¹**

* `total_infinite_expenses` = GZ æ”¯ä»˜æ€»é¢
* `total_owner_fees` = 1% åˆè®¡
* `closing_balance` = å‰æœŸ + æ¶ˆè´¹ + æ‰‹ç»­è´¹ âˆ’ ä»˜æ¬¾
* `diff â‰¤ 0.01` â†’ è§†ä¸ºå¯¹è´¦æˆåŠŸ

---

### 4ï¸âƒ£ å®¡è®¡éªŒè¯

åœ¨ db/audit_logs æˆ– API `/api/audit/logs` ä¸­åº”æ–°å¢ï¼š

* æ¨¡å— = â€œcard_optimizerâ€
* åŠ¨ä½œ = â€œgenerate_planâ€ ä¸ â€œconfirm_planâ€
* çŠ¶æ€ = success

---

## âœ… æµ‹è¯•é€šè¿‡åä¸‹ä¸€æ­¥

1. æˆ‘å°†ç”Ÿæˆ **å‰ç«¯UIè“å›¾**ï¼ˆåŒ…æ‹¬ Optimizer Dashboardã€é£é™©ç¡®è®¤å¼¹çª—ã€æ—¥å†è§†å›¾ï¼‰
2. ä¹‹åå†é›†æˆåˆ°è´¦æœ¬é¡µé¢ (Credit Cards â†’ Optimizer Tab)
3. åŒæ­¥æ›´æ–° monthly report æ¨¡æ¿ï¼Œæ˜¾ç¤º Owner ä¸ GZ åˆ†è´¦åŠ 1% fee æ˜ç»†

---

ç¡®è®¤ä¸€ä¸‹ï¼š
æ˜¯å¦è¦æˆ‘ç°åœ¨ç›´æ¥ç”Ÿæˆè¿™ä»½ **Postman collection + æµ‹è¯•æ•°æ®æ–‡ä»¶ï¼ˆJSONï¼‰**ï¼Œ
è®©ä½ åœ¨ Replit é‡Œä¸€é”®å¯¼å…¥æµ‹è¯•ï¼Ÿ
