å¤ªå¥½äº†ï¼Œè¿™ä»½éªŒè¯æŠ¥å‘Šå¾ˆæ¸…æ¥šã€‚ä½ çš„ç³»ç»Ÿç°åœ¨åªè·‘ FastAPIã€/health=healthyã€pypdfium2 + Tesseract æ­£å¸¸â€”â€”åœ°åŸºç¨³äº†ã€‚æ¥ä¸‹æ¥æˆ‘ç»™ä½ ä¸€è½®â€œå¯¹ç—‡æŠ›å…‰â€ï¼Œæ¯æ¡éƒ½çŸ­ã€èƒ½ç›´æ¥å¤åˆ¶ã€‚

â¸»

ä½ ç°åœ¨è¿˜å¯ä»¥ç«‹åˆ»æŠ›å…‰çš„ 6 ä»¶å°äº‹

1) ç«¯å£æ”¹æˆ $PORTï¼ˆé¿å…ä»¥åå¤–ç½‘æ˜ å°„é—®é¢˜ï¼‰

ä½ ç°åœ¨ç»‘å®šçš„æ˜¯ 5000ã€‚åœ¨ Replit æœ€ç¨³å¦¥æ˜¯è·Ÿéš $PORTã€‚
æŠŠ .replit æ”¹æˆè¿™ä¸€è¡Œï¼š

run = "python -m uvicorn accounting_app.main:app --host 0.0.0.0 --port $PORT"

è¿™æ ·æ‰©ç¼©å®¹/é‡å¯éƒ½ä¸æ€•ç¯å¢ƒç«¯å£å˜åŒ–ã€‚

â¸»

2) ç»Ÿä¸€å¯¹å¤–æç¤ºå£å¾„ï¼ˆæ—¥å¿—é‡Œåˆ«å†å‡ºç° 8000ï¼‰

ä½ çš„å¯åŠ¨æ—¥å¿—é‡Œè¿˜æ‰“å°äº† â€œdocs åœ¨ 8000â€ï¼Œå’Œå®é™… 5000 ä¸ä¸€è‡´ã€‚æŠŠé‚£å¥æç¤ºåˆ æ‰æˆ–æ”¹æˆç”¨ç¯å¢ƒå˜é‡æ‰“å°ï¼Œé¿å…è¯¯å¯¼ã€‚

# åœ¨ accounting_app/main.py é‡Œï¼ˆå¦‚æœä½ æœ‰è¿™ç±»æç¤ºï¼‰
import os
print(f"ğŸ“Š APIæ–‡æ¡£: /docs  ï¼ˆç«¯å£ç”±å¹³å°åˆ†é…ï¼š{os.getenv('PORT','auto')}ï¼‰")


â¸»

3) æ¸…æ‰ç¯å¢ƒé‡Œæ®‹ç•™çš„ Flask åŒ…ï¼ˆå¯é€‰ä½†æ¨èï¼‰

pip freeze ä»æ˜¾ç¤º Flask ç³»åˆ—ï¼ˆè™½ç„¶ requirements å·²ç§»é™¤ï¼‰ã€‚ä¸ºäº†æ›´å¹²å‡€ï¼š

pip uninstall -y Flask Flask-Login Flask-SQLAlchemy gunicorn itsdangerous Jinja2 Werkzeug

å¯é€‰ï¼šä¸å½±å“è¿è¡Œï¼Œä½†èƒ½å‡å°‘å°†æ¥ç‰ˆæœ¬å†²çªçš„æ¦‚ç‡ã€‚

â¸»

4) ä¸Šä¼ å¤§å°é™æµï¼ˆé˜²æ­¢å¤§ PDF æ’æ­»å†…å­˜ï¼‰

ç»™æ–‡ä»¶ä¸Šä¼ æ¥å£åŠ ä¸€ä¸ªè½»é‡é™åˆ¶ï¼ˆä¾‹å¦‚ 10MBï¼‰ï¼š

# ä¾‹ï¼šåœ¨ä½ çš„ FastAPI è·¯ç”±ä¾èµ–é‡Œ
from fastapi import Request, HTTPException

MAX_BYTES = 10 * 1024 * 1024  # 10MB

async def guard_content_length(request: Request):
    cl = request.headers.get("content-length")
    if cl and int(cl) > MAX_BYTES:
        raise HTTPException(413, detail="File too large (max 10MB)")

# ç”¨æ³•ï¼šåœ¨ä¸Šä¼ è·¯ç”±ä¸ŠåŠ  dependencies=[Depends(guard_content_length)]
from fastapi import Depends

@router.post("/files/pdf-to-text", dependencies=[Depends(guard_content_length)])
async def pdf_to_text(...):
    ...


â¸»

5) OCR æ”¾åå°çº¿ç¨‹ï¼Œæ¥å£æ›´â€œç§’å›â€

æ‰«æä»¶ä¼šæ…¢ã€‚æŠŠ OCR æ”¾åå°ï¼Œæ¥å£å…ˆå›ä»»åŠ¡ idï¼Œå‰ç«¯è½®è¯¢ç»“æœï¼š

# accounting_app/routers/files.py
import asyncio
from uuid import uuid4
from fastapi import APIRouter, UploadFile, File
from .storage import TASKS  # ç®€å•å†…å­˜å­—å…¸ï¼šTASKS = {}

router = APIRouter(prefix="/files", tags=["files"])

@router.post("/pdf-to-text/submit")
async def submit(file: UploadFile = File(...)):
    data = await file.read()
    task_id = str(uuid4())
    TASKS[task_id] = {"status": "processing", "result": None}

    async def run():
        text = await asyncio.to_thread(pdf_bytes_to_text, data)  # ç”¨ä½ å·²ç»å†™å¥½çš„å·¥å…·å‡½æ•°
        TASKS[task_id] = {"status": "done", "result": text}

    asyncio.create_task(run())
    return {"task_id": task_id, "status": "queued"}

@router.get("/pdf-to-text/result/{task_id}")
async def result(task_id: str):
    return TASKS.get(task_id, {"status": "not_found"})

å¥½å¤„ï¼šç”¨æˆ·ä½“éªŒæ›´é¡ºï¼›ä¸å®¹æ˜“è¢«é•¿è€—æ—¶é˜»å¡ã€‚

â¸»

6) CORS æ”¶ç´§ & æ–‡æ¡£å¼€å…³ï¼ˆå®‰å…¨ç¨³ä¸€ç‚¹ï¼‰

ç°åœ¨å…è®¸ * æ²¡é—®é¢˜ï¼Œä½†ä¸Šçº¿æ—¶å»ºè®®æ”¶ç´§æˆä½ çš„å‰ç«¯åŸŸåï¼›åŒæ—¶åªåœ¨å¼€å‘ç¯å¢ƒå¼€å¯ docsï¼š

# main.py
from fastapi.openapi.utils import get_openapi
from fastapi.middleware.cors import CORSMiddleware
import os

origins = os.getenv("CORS_ALLOW", "*").split(",")
app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

if os.getenv("ENV") == "prod":
    app.docs_url = None
    app.redoc_url = None
    app.openapi_url = None


â¸»

å°ç»“ï¼ˆä½ èƒ½é©¬ä¸Šçœ‹åˆ°çš„å˜åŒ–ï¼‰
	â€¢	ç»‘å®š $PORT â†’ é‡å¯/æ‰©å®¹æ›´ç¨³ï¼Œä¸å—ç«¯å£å†™æ­»å½±å“ã€‚
	â€¢	æ—¥å¿—ä¸å†â€œå£å¾„ä¸ä¸€è‡´â€ â†’ æ’é”™çœå¿ƒã€‚
	â€¢	ï¼ˆå¯é€‰ï¼‰å¸æ‰ Flask æ®‹ç•™ â†’ æœªæ¥åŒ…å†²çªæ¦‚ç‡ä¸‹é™ã€‚
	â€¢	ä¸Šä¼ é™æµ + åå° OCR â†’ å¤§æ–‡ä»¶ä¸è‡´å¡æ­»ã€æ¥å£å“åº”æ›´å¿«ã€‚
	â€¢	CORS/æ–‡æ¡£å¼€å…³ â†’ ä¸Šçº¿æ›´å®‰å…¨ã€‚

ä½ è¦æ˜¯æ„¿æ„ï¼Œæˆ‘å¯ä»¥æŠŠä½ ç°åœ¨çš„ main.py å’Œä¸Šä¼ è·¯ç”±ï¼Œç›´æ¥æŒ‰ä¸Šé¢ 4â€“6 ç‚¹æ”¹æˆâ€œå¯æ›¿æ¢ç‰ˆæœ¬â€ç»™ä½ ï¼›ä½ åªç®¡è¦†ç›–ã€‚