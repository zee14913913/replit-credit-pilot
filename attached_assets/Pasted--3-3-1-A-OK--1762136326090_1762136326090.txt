说实话：整体已经成型了，但还有3个“关键小洞”没补上，所以现在还不能说是你想要的“上传什么都能引导到底”的那种成品版。

我直接点你这次测试里的3个问题讲👇
	1.	案例A：OK

	•	后端：✅ 成功、落库路径正确
	•	前端：✅ 跳到 /files/detail/19
	•	小问题：列表高亮显示的是最新一条（ID=21），不是本次上传的ID=19
	•	要做的：列表页要“优先高亮这次上传的ID”，不是永远高亮最新。做法：上传成功时在redirect里带 ?highlight=19，列表页读取这个参数去高亮。

	2.	案例B（缺行）：不合格的点在这里

	•	后端：返回的是 422/业务失败结构 ✅
	•	前端：❌ 没跳详情，停在 dashboard
	•	这跟我们指令里的“失败也要看到这一份”不一致
	•	要做的：upload 成功 or 业务失败但已落库 → 都要跳 /files/detail/{raw_document_id}，不能因为422就停在上传页。你这条有 file_saved，有错误行，也就是说 raw_documents 已经有了，就应该跳。

	3.	案例C（重复）：后端逻辑还没真做“duplicate”

	•	现在返回的是 success + imported + matched
	•	说明你的“同公司+同账号+同月份检测”还没上（只是存到同一个目录）
	•	要做的：在 8000 的 /api/v2/import/bank-statement 里加这一段：
	•	查 file_index/raw_documents 是否已有 (company_id, account_number, statement_month) = 当前这条
	•	如果有 → 返回 {success: true, status: “duplicate”, existing_file_id: …, next_actions:[…]}
	•	Flask 收到 status=duplicate → 在 file_detail.html 顶部出红条 + 按钮【设为主账单】【查看本月其他账单】

你只要把这3个点补上，这一版就能交给客户用了。

下面是你可以直接贴给 replit 的“修正指令版”👇

请继续在当前项目上做“前端与状态一致性修正”，按下面3条做，不要省略，也不要让我再重新上传文件：

1. 失败也要跳详情
- 修改 Flask 上传处理（dashboard.html 对应的视图/JS）：
  - 不管后端返回 success=true 还是 success=false 但带有 file_saved/raw_document_id，都要跳转到 /files/detail/<raw_document_id>
  - 只有后端完全没存下来的网络错误才留在当前页
- 详情页要能显示 422 的业务错误内容，用 status_reason 或 validation_errors 列表

2. 列表高亮要按这次上传的ID
- 上传成功后，跳到 /files/list?highlight=<file_id>
- files_list.html 里读取 request.args.get("highlight")，该行加高亮，即使它不是最新一条也要高亮
- 这样我测试 A/B/C 3次，3次都能看到“就是我刚才那份”

3. 补上真正的 duplicate 判断（在 FastAPI 8000 里）
- 在 /api/v2/import/bank-statement 入口增加：
  - 先查 raw_documents/file_index 是否已有同一 company_id + account_number + statement_month 的 active/validated 文件
  - 如果有：
    return {
      "success": true,
      "status": "duplicate",
      "duplicate_warning": "当前公司/账号/月份已有主对账单",
      "file_id": <当前新建的文件ID>,
      "existing_file_id": <已有的文件ID>,
      "next_actions": ["set_as_primary", "view_other_files"]
    }
- Flask 的 /files/detail/<id> 遇到 status=duplicate 时显示红色banner + 上面这两个按钮
- 点击还未实现的按钮时，照现在的逻辑弹“后端接口未实现：/api/files/set-primary，请补全”

完成后，请你再重新跑我同一套三文件测试，并按这个格式回我（注意，B 这次必须要有跳转URL）：

A. 标准CSV：
- backend: {...真实JSON...}
- frontend_url: ...
- list_highlighted: true/false
- next_buttons: [...]

B. 缺行CSV（要有跳转）：
- backend: {...真实JSON...}
- frontend_url: http://.../files/detail/<id>   ←这次必须有
- list_highlighted: true
- next_buttons: ["查看异常", "重新处理"]

C. 重复月份：
- backend: {...必须有status: "duplicate"...}
- frontend_url: ...
- show_red_banner: true
- next_buttons: ["设为主账单", "查看本月其他账单"]

补这3条以后，还有两件小事你要顺手说清楚给它：
	1.	“所有新文案请走 lang/en.json 和 lang/zh.json，不要再写中文在模板里了，尤其是：成功导入、验证失败、重复上传、下一步操作、查看异常、生成报表 这些。”
	2.	“TASK_SECRET_TOKEN 和 SECRET_KEY 我已经会配，你只要在代码里引用，不要写死。”

这样讲，replit 就没借口只做好一半了。