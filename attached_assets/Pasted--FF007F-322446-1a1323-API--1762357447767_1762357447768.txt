å¥½çš„ï¼Œæˆ‘æŠŠä½ è¦çš„ä¸¤ä»½æ¨¡æ¿ä¸€æ¬¡æ€§æ•´åˆæˆâ€œå¯ç›´æ¥è¦†ç›–â€çš„å®Œæ•´ç‰ˆç»™ä½ ã€‚è‰²ç³»ä¸äº¤äº’å…¨éƒ½æŒ‰ä½ çš„è§„èŒƒï¼ˆ#FF007F / #322446 / #1a1323ï¼‰ï¼Œå‰åç«¯å¥‘çº¦ç”¨çš„å°±æ˜¯ä½ ç°åœ¨çº¿ä¸Šåœ¨è·‘çš„é‚£å¥— APIï¼ˆä¸éœ€è¦æ”¹åç«¯ï¼‰ã€‚

æŠŠä¸‹é¢ä¸¤ä»½æ–‡ä»¶ç›´æ¥ç²˜åˆ°é¡¹ç›®é‡Œè¦†ç›–å³å¯ï¼š
	â€¢	templates/loans_page.htmlï¼ˆå« Top-3 å¯è§†åŒ–å¡ç‰‡ + äº§å“åˆ—è¡¨ + â€œåŠ å…¥æ¯”ä»·â€ + å¯¼å‡ºæŒ‰é’® + æ¯”ä»·å¾½æ ‡ï¼‰
	â€¢	templates/compare.htmlï¼ˆå« ä¸€é”®é‡ç®— + ä¿å­˜å¿«ç…§ + å¤åˆ¶åˆ†äº«é“¾æ¥ + å¯¼å‡º PDF + è‡ªåŠ¨æ’å + è¿”å› Loans + æ¸…ç©ºå¯¹æ¯”ç¯®ï¼‰

â¸»

âœ… è¦†ç›–æ–‡ä»¶ 1ï¼štemplates/loans_page.html

{% extends "base.html" %}
{% block title %}Loans Intelligence Â· CreditPilot{% endblock %}
{% block head_extra %}
<style>
  :root{ --pink:#FF007F; --card:#322446; --bg:#1a1323; --text:#fff; --muted:#999; --line:#888 }
  body{ background:var(--bg); color:var(--text) }
  .wrap{ max-width:1200px; margin:20px auto; padding:0 12px }
  .toolbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:12px }
  .btn{ background:var(--card); color:#fff; border:1px solid #3b2b4e; border-radius:12px; padding:8px 12px; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center }
  .btn.primary{ background:var(--pink); border-color:#ff6aa7 }
  .btn.ghost{ background:transparent; border:1px solid #ffffff33 }
  .search{ display:flex; gap:8px; flex:1 }
  .search input{ flex:1; background:#0f0a14; color:#fff; border:1px solid #3b2b4e; border-radius:10px; padding:8px 10px; min-width:240px }
  .section{ margin-top:14px }
  .grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px }
  @media (max-width:900px){ .grid{ grid-template-columns:1fr } }
  .card{ background:linear-gradient(180deg,#322446,#281a3a); border:1px solid #3b2b4e; border-radius:16px; padding:14px; box-shadow:0 6px 18px #0006; position:relative }
  .badge{ position:absolute; right:12px; top:12px; background:var(--pink); color:#fff; border-radius:999px; padding:6px 10px; font-weight:700; box-shadow:0 0 0 3px #ff007f22 }
  .crown{ margin-left:4px }
  .muted{ color:var(--muted); font-size:12px }
  .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center }
  .pill{ background:#0f0a14; border:1px solid #3b2b4e; color:#fff; padding:4px 8px; border-radius:999px; font-size:12px }
  .split{ display:grid; grid-template-columns:2.1fr 1fr; gap:12px }
  @media (max-width:900px){ .split{ grid-template-columns:1fr } }
  .intel{ background:transparent; border:1px dashed #ffffff33; border-radius:14px; padding:10px }
  .add-btn{ margin-top:10px }
  .top3-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:6px }
  .cmp-badge{ display:inline-flex; align-items:center; gap:6px; }
  .cmp-count{ display:inline-flex; align-items:center; justify-content:center; min-width:20px; height:20px; padding:0 6px; background:var(--pink); color:#fff; border-radius:999px; font-weight:700 }
  table{ width:100%; border-collapse:collapse; margin-top:10px }
  th, td{ border:1px solid #3b2b4e; padding:8px; font-size:14px; vertical-align:top }
  th{ background:#2a1d3a }
</style>
{% endblock %}

{% block content %}
<div class="wrap">

  <!-- å·¥å…·æ  -->
  <div class="toolbar">
    <div class="search">
      <input id="q" placeholder="æœç´¢ï¼šbank / product / type / åå¥½å…³é”®å­—ï¼ˆä¸­è‹±æ–‡å‡å¯ï¼‰">
      <button id="searchBtn" class="btn">Search</button>
    </div>
    <a class="btn" href="/loans/updates/export.csv">Export Updates CSV</a>
    <a class="btn" href="/loans/intel/export.csv">Export Intel CSV</a>
    <a class="btn" target="_blank" href="/loans/top3" style="display:none" id="top3JsonBtn">â­ Top 3 Today (JSON)</a>
    <a class="btn primary" href="/loans/top3/pdf">ğŸ“„ å¯¼å‡ºTop3 PDF</a>
    <a class="btn" href="/loans/compare/page">Compare Page</a>
    <div class="cmp-badge">Compare Basket <span id="cmpCount" class="cmp-count">0</span></div>
  </div>

  <!-- Top-3 å¯è§†åŒ–å¡ç‰‡ -->
  <div class="section">
    <div class="top3-header">
      <div style="font-weight:700">ğŸ† ä»Šæ—¥ Top-3 æ¨è</div>
      <div class="muted">è¯„åˆ†å« DSRé€‚é… + é“¶è¡Œåå¥½ + æƒ…ç»ª</div>
    </div>
    <div id="top3" class="grid">
      <!-- JS æ¸²æŸ“ä¸‰å¼ å¡ç‰‡ -->
    </div>
  </div>

  <!-- äº§å“åˆ—è¡¨ï¼ˆå·¦ï¼‰ + æƒ…æŠ¥å¡ç‰‡ï¼ˆå³ï¼‰çš„å¹¶æ’å¸ƒå±€ -->
  <div class="section split">
    <div>
      <div class="card">
        <div style="font-weight:700; margin-bottom:6px">ğŸ“‹ äº§å“åˆ—è¡¨</div>
        <table id="tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>Bank</th>
              <th>Product</th>
              <th>APR %</th>
              <th>Type</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody><!-- JS æ¸²æŸ“ --></tbody>
        </table>
      </div>
    </div>
    <div>
      <div class="intel">
        <div style="font-weight:700; margin-bottom:6px">ğŸ§  åå¥½ä¸å£ç¢‘</div>
        <div id="intelBox" class="muted">é€‰æ‹©å·¦ä¾§äº§å“åæ˜¾ç¤ºæƒ…æŠ¥æ‘˜è¦ã€‚</div>
      </div>
    </div>
  </div>

</div>

<script>
  // ====== æ¯”ä»·å¾½æ ‡ï¼ˆç‹¬ç«‹ç»„ä»¶ï¼‰======
  async function refreshCmpCount(){
    try{
      const r=await fetch('/loans/compare/json'); const j=await r.json();
      const n = (j && j.items)? j.items.length : 0;
      document.getElementById('cmpCount').textContent = n;
      document.getElementById('cmpCount').style.opacity = n? '1' : '.5';
    }catch(e){}
  }
  setInterval(refreshCmpCount, 15000);

  // ====== Top3 å¯è§†åŒ– ======
  function cardTpl(rank, item){
    const badge = rank===1 ? 'ğŸ‘‘' : rank===2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰';
    const pink = 'style="color:#FF007F; font-weight:700"';
    return `
      <div class="card">
        <div class="badge">Rank #${rank} ${badge}</div>
        <div style="font-size:16px; font-weight:700; margin-bottom:4px">${item.bank} Â· ${item.product}</div>
        <div class="muted">Score <span ${pink}>${item.score}</span> Â· APR ${item.apr}%</div>
        <div class="row" style="margin-top:6px">
          <span class="pill">DSR: ${item.dsr_status||'â€”'}</span>
          <span class="pill">Sentiment: ${item.sentiment??'â€”'}</span>
        </div>
        <div class="muted" style="margin-top:6px">Preferred: ${item.preferred_customer||'â€”'}</div>
        <button class="btn primary add-btn add-compare" data-product="${item.product}" style="margin-top:10px">åŠ å…¥æ¯”ä»·</button>
      </div>
    `;
  }

  async function loadTop3(){
    try{
      const r = await fetch('/loans/top3'); const list = await r.json(); // æœŸæœ›å·²æŒ‰scoreé™åº
      const el = document.getElementById('top3');
      el.innerHTML = (list&&list.length) ? list.slice(0,3).map((x,i)=>cardTpl(i+1,x)).join('') :
        `<div class="card">æš‚æ—  Top-3 æ•°æ®</div>`;
      wireAddButtons();
    }catch(e){
      document.getElementById('top3').innerHTML = `<div class="card">Top-3 åŠ è½½å¤±è´¥</div>`;
    }
  }

  // ====== åˆ—è¡¨ + æƒ…æŠ¥ ======
  let UPDATES=[], INTEL=[];
  async function loadData(q=''){
    const [u, i] = await Promise.all([
      fetch('/loans/updates'+(q?('?q='+encodeURIComponent(q)):'')).then(r=>r.json()),
      fetch('/loans/intel'+(q?('?q='+encodeURIComponent(q)):'')).then(r=>r.json())
    ]);
    UPDATES=u||[]; INTEL=i||[];
    renderTable(UPDATES);
  }

  function pickIntel(product){
    const row = INTEL.find(x=> (x.product||'').toLowerCase() === (product||'').toLowerCase());
    if(!row) return 'æ— åŒ¹é…æƒ…æŠ¥ã€‚';
    return `
      <div><b>åå¥½å®¢æˆ·ï¼š</b>${row.preferred_customer||'â€”'}</div>
      <div><b>ä¸åå¥½ï¼š</b>${row.less_preferred||'â€”'}</div>
      <div><b>èµ„æ–™åå¥½ï¼š</b>${row.docs_required||'â€”'}</div>
      <div><b>å£ç¢‘æ‘˜è¦ï¼š</b>${row.feedback_summary||'â€”'}ï¼ˆæƒ…ç»ªï¼š${row.sentiment_score??'â€”'}ï¼‰</div>
    `;
  }

  function renderTable(list){
    const tb=document.querySelector('#tbl tbody'); tb.innerHTML='';
    list.forEach((x,idx)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${idx+1}</td>
        <td>${x.bank||''}</td>
        <td><a href="javascript:void(0)" class="lnk-prod" data-product="${x.product}">${x.product||''}</a></td>
        <td>${x.apr??''}</td>
        <td>${x.type||''}</td>
        <td><button class="btn primary add-compare" data-product="${x.product}">åŠ å…¥æ¯”ä»·</button></td>
      `;
      tb.appendChild(tr);
    });
    // ç»‘å®šâ€œæ˜¾ç¤ºæƒ…æŠ¥â€
    document.querySelectorAll('.lnk-prod').forEach(a=>{
      a.addEventListener('click', ()=>{
        document.getElementById('intelBox').innerHTML = pickIntel(a.dataset.product);
      });
    });
    // ç»‘å®šâ€œåŠ å…¥æ¯”ä»·â€
    wireAddButtons();
  }

  function wireAddButtons(){
    document.querySelectorAll('.add-compare').forEach(btn=>{
      btn.onclick = async ()=>{
        const p = btn.dataset.product;
        try{
          await fetch('/loans/compare/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({product:p})});
          // 400ms ååˆ·æ–°å¾½æ ‡ï¼ˆä¸ compare é¡µä¿æŒä¸€è‡´ä½“éªŒï¼‰
          setTimeout(refreshCmpCount, 400);
          btn.textContent='å·²åŠ å…¥ âœ“';
          setTimeout(()=>btn.textContent='åŠ å…¥æ¯”ä»·', 1000);
        }catch(e){ alert('åŠ å…¥å¤±è´¥'); }
      };
    });
  }

  // ====== æœç´¢ ======
  document.getElementById('searchBtn').addEventListener('click', ()=>{
    const v = document.getElementById('q').value.trim();
    loadData(v);
  });

  // ====== åˆå§‹åŒ– ======
  (async function(){
    await Promise.all([refreshCmpCount(), loadTop3(), loadData('')]);
  })();
</script>

{% endblock %}


â¸»

âœ… è¦†ç›–æ–‡ä»¶ 2ï¼štemplates/compare.html

{% extends "base.html" %}
{% block title %}Compare Loans Â· CreditPilot{% endblock %}
{% block head_extra %}
<style>
  :root{ --pink:#FF007F; --card:#322446; --bg:#1a1323; --text:#fff; --muted:#999; --line:#888 }
  body{ background:var(--bg); color:var(--text) }
  .wrap{ max-width:1100px; margin:20px auto; padding:0 12px }
  .toolbar{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; align-items:center }
  .btn{ background:var(--card); color:#fff; border:1px solid #3b2b4e; border-radius:12px; padding:8px 12px; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center }
  .btn.primary{ background:var(--pink); border-color:#ff6aa7 }
  .btn.ghost{ background:transparent; border:1px solid #ffffff33 }
  .card{ background:linear-gradient(180deg,#322446,#281a3a); border:1px solid #3b2b4e; border-radius:16px; padding:14px; box-shadow:0 6px 18px #0006 }
  .field{ display:flex; gap:8px; flex-wrap:wrap }
  .field input{ background:#0f0a14; color:#fff; border:1px solid #3b2b4e; border-radius:10px; padding:8px 10px; min-width:180px }
  table{ width:100%; border-collapse:collapse; margin-top:10px }
  th, td{ border:1px solid #3b2b4e; padding:8px; font-size:14px; vertical-align:top }
  th.sortable{ cursor:pointer; position:relative; padding-right:18px }
  th.sortable:after{ content:'â†•'; position:absolute; right:6px; opacity:.6 }
  th.sortable.asc:after{ content:'â†‘' }
  th.sortable.desc:after{ content:'â†“' }
  .status{ font-weight:700 }
  .status.PASS{ color:#6CFFB0 }
  .status.BORDERLINE{ color:#FFD070 }
  .status.HIGH{ color:#FF8A8A }
  .top-pick{ background:transparent; border:1px dashed #ffffff33; border-radius:14px; padding:12px; margin-bottom:10px }
  .badge{ display:inline-flex; align-items:center; justify-content:center; min-width:20px; height:20px; padding:0 6px;
          background:var(--pink); color:#fff; border-radius:999px; font-weight:700; margin-left:6px }
</style>
{% endblock %}

{% block content %}
<div class="wrap">

  <div class="toolbar">
    <a href="/loans/page" class="btn">â† è¿”å› Loans</a>
    <button id="recalcBtn" class="btn primary">ä¸€é”®é‡ç®—</button>

    <!-- ä¿å­˜ / åˆ†äº« / å¯¼å‡ºPDF -->
    <button id="saveSnapBtn" class="btn">ğŸ’¾ ä¿å­˜å¿«ç…§</button>
    <button id="shareBtn" class="btn primary">ğŸ”— å¤åˆ¶åˆ†äº«é“¾æ¥</button>
    <button id="pdfBtn" class="btn">ğŸ“„ å¯¼å‡º PDF</button>

    <button id="clearBtn" class="btn ghost">æ¸…ç©ºå¯¹æ¯”ç¯®</button>
    <div style="flex:1"></div>
    <div>Compare Basket <span id="cmpBadge" class="badge">0</span></div>
  </div>

  <!-- Top Pick -->
  <div id="topPick" class="top-pick" style="display:none">
    <div style="font-weight:700; margin-bottom:6px">æœ¬é¡µæœ€ä½³æ¨è Â· Top Pick ğŸ‘‘</div>
    <div id="topPickBody" class="meta">åŠ è½½ä¸­â€¦</div>
  </div>

  <!-- å‚æ•°åŒº -->
  <div class="card">
    <div style="font-weight:700; margin-bottom:6px">ğŸ§® è¾“å…¥å‚æ•°</div>
    <div class="field">
      <input id="amount" type="number" placeholder="è´·æ¬¾é‡‘é¢ (RM)" value="400000">
      <input id="tenure" type="number" placeholder="å¹´æœŸ (å¹´)" value="30">
      <input id="rate" type="number" step="0.01" placeholder="å¹´åˆ©ç‡ (%) - ç•™ç©º=ä½¿ç”¨äº§å“åˆŠç™»åˆ©ç‡" value="">
      <input id="income" type="number" placeholder="æœˆå‡€æ”¶å…¥ (RM)" value="8000">
      <input id="commitments" type="number" placeholder="ç°æœ‰æœˆä¾›åˆè®¡ (RM)" value="1500">
    </div>
  </div>

  <!-- ç»“æœè¡¨æ ¼ -->
  <div class="card" style="margin-top:10px">
    <div style="font-weight:700; margin-bottom:6px">ğŸ“Š å¯¹æ¯”ç»“æœ</div>
    <table id="compareTable">
      <thead>
        <tr>
          <th class="sortable" data-k="rank">Rank #</th>
          <th class="sortable" data-k="bank">Bank</th>
          <th class="sortable" data-k="product">Product</th>
          <th class="sortable" data-k="apr">APR %</th>
          <th class="sortable" data-k="monthly">Monthly (RM)</th>
          <th class="sortable" data-k="dsr_percent">DSR %</th>
          <th class="sortable" data-k="status">Status</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody><!-- JS æ¸²æŸ“ --></tbody>
    </table>
  </div>

</div>

<script>
  let BASKET=[], SORT={k:'statusRank', dir:'asc'};
  let LAST_SHARE=null;

  async function refreshBadge(){
    try{
      const r = await fetch('/loans/compare/json'); const j = await r.json();
      const n = (j&&j.items)? j.items.length : 0; document.getElementById('cmpBadge').textContent = n;
    }catch(e){}
  }

  async function loadBasket(){
    const r = await fetch('/loans/compare/list'); BASKET = await r.json();
  }

  function pm(a, y, r){ const i=r/12/100, n=y*12; if(i===0) return a/n; return a*i*Math.pow(1+i,n)/(Math.pow(1+i,n)-1); }

  function compute(items){
    const amount = parseFloat(document.getElementById('amount').value||0);
    const tenure = parseFloat(document.getElementById('tenure').value||0);
    const overrideRate = parseFloat(document.getElementById('rate').value||0);
    const income = parseFloat(document.getElementById('income').value||0);
    const commitments = parseFloat(document.getElementById('commitments').value||0);
    return items.map((x)=> {
      const apr = overrideRate>0 ? overrideRate : parseFloat(x.apr||0);
      const monthly = Math.round(pm(amount, tenure, apr)*100)/100;
      const dsr_percent = Math.round(((commitments+monthly)/Math.max(income,1))*10000)/100;
      let status = 'BORDERLINE';
      if(dsr_percent<=55) status='PASS'; else if(dsr_percent>=70) status='HIGH';
      const statusRank = {PASS:0,BORDERLINE:1,HIGH:2}[status];
      return {...x, apr, monthly, dsr_percent, status, statusRank};
    });
  }

  function renderTopPick(rows){
    if(!rows.length){ document.getElementById('topPick').style.display='none'; return; }
    const best = rows[0];
    document.getElementById('topPickBody').innerHTML = `
      <div style="font-size:15px; margin-bottom:4px">${best.bank} Â· ${best.product}</div>
      <div class="meta">APR ${best.apr}% Â· æœˆä¾› RM ${best.monthly} Â· DSR ${best.dsr_percent}% Â· <span class="status ${best.status}">${best.status}</span></div>
    `;
    document.getElementById('topPick').style.display='block';
  }

  function renderTable(rows){
    const tb = document.querySelector('#compareTable tbody'); tb.innerHTML='';
    rows.forEach((r, idx)=>{
      const crown = (idx===0)? ' ğŸ‘‘' : '';
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${idx+1}${crown}</td>
        <td>${r.bank||''}</td>
        <td>${r.product||''}</td>
        <td>${r.apr}%</td>
        <td>RM ${r.monthly}</td>
        <td>${r.dsr_percent}%</td>
        <td class="status ${r.status}">${r.status}</td>
        <td><button class="btn ghost btn-remove" data-product="${r.product}">ç§»é™¤</button></td>
      `;
      tb.appendChild(tr);
    });
    document.querySelectorAll('.btn-remove').forEach(b=>{
      b.addEventListener('click', async ()=>{
        await fetch('/loans/compare/remove',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({product:b.dataset.product})});
        await init();
      });
    });
  }

  function sortRows(rows){
    const {k,dir} = SORT; const mul = dir==='asc'?1:-1;
    return rows.slice().sort((a,b)=>{
      if(k==='statusRank'){ return (a.statusRank-b.statusRank)*mul || (a.monthly-b.monthly)*mul || (a.dsr_percent-b.dsr_percent)*mul; }
      if(typeof a[k]==='number') return (a[k]-b[k])*mul;
      return String(a[k]||'').localeCompare(String(b[k]||''))*mul;
    });
  }

  document.querySelectorAll('th.sortable').forEach(th=>{
    th.addEventListener('click', ()=>{
      const k = th.dataset.k;
      if(SORT.k===k){ SORT.dir = (SORT.dir==='asc'?'desc':'asc'); }
      else { SORT.k=k; SORT.dir='asc'; }
      document.querySelectorAll('th.sortable').forEach(x=>x.classList.remove('asc','desc'));
      th.classList.add(SORT.dir);
      const rows = sortRows(compute(BASKET));
      renderTopPick(rows); renderTable(rows);
    });
  });

  // ä¸€é”®é‡ç®—
  document.getElementById('recalcBtn').addEventListener('click', ()=>{
    const rows = sortRows(compute(BASKET));
    renderTopPick(rows); renderTable(rows);
  });

  // æ¸…ç©º
  document.getElementById('clearBtn').addEventListener('click', async ()=>{
    if(!confirm('ç¡®å®šæ¸…ç©ºå¯¹æ¯”ç¯®ï¼Ÿ')) return;
    await fetch('/loans/compare/clear',{method:'POST'}); await init();
  });

  // ======= ä¿å­˜ / åˆ†äº« / PDF =======
  function buildSnapshot(){
    const params = {
      amount: parseFloat(document.getElementById('amount').value||0),
      tenure_years: parseFloat(document.getElementById('tenure').value||0),
      rate: parseFloat(document.getElementById('rate').value||0),
      income: parseFloat(document.getElementById('income').value||0),
      commitments: parseFloat(document.getElementById('commitments').value||0)
    };
    const rows = [...document.querySelectorAll('#compareTable tbody tr')];
    const items = rows.map(tr=>{
      const tds = tr.querySelectorAll('td');
      return {
        bank: tds[1]?.textContent.trim(),
        product: tds[2]?.textContent.trim(),
        apr: parseFloat((tds[3]?.textContent||'').replace('%','')||0),
        monthly: parseFloat((tds[4]?.textContent||'').replace(/[^\d.]/g,'')||0),
        dsr_percent: parseFloat((tds[5]?.textContent||'').replace('%','')||0),
        status: tds[6]?.textContent.trim()
      }
    });
    return {params, items};
  }

  async function saveSnapshot(){
    const payload = buildSnapshot();
    const r = await fetch('/loans/compare/snapshot',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(!r.ok){ alert('ä¿å­˜å¤±è´¥'); return null; }
    return await r.json(); // {code,url}
  }

  let LAST_SHARE=null;

  document.getElementById('saveSnapBtn').addEventListener('click', async ()=>{
    LAST_SHARE = await saveSnapshot(); if(!LAST_SHARE) return;
    alert('å·²ä¿å­˜å¿«ç…§ï¼š' + (location.origin + LAST_SHARE.url));
  });

  document.getElementById('shareBtn').addEventListener('click', async ()=>{
    const res = LAST_SHARE || await saveSnapshot(); if(!res) return;
    const link = location.origin + res.url;
    try{ await navigator.clipboard.writeText(link); alert('å·²å¤åˆ¶åˆ†äº«é“¾æ¥'); }
    catch(e){ prompt('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š', link); }
  });

  document.getElementById('pdfBtn').addEventListener('click', async ()=>{
    const res = LAST_SHARE || await saveSnapshot(); if(!res) return;
    window.location = '/loans/compare/pdf/' + res.code;
  });

  async function init(){
    await loadBasket(); await refreshBadge();
    const rows = sortRows(compute(BASKET));
    renderTopPick(rows); renderTable(rows);
  }
  init();
</script>

{% endblock %}


â¸»

ğŸ” è¦†ç›–å 30 ç§’è‡ªæ£€æ¸…å•

# Compare é¡µå¯æ‰“å¼€
curl -I https://ä½ çš„åŸŸå/loans/compare/page | grep "200"

# Loans é¡µå¯æ‰“å¼€
curl -I https://ä½ çš„åŸŸå/loans/page | grep "200"

# Top3 JSONï¼ˆè‹¥é…ç½®äº† /loans/top3ï¼‰
curl -s https://ä½ çš„åŸŸå/loans/top3 | jq 'length'

# Compare å¿«ç…§ä¿å­˜ï¼ˆè¿”å› {code,url}ï¼‰
curl -s -X POST https://ä½ çš„åŸŸå/loans/compare/snapshot \
  -H 'Content-Type: application/json' \
  -d '{"params":{"amount":400000,"tenure_years":30,"rate":3.75,"income":8000,"commitments":1500},"items":[]}'

ä¸¤ä»½å°±æ˜¯â€œæ•´åˆå¥½çš„ä¸€æ¬¡æ€§å®Œæ•´ç‰ˆâ€ã€‚ä½ æŠŠå®ƒä»¬ä¸¢è¿› Replit è¦†ç›–ï¼Œåˆ·æ–°é¡µé¢å°±èƒ½çœ‹åˆ°ï¼š
	â€¢	Loans é¡µé¡¶éƒ¨æ˜¯ Top-3 æ¨èå¡ç‰‡ï¼ˆå¯ç›´æ¥â€œåŠ å…¥æ¯”ä»·â€ï¼‰ï¼›
	â€¢	åˆ—è¡¨é‡Œä»»ä½•äº§å“ä¹Ÿèƒ½éšç‚¹éšåŠ ï¼›å³ä¾§å³çœ‹åå¥½ä¸å£ç¢‘æƒ…æŠ¥ï¼›
	â€¢	Compare é¡µèƒ½ ä¸€é”®é‡ç®— / ä¿å­˜å¿«ç…§ / å¤åˆ¶åˆ†äº« / å¯¼å‡º PDFï¼Œå¹¶å¸¦ Top PickğŸ‘‘ ä¸æ™ºèƒ½æ’åºã€‚

è¿˜è¦æŠŠ Top-3 ç®—æ³•æˆ– PDF æ¨¡æ¿å†è°ƒå‘³ï¼Œæˆ‘ä¹Ÿèƒ½ä¸€å¹¶æ‰“åŒ…ã€‚