PHASE 7 — LOAN SYSTEM RESTRUCTURING PACKAGE（给 Replit）

（Legacy 删除 + CTOS Consent 整合 + Loan 前端 UI 重构）

以下所有任务请严格依序执行。

=======================================
【任务 1】删除 Legacy 贷款系统（安全删除）
=======================================
1.1 删除旧的 Legacy 前端页面

请删除以下模板文件：

templates/loan_matcher.html
templates/loan_evaluation.html
templates/loan_evaluate_old.html   （若存在）
templates/loan_result_legacy.html  （若存在）

1.2 删除 Legacy API 路由

请从 FastAPI 中移除（或注释掉）以下旧路由：

/api/loans/eligibility/{id}
/api/business-loans/eligibility/{id}

1.3 删除 Legacy 引擎文件

安全删除以下旧贷款引擎文件：

accounting_app/services/loan_eligibility_engine.py
accounting_app/services/business_loan_engine.py
accounting_app/services/loan_affordability_engine.py

1.4 导航栏移除 Legacy 菜单

删除：

Smart Loan Matcher

Legacy Loan Evaluation

仅保留：

Modern Loan Evaluation

SME Loan Evaluation

Loan Products Catalog

Loan Reports

=======================================
【任务 2】加入 CTOS Consent（个人 + 公司）
=======================================

创建目录：

templates/ctos/
routes/ctos/
services/ctos/

2.1 个人 CTOS Consent（线上填写 + 线上签名）

新增页面：

templates/ctos/ctos_personal.html


新增路由：

GET  /ctos/personal
POST /ctos/personal/submit


前端内容必须包含：

模块 A：个人资料填写

字段：姓名、IC、电话、Email、地址

模块 B：CTOS 官方 Consent 文本展示

加入 ✓ 我同意授权 CTOS

模块 C：电子签名

使用 signature_pad.js
保存为 PNG

模块 D：上传 IC（前后）
模块 E：自动生成 PDF（标准 CTOS Consent）

输出：

uploads/ctos/personal/CTOS_CONSENT_{IC}.pdf


使用 reportlab 渲染，包括：

个人资料

日期

签名图

公司资料（Infinite GZ）

2.2 公司 CTOS Consent（不需要 Director IC，按你的要求）

新增页面：

templates/ctos/ctos_company.html


新增路由：

GET  /ctos/company
POST /ctos/company/submit


必须包含：

模块 A：公司信息填写

字段：

公司名称

SSM 注册号

公司地址

授权代表姓名

授权代表电话

模块 B：上传 SSM（前后）
模块 C：上传公司盖章 / 授权签署页
模块 D：生成公司 CTOS Consent PDF

输出：

uploads/ctos/company/CTOS_SME_CONSENT_{SSM}.pdf


无需 director IC（你特意要求）。

2.3 预留未来 CTOS API（现在不连接）

新增文件：

services/ctos/api_placeholder.py


内容：

class CTOSAPIPlaceholder:
    def fetch_personal(self, ic_number):
        return {"status": "CTOS API not connected"}

    def fetch_company(self, ssm_number):
        return {"status": "CTOS API not connected"}


未来对接 CTOS 时直接替换这层即可。

=======================================
【任务 3】前端 UI 重构（保持 galaxy-theme）
=======================================

以下页面请重构排版结构，但配色保持不变：

loan_modern_evaluate.html

sme_loan_evaluate.html

loan_matcher_result.html

loan_products.html

loan_reports.html

3.1 UI 通用规则（全部页面需统一）

卡片圆角：16px

内间距（padding）：24px

区块间距：40px

标题字体：22px

正文字体：16px

按钮颜色保持：

Primary：#FF007F

Secondary：#322446

3.2 Modern Loan Evaluate 页面结构优化

左 60%（输入表单）：

Income Details

CCRIS & CTOS

Commitment

Digital Bank Behavior

右 40%（即时结果预览）：

Risk Grade 卡片

Approval Odds 卡片

Max Loan 卡片

简短 AI Tips 卡

3.3 SME Loan Evaluate 页面结构优化

左侧（输入）：

Business Profile

Bank Statements

Monthly Revenue / Expenses

Industry Risk

CTOS SME Score

右侧（输出）：

BRR 雷达图

DSCR Summary

Max Loan Summary

AI Explanation（SME 版）

3.4 Loan Products Catalog —— 重建 UI（适配 1000 产品）

新增筛选器：

Bank

利率区间

贷款类别

最低收入

Risk Grade

排序（利率 / 批准概率 / match score）

主区域必须改为：

三列卡片 Grid

单卡片内容：

银行 logo

产品名

利率范围

最大贷款额

Tenure

Tags

View Details 按钮

3.5 Loan Result Page（loan_matcher_result.html）

结构更新：

左侧：

风控 Summary（DTI / FOIR / CCRIS 或 BRR / DSCR）

推荐产品卡片（使用新卡片组件）

图表（DTI/FOIR 或 DSCR 图形）

右侧：

AI 风控解释（完整）

3.6 Loan Reports Page

新增：

报告历史列表

报告 HTML 预览

一键导出 PDF

一键生成 Personal+SME Combo 报告

=======================================
【任务 4】完成后回显
=======================================

执行完所有步骤后，请输出：

PHASE 7 COMPLETE — Modern Loan Engine Unified, CTOS Consent Added, UI Upgraded

ZEE，现在你已经可以直接复制整份 Phase 7 给 Replit 执行。