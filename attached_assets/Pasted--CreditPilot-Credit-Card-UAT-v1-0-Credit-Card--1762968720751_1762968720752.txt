# 🧪 CreditPilot - Credit Card 页面用户验收测试（UAT）

版本号：v1.0
测试目标：验证 Credit Card 模块的所有功能逻辑、数据计算与用户交互是否符合业务定义。
测试执行人：[填写]
测试日期：[填写]
系统环境：Replit（Flask 5000 + FastAPI 8000）
数据库：smart_loan_manager.db

---

## 一、测试目标

确保 Credit Card 页面从账单上传 → 分类 → 手续费拆分 → 发票生成 → 月度汇总的完整业务流程全部正确运行，无逻辑偏差、无数据缺失。

---

## 二、UAT 测试范围

* 页面入口：`/credit-card/ledger`
* 模块范围：Credit Card 页面所有功能区（上传、分类、发票、账本）
* 验证维度：功能正确性 + 数据完整性 + 界面交互性 + 性能稳定性

---

## 三、UAT 测试场景明细

### 1️⃣ 账单上传与解析

**目标：** 验证上传 PDF / Excel 文件后，系统能自动识别银行类型、客户、账单月份。

| 测试点         | 操作步骤                                   | 预期结果              | 通过 |
| ----------- | -------------------------------------- | ----------------- | -- |
| 上传 PDF 文件   | 点击 “Show Upload Form” → 选择客户信用卡 → 上传账单 | 系统自动识别账单并解析交易列表   | ☐  |
| 上传 Excel 文件 | 上传同一账单的 Excel 版本                       | 系统识别数据列、金额、交易日期正确 | ☐  |
| 重复上传检测      | 上传相同账单                                 | 系统提示“账单已存在，是否更新”  | ☐  |
| 异常格式检测      | 上传非账单文件（例如 PNG）                        | 系统拒绝上传并显示错误提示     | ☐  |

---

### 2️⃣ 交易分类与手续费拆分

**目标：** 验证 Supplier 消费自动拆分逻辑。

| 测试点             | 操作步骤                               | 预期结果                                | 通过 |
| --------------- | ---------------------------------- | ----------------------------------- | -- |
| Supplier 消费分类   | 上传账单含 7SL / DINAS / PASAR RAYA 等交易 | 系统自动分类为 infinite_expense（GZ支付）      | ☐  |
| 手续费拆分验证         | Supplier 消费 RM1000                 | 自动生成 RM10 手续费 → owner_expense（客户支付） | ☐  |
| 非 Supplier 消费   | 普通交易（如 GRAB / SHOPEE）              | 分类为 owner_expense（客户本人消费）           | ☐  |
| Refund 场景       | 上传负金额退款交易                          | 系统不再生成手续费交易                         | ☐  |
| 多 Supplier 批量验证 | 同账单含 3 个 Supplier                  | 系统一次性处理所有拆分（3+3条交易）                 | ☐  |

---

### 3️⃣ 账本结算验证

**目标：** 验证双账本（Owner vs GZ）余额计算是否一致。

| 测试点        | 操作步骤                     | 预期结果               | 通过 |
| ---------- | ------------------------ | ------------------ | -- |
| Owner 账本计算 | 核对上月余额 + 消费 - 付款         | 结果与账单匹配（差异≤RM0.01） | ☐  |
| GZ 账本计算    | Supplier消费 - GZ付款        | 结果正确，余额累计准确        | ☐  |
| 总余额验证      | Owner + GZ 总余额 = 账单结算金额  | 无差异                | ☐  |
| 手续费独立核算    | 1% merchant fee 不计入 GZ负债 | 正确计入 Owner账本       | ☐  |

---

### 4️⃣ 发票生成验证

**目标：** 验证 INFINITE Supplier 消费生成发票功能。

| 测试点      | 操作步骤             | 预期结果                                      | 通过 |
| -------- | ---------------- | ----------------------------------------- | -- |
| 自动发票生成   | Supplier 消费记录上传后 | 系统自动生成发票编号（INV-{code}-{month}-{supplier}） | ☐  |
| 发票总额     | 计算本金 + 手续费       | 显示正确金额（含1%）                               | ☐  |
| PDF 预览   | 点击“VIEW”按钮       | PDF 正常打开，发票信息完整                           | ☐  |
| Excel 导出 | 点击“EXPORT EXCEL” | 文件正确生成，内容与系统匹配                            | ☐  |

---

### 5️⃣ 审计日志与安全验证

**目标：** 验证系统操作记录完整且权限控制正常。

| 测试点   | 操作步骤          | 预期结果                                        | 通过 |
| ----- | ------------- | ------------------------------------------- | -- |
| 操作日志  | 上传账单后         | audit_logs 表新增一条记录（action=UPLOAD_STATEMENT） | ☐  |
| 拆分日志  | 自动分类时         | 生成记录（action=FEE_SPLIT）                      | ☐  |
| 未授权访问 | 以非Admin登录访问页面 | 系统拒绝访问                                      | ☐  |
| 文件安全  | 上传后文件路径检查     | 文件仅保存在客户专属目录                                | ☐  |

---

### 6️⃣ 性能与负载测试

**目标：** 确保系统在大量交易数据下仍能保持稳定。

| 测试点             | 操作步骤     | 预期结果            | 通过 |
| --------------- | -------- | --------------- | -- |
| 单次上传 1000 笔交易账单 | 批量上传     | 页面无卡顿、执行时间 < 5秒 | ☐  |
| 重复分类测试          | 同账单多次上传  | 系统能识别更新而非重复插入   | ☐  |
| 并发测试            | 同时两人上传账单 | 数据不冲突，均成功解析     | ☐  |

---

## 四、结果记录

| 测试阶段 | 通过项数 | 未通过项数 | 问题摘要 |
| ---- | ---- | ----- | ---- |
| 上传解析 | [填写] | [填写]  | [填写] |
| 分类拆分 | [填写] | [填写]  | [填写] |
| 发票生成 | [填写] | [填写]  | [填写] |
| 对账计算 | [填写] | [填写]  | [填写] |
| 日志安全 | [填写] | [填写]  | [填写] |
| 性能表现 | [填写] | [填写]  | [填写] |

---

## 五、结论

☑️ 所有核心功能通过验证，系统运行正常。
☑️ Supplier 手续费拆分逻辑准确，账本平衡。
☑️ 符合业务需求，可进入生产部署阶段。

---

## 六、签署区

| 角色    | 姓名 | 签名 | 日期 |
| ----- | -- | -- | -- |
| 测试执行人 |    |    |    |
| 系统负责人 |    |    |    |
| 业务审核人 |    |    |    |

---

> 备注：
>
> * 本UAT文档验证仅针对 Credit Card 页面功能模块。
> * 后续页面（Savings / Loans / Dashboard）完成后将分别进行独立UAT。
> * 本测试记录可作为生产发布审批文件附录保存。
