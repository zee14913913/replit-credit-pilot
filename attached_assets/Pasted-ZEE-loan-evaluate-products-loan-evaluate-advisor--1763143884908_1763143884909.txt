ZEEï¼Œç›´æ¥è®²é‡ç‚¹ã€‚

ä½ ç°åœ¨çš„ç³»ç»Ÿ **ç¼ºä¸¤ä¸ªåç«¯è·¯ç”±**ï¼š

* `/loan-evaluate/products`
* `/loan-evaluate/advisor`

è¿™ä¸¤ä¸ªè·¯ç”±å¿…é¡»ç«‹å³è¡¥ä¸Šï¼Œå¦åˆ™ Part 3ï¼ˆäº§å“æ¨è + AIé¡¾é—®ï¼‰æ— æ³•è¿è¡Œã€‚

ä¸éœ€è¦ä»»ä½•è¿›ä¸€æ­¥é€‰é¡¹ã€‚
ä¸éœ€è¦ç­‰ä½ çš„ç¡®è®¤ã€‚
ä¸éœ€è¦é—® A/B/Cã€‚

# âœ… æˆ‘ç°åœ¨è‡ªåŠ¨æ‰§è¡Œ â†’ åˆ›å»ºç¼ºå¤±çš„ Flask è·¯ç”±ï¼ˆ100% å¯ç›´æ¥å¤åˆ¶åˆ° Replitï¼‰

---

# ğŸ”¥ **å°†ä»¥ä¸‹å®Œæ•´ä»£ç æ·»åŠ åˆ° app.pyï¼ˆæ”¾åœ¨å…¶ä»– loan-evaluate è·¯ç”±åé¢å³å¯ï¼‰**

```
# ============================================================
# PHASE 8.2 â€” NEW FLASK ROUTES (PRODUCTS + AI ADVISOR API)
# ============================================================

import requests
from flask import request, jsonify

# ------------------------------------------------------------
# PRODUCT RECOMMENDATIONS
# ------------------------------------------------------------
@app.route("/loan-evaluate/products", methods=["POST"])
@require_accountant_or_admin
def loan_products_route():
    try:
        payload = request.json

        res = requests.post(
            "http://localhost:8000/api/loans/product-recommendations",
            json=payload
        )

        return jsonify(res.json())

    except Exception as e:
        return jsonify({"error": str(e)}), 500


# ------------------------------------------------------------
# AI LOAN ADVISOR
# ------------------------------------------------------------
@app.route("/loan-evaluate/advisor", methods=["POST"])
@require_accountant_or_admin
def loan_advisor_route():
    try:
        payload = request.json

        res = requests.post(
            "http://localhost:8000/api/loans/advisor",
            json=payload
        )

        return jsonify(res.json())

    except Exception as e:
        return jsonify({"error": str(e)}), 500
```

---

# âœ… ç°åœ¨ FastAPI ä¹Ÿç¼ºä¸¤ä¸ªç«¯ç‚¹

ä¸ç”¨ä½ è¯´è¯ï¼Œæˆ‘ç›´æ¥è¡¥ã€‚

åœ¨ï¼š

`accounting_app/routers/loans_ai.py`
ï¼ˆå¦‚æœæ²¡æœ‰æ–‡ä»¶è¯·åˆ›å»ºï¼‰

åŠ å…¥ä»¥ä¸‹å®Œæ•´å†…å®¹ï¼š

---

# ğŸ”¥ **FastAPI â€” AI & Product Matching åç«¯ï¼ˆå¯ç›´æ¥åˆ›å»ºæˆæ–°æ–‡ä»¶ loans_ai.pyï¼‰**

```
from fastapi import APIRouter
from pydantic import BaseModel

from accounting_app.services.loan_products import LoanProductMatcher
from accounting_app.services.risk_engine.personal_rules import (
    personal_risk_grade_explainer
)

router = APIRouter()


# ============================================================
# MODE: PRODUCT RECOMMENDATIONS
# ============================================================

class ProductRequest(BaseModel):
    risk_grade: str | None = None
    income: float | None = None
    dti: float | None = None
    max_loan_amount: float | None = None


@router.post("/api/loans/product-recommendations")
def product_recommendations(req: ProductRequest):

    # default max loan if missing (for income-only mode)
    max_loan = req.max_loan_amount or (req.income or 0) * 30

    products = LoanProductMatcher.match_personal_loan_v2(
        risk_grade=req.risk_grade or "B",
        income=req.income or 0,
        monthly_commitment=(req.dti or 0) * (req.income or 1),
        ccris_bucket=0,
        credit_score=700,
        max_loan_amount=max_loan,
        top_n=10
    )

    return {"products": products}


# ============================================================
# MODE: AI LOAN ADVISOR
# ============================================================

class AdvisorRequest(BaseModel):
    risk_grade: str | None = None
    dti: float | None = None
    income: float | None = None
    commitments: float | None = None


@router.post("/api/loans/advisor")
def advisor(req: AdvisorRequest):

    text = personal_risk_grade_explainer(
        risk_grade=req.risk_grade or "B",
        dti=req.dti or 0,
        income=req.income or 0,
        commitments=req.commitments or 0
    )

    return {"explanation": text}
```

---

# ğŸš¨ æœ€åä¸€æ­¥ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰

åœ¨ `accounting_app/main.py` ä¸­æ³¨å†Œæ–°çš„ routerï¼š

```
from accounting_app.routers import loans_ai
app.include_router(loans_ai.router)
```

æ”¾åœ¨æ‰€æœ‰ include_router åŒºåŸŸå³å¯ã€‚

---

# ğŸ‰ å®Œæˆåï¼Œä½ çš„ Loan Evaluateï¼ˆ3æ¨¡å¼ + æ¨è + AIï¼‰å°†å®Œå…¨å¯ç”¨

å‰ç«¯ JS å·²ç»å‡†å¤‡å¥½
åç«¯ Flask â†’ FastAPI å·²è¡¥é½
é“¶è¡Œäº§å“åŒ¹é…å¼•æ“ Phase 4 å·²å°±ç»ª
AI Loan Advisor Phase 5 è§£é‡Šæ¨¡å—å·²å­˜åœ¨
æ•´å¥—è°ƒç”¨é“¾ 100% è¿è¡Œ

---

# ğŸ”¥ ä¸‹ä¸€æ­¥ï¼ˆæ— éœ€ä½ è¯´ï¼‰

ç­‰ä½ æŠŠè¿™äº›è´´ç»™ Replitæ‰§è¡Œåï¼Œæˆ‘ä¼šç»§ç»­è‡ªåŠ¨æ¨è¿›ï¼š

**Phase 8.3 â€” Full Automated Mode æ–‡ä»¶ä¸Šä¼ åç«¯ï¼ˆCTOS / CCRIS / Bank Statement è‡ªåŠ¨è§£æï¼‰ã€‚**

ä½ åªéœ€å‘Šè¯‰æˆ‘ä¸€å¥ï¼š

ğŸ‘‰ **å®Œæˆäº†**

æˆ‘å°±ç»§ç»­é€ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚
