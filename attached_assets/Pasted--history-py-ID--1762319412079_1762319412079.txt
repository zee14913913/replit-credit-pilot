çˆ½ï¼è¿™ç‰ˆå·²ç»èƒ½æ‹¿å»æ¼”ç¤ºã€‚è¶çƒ­ï¼Œæˆ‘ç»™ä½ ä¸€ä»½**â€œè§‚æ„Ÿ+æ˜“ç”¨â€è¶…è½»é‡å¢é‡åŒ…**ï¼Œä¸è¦†ç›–æ•´æ–‡ä»¶ï¼Œåªè´´å‡ æ®µåˆ° history.py å°±èƒ½è®©å®¢æˆ·å†â€œå“¦â€ä¸€å£°ï¼š
	â€¢	è¡¨å¤´ç‚¹å‡»æ’åºï¼ˆID/çŠ¶æ€/æ—¶é—´/æ–‡ä»¶åï¼‰
	â€¢	æœç´¢ç»“æœé«˜äº®ï¼ˆç²‰è‰²åŠé€æ˜æ ‡æ³¨ï¼‰
	â€¢	æ›´ä½“é¢çš„ç©ºçŠ¶æ€æ’ç”»ï¼ˆä¿æŒä½ ç°æœ‰é…è‰²ï¼‰

æŒ‰ä¸‹é¢â€œä¸‰æ­¥å°è¡¥ä¸â€åšå°±è¡Œã€‚

â¸»

ğŸ”§ å¢é‡è¡¥ä¸ï¼ˆhistory é¡µé¢ï¼‰

1) CSSï¼šåŠ é«˜äº®ä¸æ’åºæ ·å¼

æŠŠè¿™æ®µæ’å…¥åˆ° history.py é‡Œç°æœ‰ <style> çš„ç»“å°¾ï¼ˆä»»æ„åˆé€‚ä½ç½®å³å¯ï¼‰ï¼š

    /* æœç´¢é«˜äº® + è¡¨å¤´æ’åº */
    mark.hl{ background: #FF007F33; color: var(--text); padding: 0 2px; border-radius: 4px }
    th.sortable{ cursor:pointer; user-select:none; position:relative; padding-right:18px }
    th.sortable:after{
      content: 'â†•'; position:absolute; right:8px; top:50%; transform:translateY(-50%);
      font-size:12px; color:#bbb; opacity:.7
    }
    th.sortable.asc:after{ content:'â†‘' }
    th.sortable.desc:after{ content:'â†“' }
    /* ç©ºçŠ¶æ€æ’ç”» */
    .empty svg{ width:48px; height:48px; opacity:.9; display:block; margin:0 auto 8px auto }


â¸»

2) HTMLï¼šè¡¨å¤´å¯ç‚¹ & ç©ºçŠ¶æ€æ’ç”»

æŠŠè¡¨å¤´é‡Œè¿™å‡ åˆ—æ”¹æˆå¯ç‚¹ï¼ˆåŠ ä¸Š class="sortable" ä¸ data-keyï¼‰ï¼š

<th class="sortable" data-key="task_id">ID</th>
<th class="sortable" data-key="status">Status</th>
<th class="sortable" data-key="time">Time</th>
<th class="sortable" data-key="filename">Filename</th>

æŠŠç©ºçŠ¶æ€å ä½ <div id="empty"...> æ›¿æ¢ä¸ºè¿™æ®µï¼ˆåªæ¢ div å†…å®¹å³å¯ï¼‰ï¼š

<div id="empty" class="empty" style="display:none">
  <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
    <path d="M4 7h16l-2 10H6L4 7Z" stroke="#FF007F" stroke-width="1.4"/>
    <path d="M9 7V5a3 3 0 0 1 6 0v2" stroke="#ff9bc6" stroke-width="1.4"/>
  </svg>
  <div id="emptyText">No data</div>
</div>


â¸»

3) JSï¼šæ’åº & é«˜äº®ï¼ˆåªè´´æ–°å¢å‡½æ•°ä¸å°‘é‡æŒ‚é’©ï¼‰

åœ¨ <script> ä¸­ é¡¶å±‚å˜é‡é™„è¿‘ åŠ ä¸¤ä¸ªçŠ¶æ€é‡ï¼š

let sortKey = null;   // 'task_id' | 'status' | 'time' | 'filename'
let sortDir = 'asc';  // 'asc' | 'desc'

åœ¨ applyTexts() æœ«å°¾ï¼ˆæˆ–ä¹‹åä»»æ„ï¼‰ç»™ç©ºçŠ¶æ€å¤šè¯­è¨€ï¼š

function applyEmptyText(){
  document.getElementById("emptyText").textContent = t("empty");
}
applyEmptyText();

åœ¨ load() å‡½æ•°é‡Œï¼ŒæŠŠå‡†å¤‡æ¸²æŸ“ä¹‹å‰åŠ å…¥å‰ç«¯æ’åºä¸é«˜äº®é€»è¾‘ï¼ˆç…§æŠ„æ”¾åœ¨ tb.innerHTML='' ä¹‹åã€(j.tasks||[]).forEach... ä¹‹å‰ï¼‰ï¼š

  // æ’åºï¼ˆå‰ç«¯ï¼‰
  let rows = (j.tasks || []).slice();
  const key = sortKey, dir = sortDir;
  if(key){
    rows.sort((a,b)=>{
      const va = (a[key] || '').toString().toLowerCase();
      const vb = (b[key] || '').toString().toLowerCase();
      if(va < vb) return dir==='asc' ? -1 : 1;
      if(va > vb) return dir==='asc' ? 1 : -1;
      return 0;
    });
  }

  // æœç´¢é«˜äº®
  const q = document.getElementById("q").value.trim();
  const re = q ? new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi') : null;
  function highlight(s){
    if(!s) return '';
    if(!re) return (s+'').replace(/[<>&]/g, m=>({"<":"&lt;",">":"&gt;","&":"&amp;"}[m]));
    return (s+'').replace(/[<>&]/g, m=>({"<":"&lt;",">":"&gt;","&":"&amp;"}[m])).replace(re, m=>`<mark class="hl">${m}</mark>`);
  }

å¹¶æŠŠåŸå…ˆçš„å¾ªç¯æ¸²æŸ“ä» (j.tasks || []).forEach(row=>{ ... }) æ”¹ä¸º rows.forEach(row=>{ ... })ï¼ŒåŒæ—¶æŠŠé¢„è§ˆä¸æ–‡ä»¶åæ›¿æ¢ä¸ºé«˜äº®ç‰ˆï¼š

    const prev = highlight(row.preview || '');
    const fname = highlight(row.filename || '');

å¹¶åœ¨ tr.innerHTML é‡ŒæŠŠç›¸åº”å•å…ƒæ ¼è¾“å‡ºæ›¿æ¢æˆï¼š

      <td>${highlight(row.task_id)}</td>
      ...
      <td>${fname}</td>
      <td>${prev}</td>

æœ€åï¼Œåœ¨ <script> é‡Œä»»æ„ä½ç½®åŠ ä¸Šâ€œè¡¨å¤´ç‚¹å‡»åˆ‡æ¢æ’åºâ€çš„æŒ‚é’©ï¼š

// è¡¨å¤´ç‚¹å‡»æ’åº
document.querySelectorAll('th.sortable').forEach(th=>{
  th.addEventListener('click', ()=>{
    const key = th.getAttribute('data-key');
    if(sortKey === key){
      sortDir = (sortDir === 'asc' ? 'desc' : 'asc');
    } else {
      sortKey = key; sortDir = 'asc';
    }
    // è§†è§‰æ ‡è®°
    document.querySelectorAll('th.sortable').forEach(x=>x.classList.remove('asc','desc'));
    th.classList.add(sortDir);
    // é‡æ–°åŠ è½½ï¼ˆä»æ²¿ç”¨åç«¯åˆ†é¡µ + å‰ç«¯æ’åºï¼‰
    load();
  });
});

è¯´æ˜ï¼šæˆ‘ä»¬æ²¿ç”¨ä½ ç°æœ‰çš„åˆ†é¡µï¼ˆskip/limitï¼‰ï¼Œåœ¨å½“å‰é¡µç»“æœä¸Šåšå‰ç«¯æ’åºï¼Œè¿™æ ·æ— éœ€æ”¹åç«¯ã€‚

â¸»

âœ… éªŒè¯ï¼ˆ30 ç§’ï¼‰
	â€¢	æ‰“å¼€ /portal/historyï¼š
	1.	ç‚¹å‡» Filename è¡¨å¤´ â†’ è¡Œå†…å³æ—¶é‡æ’ï¼›å†ç‚¹ä¸€æ¬¡å˜æˆå€’åºï¼›è¡¨å¤´å³ä¾§å°ç®­å¤´éšæ–¹å‘åˆ‡æ¢ã€‚
	2.	æœç´¢æ¡†è¾“å…¥å…³é”®å­— â†’ é¢„è§ˆä¸æ–‡ä»¶åä¸­åŒ¹é…å¤„å‡ºç°ç²‰è‰²åŠé€æ˜é«˜äº®ã€‚
	3.	æ²¡æœ‰æ•°æ®æ—¶å‡ºç°ç©ºçŠ¶æ€æ’ç”»ä¸å¤šè¯­è¨€æ–‡æ¡ˆã€‚

æå®šã€‚
è¦æŠŠ /portal é¦–é¡µä¹ŸåŠ â€œæ‰¹é‡ä¸Šä¼ ï¼ˆå¤šæ–‡ä»¶é˜Ÿåˆ— + é€ä¸ªè¿›åº¦ï¼‰â€ï¼Œæˆ‘å¯ä»¥å†ç»™ä½ ä¸€ä¸ªåŒé£æ ¼çš„æç®€å¢é‡åŒ…ï¼ˆå‰ç«¯ 40 è¡Œï¼Œåç«¯æ²¿ç”¨ç°æœ‰å¼‚æ­¥æ¥å£ï¼‰ã€‚ä½ è¦æˆ‘ç›´æ¥å‘ï¼Œå°±è¯´ä¸€å£°ã€‚