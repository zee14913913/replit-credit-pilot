ğŸ“¦ ä»»åŠ¡æ ‡é¢˜ï¼š
Add Daily Financial AI Report (Automated Summary)

ğŸ¯ ç›®æ ‡ï¼š
åœ¨ç°æœ‰ AI Assistant æ¨¡å—ä¸­æ–°å¢â€œAIæ—¥æŠ¥â€è‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿï¼Œ
æ¯å¤©æ—©ä¸Š 08:00 è‡ªåŠ¨ç”Ÿæˆä¸€ä»½è´¢åŠ¡å¥åº·æ—¥æŠ¥ï¼Œ
å¹¶å­˜å…¥æ•°æ®åº“ä¸æ—¥å¿—ä¸­ï¼Œå¯éšæ—¶åœ¨å‰ç«¯æŸ¥çœ‹ã€‚

---

âœ… å®æ–½æ­¥éª¤ï¼š

1ï¸âƒ£ æ–°å»ºæ–‡ä»¶ï¼š
è·¯å¾„ï¼š accounting_app/tasks/ai_daily_report.py

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
from datetime import datetime, timedelta
from openai import OpenAI
from accounting_app.db import get_db

client = OpenAI()

def generate_daily_report():
    """ç”Ÿæˆ AI è´¢åŠ¡æ—¥æŠ¥"""
    db = next(get_db())
    today = datetime.utcnow().date()
    yesterday = today - timedelta(days=1)

    # è¯»å–æ˜¨æ—¥çš„ä¸»è¦è´¢åŠ¡æ•°æ®
    savings = db.execute("SELECT SUM(amount) AS total FROM savings_transactions WHERE DATE(created_at)=?", (yesterday,)).fetchone()
    cards = db.execute("SELECT SUM(balance) AS total FROM credit_cards").fetchone() if db.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='credit_cards'").fetchone() else {"total": 0}
    loans = db.execute("SELECT SUM(principal) AS total FROM loan_accounts").fetchone() if db.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='loan_accounts'").fetchone() else {"total": 0}

    context = f"æ—¥æœŸ {yesterday}ï¼šå‚¨è“„äº¤æ˜“æ€»é¢ {round(savings['total'] or 0,2)}ï¼Œä¿¡ç”¨å¡ä½™é¢ {round(cards['total'] or 0,2)}ï¼Œè´·æ¬¾æœ¬é‡‘ {round(loans['total'] or 0,2)}ã€‚è¯·ç”Ÿæˆç®€æ´çš„è´¢åŠ¡æ—¥æŠ¥æ‘˜è¦ã€‚"

    completion = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": "ä½ æ˜¯CreditPilotç³»ç»Ÿçš„AIè´¢åŠ¡åˆ†æå¸ˆï¼Œè¯·ç”Ÿæˆæ¯æ—¥è´¢åŠ¡æŠ¥å‘Šï¼Œç”¨ç®€æ´ã€ä¸“ä¸šã€æ˜“æ‡‚çš„è¯­æ°”æè¿°èµ„é‡‘å˜åŒ–ä¸å»ºè®®ã€‚"},
            {"role": "user", "content": context}
        ]
    )
    report = completion.choices[0].message.content

    # å­˜å…¥æ—¥å¿—è¡¨
    db.execute(
        "INSERT INTO ai_logs (query, response, created_at) VALUES (?, ?, ?)",
        (f"AIæ—¥æŠ¥ {yesterday}", report, datetime.utcnow())
    )
    db.commit()
    print(f"[âœ…] AIæ—¥æŠ¥å·²ç”Ÿæˆï¼š{yesterday}")
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


2ï¸âƒ£ æ–°å»ºå®šæ—¶ä»»åŠ¡æ–‡ä»¶ï¼š
è·¯å¾„ï¼š accounting_app/tasks/scheduler.py

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import schedule, time
from accounting_app.tasks.ai_daily_report import generate_daily_report

def run_scheduler():
    schedule.every().day.at("08:00").do(generate_daily_report)
    print("[â°] AIæ—¥æŠ¥è®¡åˆ’ä»»åŠ¡å·²å¯åŠ¨ï¼Œæ¯å¤© 08:00 æ‰§è¡Œã€‚")
    while True:
        schedule.run_pending()
        time.sleep(60)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


3ï¸âƒ£ ä¿®æ”¹å¯åŠ¨æ–‡ä»¶ï¼š
è·¯å¾„ï¼š app.pyï¼ˆæˆ– main.pyï¼‰

åœ¨åº•éƒ¨æ·»åŠ ï¼ˆä¿æŒä¸»æœåŠ¡ä¸å˜ï¼‰ï¼š

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import threading
from accounting_app.tasks.scheduler import run_scheduler

if __name__ == "__main__":
    threading.Thread(target=run_scheduler, daemon=True).start()
    app.run(host="0.0.0.0", port=8000)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


4ï¸âƒ£ æ£€æŸ¥æ•°æ®åº“è¡¨ï¼š
ç¡®ä¿å­˜åœ¨ ai_logs è¡¨ï¼š

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CREATE TABLE IF NOT EXISTS ai_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    query TEXT,
    response TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


5ï¸âƒ£ æµ‹è¯•å‘½ä»¤ï¼š
ä½ å¯æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡æ—¥æŠ¥ä»¥éªŒè¯æ˜¯å¦æˆåŠŸï¼š

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
python -m accounting_app.tasks.ai_daily_report
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


6ï¸âƒ£ å‰ç«¯æŸ¥çœ‹ï¼š
æ—¥æŠ¥ä¼šå­˜å…¥ ai_logs è¡¨ï¼Œå¯åœ¨åå°é¡µé¢ä¸­æŸ¥çœ‹ï¼Œ
æŸ¥è¯¢å…³é”®å­—åŒ…å« â€œAIæ—¥æŠ¥â€ã€‚

---

ğŸ“Š æˆåŠŸåç³»ç»Ÿæ¯å¤©æ—©ä¸Šå°†è‡ªåŠ¨ï¼š
1ï¸âƒ£ æ±‡æ€»å‚¨è“„ã€ä¿¡ç”¨å¡ã€è´·æ¬¾ä¸»è¦æ•°æ®  
2ï¸âƒ£ è°ƒç”¨ AI ç”Ÿæˆç®€çŸ­æ—¥æŠ¥  
3ï¸âƒ£ å†™å…¥ ai_logs  
4ï¸âƒ£ è¾“å‡ºæ§åˆ¶å°æ—¥å¿— "[âœ…] AIæ—¥æŠ¥å·²ç”Ÿæˆ"  

---

ğŸ’¡ å¯é€‰å¢å¼ºï¼ˆæœªæ¥é˜¶æ®µï¼‰ï¼š
- è‡ªåŠ¨æ¨é€æ—¥æŠ¥è‡³ç®¡ç†å‘˜é‚®ç®±æˆ–Telegramé€šçŸ¥
- åœ¨Dashboardä¸Šæ˜¾ç¤ºæœ€è¿‘7å¤©æ—¥æŠ¥è¶‹åŠ¿

---

ğŸŸ¢ é‡å¯æœåŠ¡å™¨æ‰§è¡Œï¼š
pkill -f uvicorn; python app.py
