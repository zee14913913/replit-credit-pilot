# CreditPilot - 详细页面规格书（Pre-FastAPI 最终版）

**版本**: 最终版（改版前）- 6模块架构  
**生成日期**: 2025-11-07  
**核心创新**: Credit Cards统一管理中心（整合Receipts + Invoices）

---

## 📋 导航结构（最终版）

### 6大核心模块

```
1. DASHBOARD        - 客户管理与总览
2. CREDIT CARDS ⭐  - 统一信用卡管理中心（4 Tab设计）
3. SAVINGS          - 储蓄账户管理
4. LOANS            - 智能贷款匹配器
5. REPORTS          - 月度汇总报告
6. ADMIN            - 系统管理
```

### 关键创新价值

```
指标              传统版（7模块）    最终版（6模块）    改善
─────────────────────────────────────────────────────
总耗时            ~30分钟           ~10分钟          节省67% ⭐
页面切换          5次              0次              零切换 ⭐
操作步骤          15+步            5步              减少66% ⭐
学习曲线          需学习3个模块     只需1个模块       降低66% ⭐
```

---

# 模块1: DASHBOARD（仪表盘）

**页面作用**: 客户财务健康总览与快速操作中心

---

## 展示卡片 1.1: 客户选择器

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ 👤 客户选择器                            │
├─────────────────────────────────────────┤
│ [Select Customer ▼]                     │
│                                         │
│ ○ CHEOK JUN YOON                        │
│ ○ YEO CHEE WANG                         │
│ ○ TEO YOK CHU & YEO CHEE WANG           │
│                                         │
│ [+ Add New Customer]                    │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 支持多客户管理（家庭成员/企业主多实体）
- 快速切换查看不同客户数据
- 避免混淆不同客户的财务信息

### 【计算方法】
```
客户列表 = SELECT * FROM customers WHERE is_active = 1
ORDER BY last_viewed DESC

默认选中 = 上次查看的客户（session记录）
```

### 【如何善用】
1. **家庭管理**: 父母管理子女账户
2. **企业主**: 管理个人+公司多个实体
3. **会计师**: 服务多个客户

### 【客户利益】
- ✅ 一个账号管理全家财务
- ✅ 快速切换无需登出/登入
- ✅ 数据隔离保证安全

### 【设计理念】
- 下拉菜单节省空间
- 最近查看的客户优先显示
- 添加新客户按钮便捷访问

### 【数据流向】
```
数据库 customers 表
  ↓
客户列表（按上次访问排序）
  ↓
Session存储当前选中客户
  ↓
所有页面数据基于此客户ID
```

---

## 展示卡片 1.2: 财务健康评分

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ 💯 财务健康评分                          │
├─────────────────────────────────────────┤
│              85分                        │
│     ████████████████░░░░                │
│           健康状态：优秀                 │
│                                         │
│ 评分构成：                               │
│ • 信用利用率：18/20 (35%)               │
│ • 还款记录：  30/30 (12个月按时)        │
│ • DSR比率：   18/20 (42%)               │
│ • 储蓄覆盖率：19/30 (3.2个月)           │
│                                         │
│ 💡 改善建议：                            │
│ 增加储蓄至6个月支出可提升至95分          │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 一眼看懂财务状况（不需要金融专业知识）
- 明确改善方向（不是盲目理财）
- 提高贷款批准率（评分高=财务健康）

### 【计算方法】⭐

**总分 = 信用利用率(20%) + 还款记录(30%) + DSR(20%) + 储蓄覆盖率(30%)**

**详细计算**:

```python
# 1. 信用利用率评分 (20分)
已用额度 = SUM(所有信用卡当前余额)
总额度 = SUM(所有信用卡额度)
利用率 = 已用额度 / 总额度 × 100%

评分规则:
- <10%:  20分 (优秀)
- 10-30%: 18分 (良好)
- 30-50%: 15分 (尚可)
- 50-70%: 10分 (偏高)
- >70%:   5分  (危险)

示例:
已用 RM 5,500 / 总额度 RM 15,000 = 36.7%
→ 15分

# 2. 还款记录评分 (30分)
基础分 = 30分
逾期罚分 = 每逾期1次 -5分

示例:
12个月全部按时还款 → 30分
10个月按时，2个月逾期 → 30 - (2×5) = 20分

# 3. DSR评分 (20分)
月供总计 = SUM(所有贷款月供 + 信用卡最低还款)
月收入 = 客户设定的月收入
DSR = 月供总计 / 月收入 × 100%

评分规则:
- <30%:  20分 (优秀，批贷无压力)
- 30-40%: 17分 (良好)
- 40-55%: 14分 (尚可，银行批准线)
- 55-70%: 8分  (偏高，部分银行拒绝)
- >70%:   5分  (高风险，很难批贷)

示例:
月供 RM 3,500 / 月收入 RM 8,500 = 41.2%
→ 14分

# 4. 储蓄覆盖率评分 (30分)
储蓄总额 = SUM(所有储蓄账户余额)
月支出平均 = AVG(最近3个月信用卡消费)
覆盖率 = 储蓄总额 / 月支出平均

评分规则:
- ≥6个月: 30分 (安全)
- 4-6个月: 25分 (良好)
- 2-4个月: 19分 (尚可)
- 1-2个月: 12分 (偏低)
- <1个月:  5分  (危险)

示例:
储蓄 RM 19,500 / 月支出 RM 6,100 = 3.2个月
→ 19分

# 总分
15 + 30 + 14 + 19 = 78分 → 良好
```

**评级标准**:
- 90-100分: 优秀（贷款批准率95%+）
- 80-89分:  良好（贷款批准率85%+）
- 70-79分:  尚可（贷款批准率70%+）
- 60-69分:  需改善（贷款批准率50%）
- <60分:    高风险（贷款批准率<30%）

### 【如何善用】
1. **每月追踪**: 观察评分趋势，及早发现问题
2. **申贷前检查**: 评分<80分先改善再申贷
3. **对标改善**: 查看各项细分，针对性提升

### 【客户利益】
- ✅ 一眼看懂财务健康状况
- ✅ 明确知道改善方向
- ✅ 提高银行贷款批准率（评分高=财务健康）
- ✅ 及早发现财务风险（评分下降=警告信号）

### 【数据流向】
```
信用卡数据 → 计算利用率
还款历史 → 统计逾期次数
贷款数据 → 计算DSR
储蓄账户 → 计算覆盖率
  ↓
加权评分算法
  ↓
总分 + 评级 + 改善建议
```

---

## 展示卡片 1.3: 资产负债概览

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ 💰 资产负债概览                          │
├─────────────────────────────────────────┤
│ 总资产       RM 45,300.00               │
│ 总负债       RM 28,700.00               │
│ ──────────────────────────              │
│ 净资产       RM 16,600.00 ✅            │
│                                         │
│ 资产负债率: 63.4% (健康范围)            │
│                                         │
│ [查看详细明细]                           │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 了解整体财务状况（富裕/负债）
- 监控资产负债比率（银行关注指标）
- 追踪净资产变化趋势

### 【计算方法】⭐

```python
# 总资产
储蓄账户余额 = SUM(savings_accounts.current_balance)
投资账户余额 = SUM(investment_accounts.balance) # 如有
房产估值 = SUM(properties.estimated_value)     # 如有

总资产 = 储蓄账户 + 投资账户 + 房产估值

示例:
储蓄 RM 19,500 + 投资 RM 25,800 + 房产 RM 0 = RM 45,300

# 总负债
信用卡余额 = SUM(credit_cards.current_balance)
房贷余额 = SUM(loans.outstanding_balance WHERE loan_type='房贷')
车贷余额 = SUM(loans.outstanding_balance WHERE loan_type='车贷')
个人贷款 = SUM(loans.outstanding_balance WHERE loan_type='个贷')

总负债 = 信用卡 + 房贷 + 车贷 + 个贷

示例:
信用卡 RM 5,500 + 房贷 RM 0 + 车贷 RM 23,200 = RM 28,700

# 净资产
净资产 = 总资产 - 总负债 = RM 45,300 - RM 28,700 = RM 16,600

# 资产负债率
资产负债率 = 总负债 / 总资产 × 100%
            = RM 28,700 / RM 45,300 × 100% = 63.4%

健康标准:
- <50%: 优秀
- 50-70%: 健康
- 70-85%: 偏高
- >85%: 高风险
```

### 【如何善用】
1. **月度追踪**: 观察净资产是否增长
2. **降低负债**: 优先还清高利率债务
3. **增加资产**: 强制储蓄/投资

### 【客户利益】
- ✅ 清楚了解自己值多少钱
- ✅ 监控财务健康度
- ✅ 制定财务目标（如1年内净资产+RM 10,000）

---

## 展示卡片 1.4: 本月收支情况

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ 📊 本月收支情况                          │
├─────────────────────────────────────────┤
│ 收入  RM 8,500.00                       │
│ 支出  RM 6,100.00                       │
│ ──────────────────────────              │
│ 结余  RM 2,400.00 ✅                    │
│ 储蓄率: 28.2% (良好)                    │
│                                         │
│ 支出分类（Top 5）:                       │
│ 🍽️ 餐饮      RM 1,850  30.3% ████████  │
│ 🛍️ 购物      RM 1,220  20.0% █████░   │
│ 🚗 交通      RM 920    15.1% ████░░   │
│ 📦 杂货      RM 680    11.1% ███░░░   │
│ 🎬 娱乐      RM 450     7.4% ██░░░░   │
│ 📋 其他      RM 980    16.1% ████░░   │
│                                         │
│ [查看完整12类别明细]                     │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 了解钱花到哪里去了
- 识别可优化的支出类别
- 监控储蓄率（财富累积关键）

### 【计算方法】⭐

```python
# 本月收入
工资收入 = 客户设定的月收入
其他收入 = SUM(savings_transactions.amount 
           WHERE transaction_type='CREDIT' 
           AND description LIKE '%SALARY%|%BONUS%')

总收入 = 工资收入 + 其他收入

# 本月支出
总支出 = SUM(credit_card_transactions.amount 
         WHERE transaction_type='DEBIT'
         AND statement_date = 当前月份)

# 结余
结余 = 总收入 - 总支出

# 储蓄率
储蓄率 = 结余 / 总收入 × 100%

储蓄率评级:
- ≥30%: 优秀
- 20-30%: 良好
- 10-20%: 尚可
- <10%: 需改善

# 12大类别分类
分类统计 = SELECT category, SUM(amount), COUNT(*) 
           FROM credit_card_transactions
           WHERE statement_date = 当前月份
           GROUP BY category
           ORDER BY SUM(amount) DESC

12大类别:
1. Food & Dining (餐饮)
2. Transport (交通)
3. Shopping (购物)
4. Groceries (杂货)
5. Bills & Utilities (账单水电)
6. Entertainment (娱乐)
7. Healthcare (医疗)
8. Online Services (在线服务)
9. Travel (旅游)
10. Insurance (保险)
11. Education (教育)
12. Others (其他)
```

### 【如何善用】
1. **识别大额支出**: 找出占比>20%的类别
2. **设置预算**: 为每个类别设置月度预算
3. **优化支出**: 减少非必要类别（如娱乐）

### 【客户利益】
- ✅ 清楚知道钱花在哪里
- ✅ 发现浪费的领域
- ✅ 提高储蓄率
- ✅ 实现财务目标更快

---

## 展示卡片 1.5: 即将到期提醒

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ ⏰ 即将到期提醒                          │
├─────────────────────────────────────────┤
│ 🔴 紧急（3天内）:                        │
│   Maybank ****1234                      │
│   到期日: 2025-11-10 (还有2天)          │
│   应还: RM 2,500.00                     │
│   最低: RM 125.00                       │
│   [立即还款]                             │
│                                         │
│ 🟡 注意（4-7天）:                        │
│   CIMB ****5678                         │
│   到期日: 2025-11-14 (还有6天)          │
│   应还: RM 1,800.00                     │
│   [查看详情]                             │
│                                         │
│ 🟢 提醒（8-14天）:                       │
│   Public Bank ****9012 (还有12天)       │
│   Hong Leong ****3456 (还有13天)        │
│                                         │
│ ✅ 本月已还清: 5张卡片                   │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 避免逾期罚款（通常RM 50-200/次）
- 维持良好信用评分
- 保持低DSR（贷款批准关键）

### 【计算方法】⭐

```python
# 计算到期日
到期日 = statement_date + credit_card.payment_due_days

示例:
账单日: 2025-10-15
付款期限: 25天
到期日 = 2025-10-15 + 25天 = 2025-11-09

# 计算剩余天数
剩余天数 = 到期日 - 今天
今天 = 2025-11-07
剩余天数 = 2025-11-09 - 2025-11-07 = 2天

# 紧急度分级
- 剩余 ≤3天:  🔴 紧急（发送SMS+Email）
- 剩余 4-7天: 🟡 注意（发送Email）
- 剩余 8-14天: 🟢 提醒（仅显示）
- 剩余 >14天: 不显示

# 还款金额
应还金额 = total_amount_due（账单总额）
最低还款 = minimum_payment（通常5%）
```

### 【如何善用】
1. **启用通知**: 设置Email/SMS提醒
2. **优先还款**: 先还紧急的
3. **全额还款**: 避免利息（通常18% APR）

### 【客户利益】
- ✅ 永不逾期（避免罚款+信用受损）
- ✅ 节省利息费用
- ✅ 维持良好信用评分
- ✅ 保持贷款批准能力

---

## 展示卡片 1.6: 12个月趋势图

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ 📈 12个月收支趋势                        │
├─────────────────────────────────────────┤
│                                         │
│  RM                                     │
│  10K ┤                          ●       │
│   9K ┤              ●     ●    ╱        │
│   8K ┤      ●──●──●             ●       │
│   7K ┤  ●──╱                   ╱        │
│   6K ┤ ╱                  ●──●          │
│   5K ┤●                                 │
│      └─────────────────────────────────│
│       J F M A M J J A S O N D          │
│                                         │
│  ─── 收入    ─── 支出                  │
│                                         │
│  YoY: +12.5% ↗️  MoM: +3.2% ↗️        │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 识别季节性支出模式
- 追踪收入/支出趋势
- 发现异常波动

### 【计算方法】⭐

```python
# 查询12个月数据
FOR month IN (今天往前推12个月):
    月收入 = 客户设定的月收入（固定）
    月支出 = SUM(transactions.amount 
             WHERE statement_date = month
             AND transaction_type='DEBIT')
    
    数据点.append({
        'month': month,
        'income': 月收入,
        'expense': 月支出
    })

# YoY (Year-over-Year)
去年同月支出 = 12个月前的支出
本月支出 = 最新月份支出
YoY = (本月支出 - 去年同月支出) / 去年同月支出 × 100%

示例:
2024年11月: RM 5,800
2025年11月: RM 6,100
YoY = (6,100 - 5,800) / 5,800 × 100% = +5.2%

# MoM (Month-over-Month)
上月支出 = 上个月支出
本月支出 = 最新月份支出
MoM = (本月 - 上月) / 上月 × 100%

示例:
2025年10月: RM 5,900
2025年11月: RM 6,100
MoM = (6,100 - 5,900) / 5,900 × 100% = +3.4%
```

### 【如何善用】
1. **识别模式**: 12月通常支出高（节日）
2. **预算调整**: 根据趋势调整预算
3. **异常调查**: 某月突增？检查大额交易

### 【客户利益】
- ✅ 了解支出模式
- ✅ 提前规划预算
- ✅ 发现异常支出

---

## 展示卡片 1.7: 快速操作面板

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ ⚡ 快速操作                              │
├─────────────────────────────────────────┤
│ [📤 上传信用卡账单]                      │
│ [📸 上传收据]                            │
│ [💰 上传储蓄账单]                        │
│ [📊 生成月度报告]                        │
│ [👤 添加新客户]                          │
│ [⚙️ 系统设置]                           │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 快速访问常用功能
- 减少点击次数
- 提升操作效率

### 【客户利益】
- ✅ 节省时间
- ✅ 简化操作
- ✅ 提高效率

---

# 模块2: CREDIT CARDS（统一信用卡管理中心）⭐⭐⭐

**页面作用**: 整合账单+收据+发票于一个页面，实现完整月结流程

**核心价值**: 
- 🎯 效率提升67% (30分钟 → 10分钟)
- 🎯 零页面切换 (4个Tab在同一页)
- 🎯 数据准确性 (双重验证系统)

---

## 页面布局总览

```
┌──────────────────────────────────────────────────────┐
│ CREDIT CARDS - 统一信用卡管理中心                     │
├──────────────────────────────────────────────────────┤
│ 卡片选择: [Maybank ****1234 ▼]  月份: [2025-11 ▼]  │
├──────────────────────────────────────────────────────┤
│ 账单概览:                                             │
│ 本月消费: RM 6,100    应还款: RM 6,100               │
│ 最低还款: RM 305      到期日: 2025-11-25 (18天后)    │
├──────────────────────────────────────────────────────┤
│ Tab导航:                                              │
│ [💳 交易明细] [📸 收据匹配] [🏷️ 供应商发票] [📊 月结报告] │
├──────────────────────────────────────────────────────┤
│                                                      │
│ （Tab内容区域）                                       │
│                                                      │
└──────────────────────────────────────────────────────┘
```

---

## 主页面 - 展示卡片 2.1: 信用卡选择器

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ 选择信用卡: [Maybank ****1234 ▼]        │
│                                         │
│ 可选信用卡:                              │
│ • Maybank ****1234 (8张账单)            │
│ • CIMB ****5678 (6张账单)               │
│ • Public Bank ****9012 (5张账单)        │
│ • Hong Leong ****3456 (4张账单)         │
│ • RHB ****7890 (3张账单)                │
│ • AmBank ****2345 (2张账单)             │
│ • HSBC ****6789 (2张账单)               │
│ • Standard Chartered ****0123 (1张账单) │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 客户通常有3-8张信用卡
- 需要分别管理每张卡的账单

### 【数据流向】
```
SELECT * FROM credit_cards 
WHERE customer_id = 当前客户
ORDER BY last_used DESC
```

---

## 主页面 - 展示卡片 2.2: 月份选择器

### 【展示内容】
```
┌─────────────────────────────────────────┐
│ 选择月份: [2025年11月 ▼]                │
│                                         │
│ 可选月份:                                │
│ • 2025年11月 ✅ (本月)                  │
│ • 2025年10月                            │
│ • 2025年9月                             │
│ • 2025年8月                             │
│ ... (最多12个月)                        │
└─────────────────────────────────────────┘
```

### 【为什么展示这个】
- 查看历史账单
- 对比不同月份支出
- 生成多月报告

---

## 主页面 - 展示卡片 2.3: 账单概览面板

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📊 账单概览 - Maybank ****1234 (2025-11) │
├──────────────────────────────────────────┤
│ 本月消费    RM 6,100.00                  │
│ 应还款额    RM 6,100.00                  │
│ 最低还款    RM 305.00                    │
│ 到期日      2025-11-25 (还有18天) 🟢    │
│                                          │
│ 交易笔数: 45笔                           │
│ 收据覆盖率: 83% (38/45) 🟡              │
│ 数据评分: B级 (87分)                     │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 快速了解本月账单情况
- 提醒还款期限
- 显示数据完整性

### 【计算方法】⭐
```python
# 从PDF解析或数据库提取
本月消费 = total_debit
应还款额 = total_amount_due
最低还款 = minimum_payment (通常5%)
到期日 = statement_date + payment_due_days

# 收据覆盖率
已匹配交易数 = COUNT(transactions WHERE receipt_id IS NOT NULL)
总交易数 = COUNT(transactions)
覆盖率 = 已匹配 / 总数 × 100%

# 数据评分（详见Tab 4）
评分综合考虑：账单验证 + 收据覆盖率 + 发票确认
```

---

## 主页面 - 展示卡片 2.4: 还款提醒面板

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ ⏰ 还款提醒设置                           │
├──────────────────────────────────────────┤
│ 到期日: 2025-11-25                       │
│                                          │
│ 提醒渠道:                                 │
│ ☑ Email (7天前, 3天前, 1天前)           │
│ ☑ SMS (3天前, 1天前)                    │
│ ☐ Push通知                               │
│                                          │
│ Email: cheokjunyoon@example.com          │
│ Phone: +60123456789                      │
│                                          │
│ [保存设置] [测试通知]                     │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 多渠道提醒确保不遗漏
- 用户自定义提醒时间
- 避免逾期罚款

### 【计算方法】⭐
```python
# 计算提醒日期
到期日 = 2025-11-25

提醒时间点:
- 7天前: 2025-11-18
- 3天前: 2025-11-22
- 1天前: 2025-11-24

# 发送逻辑（后台定时任务）
每天凌晨02:00执行:
  FOR 每张信用卡:
    IF 今天 == 到期日-7天:
      发送Email("7天后到期")
    IF 今天 == 到期日-3天:
      发送Email + SMS("3天后到期")
    IF 今天 == 到期日-1天:
      发送Email + SMS("明天到期！紧急")
```

---

## Tab 1: 💳 交易明细

### 展示卡片 2.5: 交易分类统计

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📊 交易分类统计（12大类别）               │
├──────────────────────────────────────────┤
│ 🍽️ 餐饮      RM 1,850  30.3% ████████   │
│ 🛍️ 购物      RM 1,220  20.0% █████░    │
│ 🚗 交通      RM 920    15.1% ████░░    │
│ 📦 杂货      RM 680    11.1% ███░░░    │
│ 💡 账单水电  RM 450     7.4% ██░░░░    │
│ 🎬 娱乐      RM 350     5.7% ██░░░░    │
│ 🏥 医疗      RM 200     3.3% █░░░░░    │
│ 💻 在线服务  RM 150     2.5% █░░░░░    │
│ ✈️ 旅游      RM 120     2.0% █░░░░░    │
│ 🛡️ 保险      RM 80      1.3% ░░░░░░    │
│ 🎓 教育      RM 50      0.8% ░░░░░░    │
│ 📋 其他      RM 30      0.5% ░░░░░░    │
│                                          │
│ 总计: RM 6,100 (45笔交易)                │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 了解消费结构
- 识别可优化的类别
- 制定预算计划

### 【计算方法】⭐
```python
# 自动分类算法
FOR transaction IN 本月交易:
    # 基于关键词匹配
    IF '餐' IN description OR 'KFC|MCDONALD|STARBUCKS' IN description:
        category = 'Food & Dining'
    ELIF 'GRAB|PETROL|TOUCH N GO' IN description:
        category = 'Transport'
    ELIF 'SHOPEE|LAZADA|PAVILION' IN description:
        category = 'Shopping'
    # ... 其他11个类别
    
    # 置信度评分
    IF keyword长度 > 5:
        confidence = 0.9
    ELSE:
        confidence = 0.7

# 统计汇总
分类统计 = SELECT category, 
                 SUM(amount) as total,
                 COUNT(*) as count
           FROM transactions
           WHERE card_id = 当前卡片
           AND statement_date = 当前月份
           GROUP BY category
           ORDER BY total DESC
```

---

## Tab 1 - 展示卡片 2.6: 交易明细表格

### 【展示内容】
```
┌────────────────────────────────────────────────────────────┐
│ 📝 交易明细（45笔）                                         │
├────┬──────┬─────────────────┬─────────┬────────┬─────────┤
│状态│日期  │描述              │类别      │金额    │收据状态 │
├────┼──────┼─────────────────┼─────────┼────────┼─────────┤
│ 🏷️│11-05│7SL ENTERPRISE    │SUPPLIER  │RM 520  │✅ 已匹配│
│    │11-05│KFC PAVILION      │餐饮      │RM 25.50│✅ 已匹配│
│    │11-05│PETRONAS DAMANSARA│交通      │RM 80   │✅ 已匹配│
│    │11-07│GRAB*TRIP ABC123  │交通      │RM 15   │⏳ 待匹配│
│    │11-08│SHOPEE*ELECTRONICS│购物      │RM 450  │❌ 缺失  │
│ 🏷️│11-10│DINAS RESTAURANT  │SUPPLIER  │RM 185  │✅ 已匹配│
│    │11-12│LAZADA*FASHION    │购物      │RM 280  │✅ 已匹配│
│    │...  │                  │          │        │         │
├────┴──────┴─────────────────┴─────────┴────────┴─────────┤
│ 筛选: [全部类别▼] [全部状态▼] [搜索...] [导出Excel]      │
└────────────────────────────────────────────────────────────┘
```

### 【为什么展示这个】
- 查看每笔交易详情
- 检查收据匹配状态
- 识别7大供应商交易（🏷️标记）

### 【计算方法】⭐
```python
# 7大供应商识别
7大供应商 = ['7SL', 'DINAS', 'RAUB SYC HAINAN', 
            'AI SMART TECH', 'HUAWEI', 'PASAR RAYA', 
            'PUCHONG HERBS']

FOR transaction IN 交易列表:
    FOR supplier IN 7大供应商:
        IF supplier IN transaction.description.upper():
            transaction.is_supplier = True
            transaction.service_fee = transaction.amount × 1%
            break

# 收据匹配状态
IF transaction.receipt_id IS NOT NULL:
    状态 = '✅ 已匹配'
ELIF transaction.created_at < 7天前 AND receipt IS NULL:
    状态 = '❌ 缺失'
ELSE:
    状态 = '⏳ 待匹配'
```

---

## Tab 1 - 展示卡片 2.7: 6大强制分类汇总

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 🎯 6大强制分类汇总                        │
├──────────────────────────────────────────┤
│ 1. OWNER消费（个人）                      │
│    交易数: 38笔                          │
│    金额: RM 5,395.00 (88.4%)             │
│                                          │
│ 2. INFINITE代付（公司）                   │
│    交易数: 0笔                           │
│    金额: RM 0.00 (0%)                    │
│                                          │
│ 3. 7大供应商（收服务费）                  │
│    交易数: 7笔                           │
│    金额: RM 705.00 (11.6%)               │
│    服务费收入: RM 7.05 (1%)              │
│                                          │
│ 供应商明细:                               │
│ • 7SL Enterprise: RM 520 → 费RM 5.20    │
│ • Dinas Restaurant: RM 185 → 费RM 1.85  │
│                                          │
│ [查看完整明细] [导出报表]                 │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 区分个人消费 vs 公司代付
- 计算7大供应商服务费收入
- 生成月结报告基础数据

### 【计算方法】⭐
```python
# 6大强制分类
1. OWNER (个人消费)
   = 非INFINITE代付 且 非7大供应商

2. INFINITE (公司代付)
   = 标记为INFINITE的交易
   
3. 7大供应商
   = 7SL | DINAS | RAUB SYC HAINAN | AI SMART TECH | 
     HUAWEI | PASAR RAYA | PUCHONG HERBS

# 服务费计算
FOR supplier_transaction IN 7大供应商交易:
    服务费 = transaction.amount × 1%
    
总服务费收入 = SUM(所有供应商交易 × 1%)
```

---

## Tab 2: 📸 收据匹配

### 展示卡片 2.8: 收据覆盖率仪表盘

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📊 收据覆盖率仪表盘                       │
├──────────────────────────────────────────┤
│                 83%                      │
│        ████████████████░░░               │
│                                          │
│ 已匹配: 38笔  ✅                         │
│ 待匹配: 5笔   ⏳                         │
│ 缺失:   2笔   ❌                         │
│ 总计:   45笔                             │
│                                          │
│ 目标: 100%覆盖率 (还差17%)               │
│                                          │
│ 💡 提示:                                 │
│ 上传剩余2张收据可达到100%覆盖率！         │
│                                          │
│ [上传收据] [批量匹配]                     │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 可视化数据完整性
- 督促用户上传收据
- 提升数据准确性

### 【计算方法】⭐
```python
# 收据覆盖率
总交易数 = COUNT(transactions)
已匹配数 = COUNT(transactions WHERE receipt_id IS NOT NULL)
待匹配数 = COUNT(transactions WHERE receipt_id IS NULL 
                                AND created_at >= 7天前)
缺失数 = COUNT(transactions WHERE receipt_id IS NULL 
                              AND created_at < 7天前)

覆盖率 = 已匹配数 / 总交易数 × 100%

目标缺口 = (100% - 覆盖率) × 总交易数

示例:
总45笔，已匹配38笔
覆盖率 = 38 / 45 × 100% = 84.4%
缺口 = (100% - 84.4%) × 45 = 7笔
```

---

## Tab 2 - 展示卡片 2.9: 上传收据区域

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📤 上传收据                               │
├──────────────────────────────────────────┤
│                                          │
│   ┌──────────────────────────┐          │
│   │  拖拽图片到这里            │          │
│   │  或点击选择文件            │          │
│   │                          │          │
│   │  📄 [浏览文件]           │          │
│   │                          │          │
│   │  支持格式: JPG, PNG, PDF  │          │
│   │  最大: 10MB/张            │          │
│   │  批量: 最多50张           │          │
│   └──────────────────────────┘          │
│                                          │
│ ✅ OCR自动识别:                          │
│ • 金额                                   │
│ • 日期                                   │
│ • 商户名称                                │
│ • 卡号后4位                              │
│                                          │
│ [上传并自动匹配]                          │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 批量上传节省时间
- OCR自动识别提高效率
- 智能匹配减少人工

### 【计算方法】⭐
```python
# OCR识别流程
1. 上传图片 → 服务器
2. Tesseract OCR引擎识别文字
3. 提取关键字段:
   - 金额: 正则 'RM\s*(\d+\.?\d*)'
   - 日期: 正则 '\d{2}/\d{2}/\d{4}'
   - 商户: 文本顶部最大字体
   - 卡号: 正则 '\*\*\*\*(\d{4})'

4. 自动匹配算法（见下一卡片）
```

---

## Tab 2 - 展示卡片 2.10: 智能收据匹配

### 【展示内容】
```
┌────────────────────────────────────────────────────────────┐
│ 🎯 智能收据匹配                                             │
├────────────────────────────────────────────────────────────┤
│ 收据 #001                                                  │
│ ┌──────────────────┐                                       │
│ │  [收据图片预览]   │  OCR识别结果:                         │
│ │                  │  • 金额: RM 25.50                     │
│ │  KFC PAVILION    │  • 日期: 2025-11-05                   │
│ │  RM 25.50        │  • 商户: KFC PAVILION                 │
│ │  2025-11-05      │  • 卡号: ****1234                     │
│ │  ****1234        │                                       │
│ └──────────────────┘                                       │
│                                                            │
│ 智能匹配建议 (3个候选):                                     │
│ ┌──────────────────────────────────────────────────────┐   │
│ │ 👑 #1 - 匹配度 超过70% (推荐)                              │   │
│ │ 日期: 2025-11-05  金额: RM 25.50                      │   │
│ │ 描述: KFC PAVILION KL                                 │   │
│ │ 卡号: ****1234  类别: 餐饮                            │   │
│ │ [✅ 确认匹配]                                         │   │
│ └──────────────────────────────────────────────────────┘   │
│ ┌──────────────────────────────────────────────────────┐   │
│ │ #2 - 匹配度 65%                                       │   │
│ │ 日期: 2025-11-06  金额: RM 26.00                      │   │
│ │ 描述: KFC SUNWAY PYRAMID                              │   │
│ │ [选择此项]                                            │   │
│ └──────────────────────────────────────────────────────┘   │
│ ┌──────────────────────────────────────────────────────┐   │
│ │ #3 - 匹配度 50%                                       │   │
│ │ 日期: 2025-11-04  金额: RM 25.50                      │   │
│ │ 描述: MCDONALD PAVILION                               │   │
│ │ [选择此项]                                            │   │
│ └──────────────────────────────────────────────────────┘   │
│                                                            │
│ [跳过此收据] [手动输入] [下一张收据]                        │
└────────────────────────────────────────────────────────────┘
```

### 【为什么展示这个】
- 自动化匹配节省人工
- 多候选确保准确性
- 可视化匹配度提高信心

### 【计算方法】⭐⭐⭐

**智能匹配算法（4维度加权）**:

```python
def calculate_match_score(receipt, transaction):
    """
    计算收据与交易的匹配度
    """
    # 1. 卡号匹配（权重40%）
    if receipt.card_last4 == transaction.card_last4:
        card_score = 100
    else:
        card_score = 0
    
    # 2. 日期匹配（权重30%，±3天容差）
    date_diff = abs((receipt.date - transaction.date).days)
    if date_diff == 0:
        date_score = 100
    elif date_diff <= 1:
        date_score = 90
    elif date_diff <= 3:
        date_score = 70
    else:
        date_score = 0
    
    # 3. 金额匹配（权重20%，±1%容差）
    amount_diff = abs(receipt.amount - transaction.amount)
    amount_percent_diff = amount_diff / transaction.amount
    if amount_diff == 0:
        amount_score = 100
    elif amount_percent_diff <= 0.01:  # ±1%
        amount_score = 95
    elif amount_percent_diff <= 0.05:  # ±5%
        amount_score = 70
    else:
        amount_score = 0
    
    # 4. 商户匹配（权重10%，模糊匹配）
    # 使用Levenshtein距离算法
    merchant_similarity = fuzzy_match(
        receipt.merchant_name,
        transaction.description
    )
    merchant_score = merchant_similarity × 100
    
    # 加权总分
    total_score = (
        card_score × 0.40 +
        date_score × 0.30 +
        amount_score × 0.20 +
        merchant_score × 0.10
    )
    
    return round(total_score, 2)

# 实际示例
receipt = {
    'card_last4': '1234',
    'date': '2025-11-05',
    'amount': 25.50,
    'merchant': 'KFC PAVILION'
}

transaction = {
    'card_last4': '1234',
    'date': '2025-11-05',
    'amount': 25.50,
    'description': 'KFC PAVILION KL'
}

# 计算过程
卡号匹配: 100% × 40% = 40分 (完全一致)
日期匹配: 100% × 30% = 30分 (同一天)
金额匹配: 100% × 20% = 20分 (完全一致)
商户匹配: 80% × 10% = 8分 (KFC PAVILION vs KFC PAVILION KL)

总匹配度 = 40 + 30 + 20 + 8 = 超过70%
```

**自动处理规则**:
```
匹配度 ≥90%: 👑 自动确认（高度可信）
匹配度 70-89%: 人工确认（可能正确）
匹配度 <70%: 人工选择（不确定）
```

---

## Tab 3: 🏷️ 供应商发票

### 展示卡片 2.11: 本月服务费收入汇总

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 💰 本月服务费收入汇总                     │
├──────────────────────────────────────────┤
│ 7大供应商交易金额                         │
│ RM 705.00                                │
│                                          │
│ 服务费收入 (1%)                          │
│ RM 7.05                                  │
│                                          │
│ 交易笔数: 7笔                            │
│                                          │
│ [生成发票PDF] [发送给客户]               │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 计算INFINITE GZ的服务费收入
- 自动生成发票
- 透明化收费

### 【计算方法】⭐
```python
# 识别7大供应商交易
7大供应商 = ['7SL', 'DINAS', 'RAUB SYC HAINAN', 
            'AI SMART TECH', 'HUAWEI', 'PASAR RAYA', 
            'PUCHONG HERBS']

供应商交易 = SELECT * FROM transactions
            WHERE UPPER(description) LIKE ANY(7大供应商)
            AND statement_date = 当前月份

交易总额 = SUM(供应商交易.amount)
服务费收入 = 交易总额 × 1%

示例:
7笔交易共 RM 705
服务费 = RM 705 × 1% = RM 7.05
```

---

## Tab 3 - 展示卡片 2.12: 供应商发票列表

### 【展示内容】
```
┌────────────────────────────────────────────────────────────┐
│ 🏷️ 7大供应商交易明细                                       │
├────┬──────┬─────────────────┬─────────┬────────┬─────────┤
│#   │日期  │供应商            │交易金额  │服务费  │发票状态 │
├────┼──────┼─────────────────┼─────────┼────────┼─────────┤
│ 1  │11-05│7SL ENTERPRISE    │RM 520.00│RM 5.20 │✅ 已生成│
│ 2  │11-10│DINAS RESTAURANT  │RM 185.00│RM 1.85 │✅ 已生成│
│ 3  │11-15│PASAR RAYA        │RM 0.00  │RM 0.00 │⏳ 待确认│
│    │...  │                  │         │        │         │
├────┴──────┴─────────────────┴─────────┴────────┴─────────┤
│ 总计: 7笔  交易额: RM 705.00  服务费: RM 7.05            │
│                                                            │
│ [批量生成发票PDF] [导出Excel] [发送给客户]                │
└────────────────────────────────────────────────────────────┘
```

### 【为什么展示这个】
- 查看每笔供应商交易详情
- 生成专业发票PDF
- 记录服务费收入

### 【客户利益】
- ✅ 透明化收费（客户知道付了什么）
- ✅ 专业发票（可用于报税）
- ✅ 自动化生成（节省会计工作）

---

## Tab 4: 📊 月结报告 ⭐⭐⭐

### 展示卡片 2.13: 数据完整性评分

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 🎯 数据完整性评分                         │
├──────────────────────────────────────────┤
│                                          │
│              87分                        │
│        ██████████████████░░              │
│           评级: B级                      │
│                                          │
│ 评分构成:                                 │
│ ✅ 账单验证: 40/40分 (通过)              │
│ 🟡 收据覆盖率: 33/40分 (83%)             │
│ ✅ 发票确认: 14/20分 (7大供应商已确认)   │
│                                          │
│ 💡 改善建议:                              │
│ 上传剩余7张收据可达到A级（95分+）         │
│                                          │
│ 评级标准:                                 │
│ A+级: 98-100分 (完美)                    │
│ A级:  95-97分  (优秀)                    │
│ B级:  85-94分  (良好) ← 当前             │
│ C级:  70-84分  (尚可)                    │
│ D级:  <70分    (需改善)                  │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】⭐⭐⭐
- 衡量数据可信度
- 银行/会计师认可度
- 指导用户改善数据质量

### 【计算方法】⭐⭐⭐

**评分基于：账单验证（双重验证系统） + 收据覆盖率 + 发票确认**

```python
# 1. 账单验证 (40分)
def verify_statement():
    """
    双重验证系统
    """
    # Level 1: PDF声明提取
    pdf_total_debit = 从PDF提取("Total Debit")
    pdf_total_credit = 从PDF提取("Total Credit")
    
    # Level 2: 计算验证
    calculated_debit = SUM(transactions WHERE type='DEBIT')
    calculated_credit = SUM(transactions WHERE type='CREDIT')
    
    # Level 2完成后进行信心评分
    previous_balance + total_debit - total_credit == current_balance
    
    # 评分
    if all_three_pass:
        return 40分
    elif two_pass:
        return 30分
    elif one_pass:
        return 20分
    else:
        return 0分

# 2. 收据覆盖率 (40分)
覆盖率 = 已匹配交易数 / 总交易数 × 100%
评分 = 40 × 覆盖率

示例:
38笔已匹配 / 45笔总交易 = 84.4%
评分 = 40 × 84.4% = 33.76分 ≈ 34分

# 3. 发票确认 (20分)
7大供应商交易数 = 7笔
已确认发票数 = 5笔
确认率 = 5 / 7 = 71.4%
评分 = 20 × 71.4% = 14.28分 ≈ 14分

# 总分
总分 = 40 + 34 + 14 = 88分 → B级

# 评级标准
def get_grade(score):
    if score >= 98:
        return 'A+级 (完美)'
    elif score >= 95:
        return 'A级 (优秀)'
    elif score >= 85:
        return 'B级 (良好)'
    elif score >= 70:
        return 'C级 (尚可)'
    else:
        return 'D级 (需改善)'
```

### 【客户利益】
- ✅ 数据高度可信（经过双重验证系统）
- ✅ 银行更易批贷（A级=专业管理）
- ✅ 税务审计无忧（完整凭证）
- ✅ 会计师省时（数据准确无需复核）

---

## Tab 4 - 展示卡片 2.14: 月度报告摘要

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📋 月度报告摘要 - 2025年11月              │
├──────────────────────────────────────────┤
│ 信用卡: Maybank ****1234                 │
│ 客户: CHEOK JUN YOON                     │
│                                          │
│ 📊 账单数据:                              │
│ • 交易笔数: 45笔                         │
│ • 本月消费: RM 6,100.00                  │
│ • 应还款额: RM 6,100.00                  │
│ • 最低还款: RM 305.00                    │
│ • 到期日: 2025-11-25                     │
│                                          │
│ 📸 收据数据:                              │
│ • 已匹配: 38笔 (83%)                     │
│ • 待匹配: 5笔                            │
│ • 缺失: 2笔                              │
│                                          │
│ 🏷️ 发票数据:                             │
│ • 7大供应商交易: 7笔                     │
│ • 交易总额: RM 705.00                    │
│ • 服务费收入: RM 7.05                    │
│                                          │
│ 🎯 6大强制分类:                           │
│ • OWNER消费: RM 5,395 (88.4%)           │
│ • INFINITE代付: RM 0 (0%)               │
│ • 7大供应商: RM 705 (11.6%)             │
│                                          │
│ 📈 12大类别支出:                          │
│ • 餐饮: RM 1,850 (30.3%)                │
│ • 购物: RM 1,220 (20.0%)                │
│ • ... (其他10类)                        │
│                                          │
│ 💯 数据评分: B级 (87分)                  │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 一页总结所有关键数据
- 快速了解月度财务状况
- 作为报告生成的预览

---

## Tab 4 - 展示卡片 2.15: 报告导出选项

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📤 报告导出选项                           │
├──────────────────────────────────────────┤
│ 导出格式:                                 │
│ ○ PDF报告 (推荐) - 专业格式，可打印       │
│ ○ Excel工作簿 - 详细数据，可编辑         │
│ ○ CSV文件 - 纯数据，可导入其他系统       │
│                                          │
│ 包含内容:                                 │
│ ☑ 账单摘要                               │
│ ☑ 交易明细（45笔）                       │
│ ☑ 收据匹配状态                           │
│ ☑ 供应商发票                             │
│ ☑ 分类统计图表                           │
│ ☑ 数据完整性评分                         │
│                                          │
│ [生成PDF报告] [导出Excel] [导出CSV]      │
│ [发送到邮箱] [保存到云端]                 │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 多格式适应不同用途
- PDF适合提交银行/会计师
- Excel适合自己分析

---

## Tab 4 - 展示卡片 2.16: PDF报告完整结构

### 【展示内容】

**15页专业月度报告结构**:

```
┌──────────────────────────────────────────┐
│ CreditPilot 月度财务报告                  │
│ INFINITE GZ SDN. BHD.                    │
│ 2025年11月 - Maybank ****1234            │
├──────────────────────────────────────────┤
│                                          │
│ 第1页: 封面                              │
│ • 公司Logo                               │
│ • 报告标题                               │
│ • 客户姓名                               │
│ • 报告日期                               │
│                                          │
│ 第2页: 执行摘要                          │
│ • 本月财务概况                           │
│ • 关键指标（消费/还款/评分）             │
│ • 数据完整性评级                         │
│                                          │
│ 第3页: 账单验证报告                      │
│ • 双重验证结果                           │
│ • PDF vs 计算对比                        │
│ • 余额连续性验证                         │
│                                          │
│ 第4-5页: 交易明细（45笔）                │
│ • 完整交易列表                           │
│ • 收据匹配状态                           │
│ • 7大供应商标记                          │
│                                          │
│ 第6页: 12大类别分析                      │
│ • 饼图展示                               │
│ • 柱状图对比                             │
│ • 同比/环比分析                          │
│                                          │
│ 第7页: 6大强制分类                       │
│ • OWNER vs INFINITE                     │
│ • 7大供应商明细                          │
│ • 服务费计算                             │
│                                          │
│ 第8-9页: 收据匹配报告                    │
│ • 覆盖率统计                             │
│ • 已匹配收据清单（附缩略图）             │
│ • 待匹配/缺失交易列表                    │
│                                          │
│ 第10-11页: 供应商发票                    │
│ • 7大供应商交易明细                      │
│ • 服务费收入汇总                         │
│ • 发票PDF（附件）                        │
│                                          │
│ 第12页: 数据完整性评分                   │
│ • 评分细则                               │
│ • 改善建议                               │
│ • 对比往月趋势                           │
│                                          │
│ 第13页: 财务健康建议                     │
│ • 基于数据的个性化建议                   │
│ • 优化支出类别                           │
│ • 提升评分策略                           │
│                                          │
│ 第14页: 附录 - 术语表                   │
│ • DSR, 信用利用率等解释                  │
│                                          │
│ 第15页: 联系方式                         │
│ • INFINITE GZ联系方式                    │
│ • 客服支持                               │
│                                          │
└──────────────────────────────────────────┘
```

### 【客户利益】
- ✅ 专业报告（适合提交银行）
- ✅ 完整凭证（税务审计）
- ✅ 数据透明（会计师认可）
- ✅ 一键生成（节省时间）

---

# 模块3: SAVINGS（储蓄账户管理）

**页面作用**: 管理多银行储蓄账户，追踪收入/支出

---

## 展示卡片 3.1: 储蓄账户列表

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 💰 储蓄账户概览                           │
├──────────────────────────────────────────┤
│ Maybank Islamic ****5678                 │
│ 当前余额: RM 19,500.00                   │
│ 本月净收入: +RM 3,300 (↑)               │
│ [查看交易]                               │
│                                          │
│ GX Bank ****9012                         │
│ 当前余额: RM 25,800.00                   │
│ 本月净收入: +RM 5,200 (↑)               │
│ [查看交易]                               │
│                                          │
│ 总储蓄: RM 45,300.00                     │
│ 本月总净收入: +RM 8,500                  │
│                                          │
│ [添加账户] [上传账单]                     │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 管理多银行储蓄账户
- 追踪储蓄增长
- 计算储蓄覆盖率

### 【计算方法】⭐
```python
# 支持的7家银行
支持银行 = [
    'Maybank Islamic',
    'GX Bank',
    'Hong Leong Bank',
    'CIMB Savings',
    'UOB Savings',
    'OCBC Savings',
    'Public Bank Savings'
]

# Universal Balance-Change Algorithm
FOR transaction IN PDF:
    IF '余额' IN 前一列 AND '金额' IN 当前列:
        IF 当前余额 > 前余额:
            transaction_type = 'CREDIT' (存款)
        ELSE:
            transaction_type = 'DEBIT' (取款)
```

---

## 展示卡片 3.2: 搜索客户名功能

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 🔍 搜索客户名                             │
├──────────────────────────────────────────┤
│ 输入客户名: [YEO CHEE WANG____]  [搜索] │
│                                          │
│ 搜索结果:                                 │
│ 找到 3 笔交易                            │
│                                          │
│ 2025-11-05  YEO CHEE WANG  RM 1,500  CR │
│ 2025-10-15  YEO CHEE WANG  RM 2,000  CR │
│ 2025-09-20  YEO CHEE WANG  RM 1,000  CR │
│                                          │
│ 总计: RM 4,500 (预付款结算)              │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- 追踪客户代付款记录
- 结算预付款
- 核对转账记录

### 【客户利益】
- ✅ 快速找到代付记录
- ✅ 避免遗忘结算
- ✅ 账目清晰

---

# 模块4: LOANS（智能贷款匹配器）

**页面作用**: CTOS解析 + DSR计算 + 智能推荐 + 比价

（此部分基于您提供的Loans Intelligence真实功能）

---

## 展示卡片 4.1: CTOS自动解析

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📄 上传CTOS报告                           │
├──────────────────────────────────────────┤
│ [拖拽PDF到这里]                           │
│                                          │
│ AI-Powered OCR自动识别:                  │
│ ✅ 信用评分                              │
│ ✅ 现有贷款列表                          │
│ ✅ 月供总计                              │
│ ✅ 信用卡信息                            │
│                                          │
│ 节省90%数据输入时间！                     │
└──────────────────────────────────────────┘
```

### 【为什么展示这个】
- CTOS报告很长（10-20页）
- 手动输入耗时20+分钟
- OCR自动识别只需2分钟

---

## 展示卡片 4.2: DSR计算器

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 🧮 DSR计算器                              │
├──────────────────────────────────────────┤
│ 月净收入: [RM 8,500___]                  │
│ 现有月供: [RM 2,450___]                  │
│                                          │
│ 新贷款金额: [RM 500,000___]              │
│ APR利率: [3.5___]%                       │
│ 贷款期限: [30___] 年                     │
│                                          │
│ [计算DSR]                                │
│                                          │
│ ═══════════ 计算结果 ═══════════         │
│                                          │
│ 新贷款月供: RM 2,245.22                  │
│ 总月供: RM 4,695.22                      │
│ DSR: 55.2% ⚠️ BORDERLINE                │
│                                          │
│ 建议:                                     │
│ • 增加首付RM 50,000 → DSR 52.8% ✅       │
│ • 延长至35年 → DSR 53.5% ✅              │
└──────────────────────────────────────────┘
```

### 【计算方法】⭐⭐⭐

**PMT公式（银行级）**:

```python
def calculate_pmt(principal, annual_rate, years):
    """
    计算贷款月供
    """
    # 月利率
    i = annual_rate / 12 / 100
    
    # 总月数
    n = years × 12
    
    # PMT公式
    if i == 0:
        monthly_payment = principal / n
    else:
        monthly_payment = principal × i × (1 + i)**n / ((1 + i)**n - 1)
    
    return round(monthly_payment, 2)

# 示例
principal = 500,000
annual_rate = 3.5
years = 30

i = 3.5 / 12 / 100 = 0.002917
n = 30 × 12 = 360

月供 = 500,000 × 0.002917 × (1.002917)^360 / ((1.002917)^360 - 1)
    = 500,000 × 0.002917 × 2.8533 / 1.8533
    = RM 2,245.22

# DSR计算
总月供 = 现有月供 + 新贷款月供
      = RM 2,450 + RM 2,245.22
      = RM 4,695.22

DSR = 总月供 / 月收入 × 100%
    = RM 4,695.22 / RM 8,500 × 100%
    = 55.2%

# 批准状态
- DSR ≤55%: ✅ PASS（银行会批准）
- DSR 55-70%: ⚠️ BORDERLINE（需优化）
- DSR ≥70%: ❌ HIGH（很难批准）
```

---

## 展示卡片 4.3: Top-3智能推荐

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 👑 Top-3 智能推荐                         │
├──────────────────────────────────────────┤
│ #1 - Maybank FlexiRate 👑                │
│ ─────────────────────────────────────    │
│ 利率: 3.25% APR ⭐ (最低)                │
│ 月供: RM 2,176.34 ⭐ (最低)              │
│ DSR: 54.4% ✅ PASS                       │
│ 匹配度: 超过70%                              │
│                                          │
│ 推荐理由:                                 │
│ • 利率最低，30年可省RM 28,000            │
│ • 公务员优惠                             │
│ • 无锁定期                               │
│                                          │
│ [加入比价] [查看详情]                     │
│                                          │
│ #2 - CIMB Islamic Financing              │
│ ─────────────────────────────────────    │
│ 利率: 3.35% APR                          │
│ 月供: RM 2,201.45                        │
│ DSR: 54.7% ✅ PASS                       │
│ 匹配度: 95%                              │
│                                          │
│ #3 - Public Bank EzyHome                 │
│ ─────────────────────────────────────    │
│ 利率: 3.45% APR                          │
│ 月供: RM 2,226.82                        │
│ DSR: 55.0% ✅ PASS                       │
│ 匹配度: 92%                              │
└──────────────────────────────────────────┘
```

### 【计算方法】⭐⭐⭐

**三级排序算法**:

```python
def rank_loan_products(products, user_params):
    """
    智能排名算法
    """
    # 为每个产品计算月供和DSR
    for product in products:
        product.monthly_pmt = calculate_pmt(
            user_params.loan_amount,
            product.apr,
            user_params.tenure
        )
        
        product.total_commitment = (
            user_params.existing_commitments +
            product.monthly_pmt
        )
        
        product.dsr = (
            product.total_commitment /
            user_params.monthly_income × 100
        )
        
        # DSR状态
        if product.dsr <= 55:
            product.dsr_status = 'PASS'
        elif product.dsr <= 70:
            product.dsr_status = 'BORDERLINE'
        else:
            product.dsr_status = 'HIGH'
    
    # 三级排序
    ranked = sorted(products, key=lambda x: (
        # Level 1: DSR状态（PASS优先）
        0 if x.dsr_status == 'PASS' else 
        1 if x.dsr_status == 'BORDERLINE' else 2,
        
        # Level 2: 月供金额（低到高）
        x.monthly_pmt,
        
        # Level 3: DSR百分比（低到高）
        x.dsr
    ))
    
    # 加权评分（可选）
    for i, product in enumerate(ranked[:3]):
        product.weighted_score = (
            (55 - product.dsr) × 0.4 +      # DSR权重40%
            (5 - product.apr) × 0.3 +       # 利率权重30%
            product.preference_score × 0.2 + # 偏好权重20%
            product.sentiment_score × 0.1    # 情绪权重10%
        )
    
    return ranked[:3]  # 返回Top-3
```

---

## 展示卡片 4.4: 比价篮

### 【展示内容】
```
┌────────────────────────────────────────────────────────────┐
│ 📊 比价篮（并排对比）                                       │
├────┬────────────┬─────────────┬──────────────┬────────────┤
│#   │Bank        │Product      │APR   │Monthly│DSR   │Status│
├────┼────────────┼─────────────┼──────┼───────┼──────┼──────┤
│👑1 │Maybank     │FlexiRate    │3.25% │RM2,176│54.4% │PASS✅│
│ 2  │CIMB        │Islamic      │3.35% │RM2,201│54.7% │PASS✅│
│ 3  │Public Bank │EzyHome      │3.45% │RM2,226│55.0% │PASS✅│
└────┴────────────┴─────────────┴──────┴───────┴──────┴──────┘
│                                                            │
│ [重新计算] [保存快照] [复制分享链接] [导出PDF]             │
└────────────────────────────────────────────────────────────┘
```

---

## 展示卡片 4.5: 快照分享

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 💾 保存快照                               │
├──────────────────────────────────────────┤
│ 快照已保存！                              │
│                                          │
│ 快照代码: ABC123                         │
│ 有效期: 30天                             │
│                                          │
│ 分享链接:                                 │
│ portal.creditpilot.digital/share/ABC123  │
│                                          │
│ [复制链接] [发送Email] [发送WhatsApp]    │
│                                          │
│ 用途:                                     │
│ • 分享给家人讨论                         │
│ • 分享给财务顾问咨询                     │
│ • 长期存档对比                           │
└──────────────────────────────────────────┘
```

---

# 模块5: REPORTS（月度汇总报告）

**页面作用**: 生成跨卡片、跨月份的综合报告

---

## 展示卡片 5.1: 报告生成器

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📊 月度汇总报告生成器                     │
├──────────────────────────────────────────┤
│ 客户: [CHEOK JUN YOON ▼]                │
│                                          │
│ 日期范围:                                 │
│ 从: [2025-01 ▼]                          │
│ 到: [2025-11 ▼]                          │
│                                          │
│ 包含内容:                                 │
│ ☑ 所有信用卡账单（8张卡）                │
│ ☑ 储蓄账户（2个账户）                    │
│ ☑ 收支分析                               │
│ ☑ 分类统计                               │
│ ☑ 财务健康评分                           │
│                                          │
│ [生成Excel报告] [生成PDF报告]            │
└──────────────────────────────────────────┘
```

---

# 模块6: ADMIN（系统管理）

**页面作用**: 用户管理、系统设置、审计日志

---

## 展示卡片 6.1: 用户管理

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 👥 用户管理                               │
├──────────────────────────────────────────┤
│ [添加新用户] [导入CSV]                    │
│                                          │
│ ID  姓名              Email      状态    │
│ 6   CHEOK JUN YOON    cheok@... ✅ 活跃  │
│ 7   YEO CHEE WANG     yeo@...   ✅ 活跃  │
│ 8   TEO YOK CHU       teo@...   ✅ 活跃  │
│                                          │
│ [编辑] [删除] [查看详情]                  │
└──────────────────────────────────────────┘
```

---

## 展示卡片 6.2: 审计日志

### 【展示内容】
```
┌──────────────────────────────────────────┐
│ 📋 审计日志                               │
├──────────────────────────────────────────┤
│ 时间            用户         操作        │
│ 2025-11-07 10:30  admin  上传账单       │
│ 2025-11-07 10:25  user6  删除客户       │
│ 2025-11-07 10:20  user7  登录系统       │
│                                          │
│ [筛选] [导出日志]                         │
└──────────────────────────────────────────┘
```

---

# 附录: 技术实现细节

## 数据库表结构

**核心表（基于archived资料）**:

```sql
-- 客户表
customers (
    id, name, email, phone, monthly_income,
    is_active, created_at
)

-- 信用卡表
credit_cards (
    id, customer_id, bank_name, card_last4,
    credit_limit, is_active
)

-- 账单表
credit_card_statements (
    id, card_id, statement_date, due_date,
    previous_balance, total_debit, total_credit,
    interest_charged, total_amount_due, minimum_payment,
    closing_balance, file_path, verified
)

-- 交易表
credit_card_transactions (
    id, statement_id, transaction_date, description,
    amount, transaction_type, category, confidence_score,
    is_gz_supplier, receipt_id
)

-- 收据表
receipts (
    id, customer_id, card_id, upload_date,
    file_path, ocr_amount, ocr_date, ocr_merchant,
    ocr_card_last4, matched_transaction_id,
    match_confidence
)

-- 储蓄账户表
savings_accounts (
    id, customer_id, bank_name, account_last4,
    current_balance
)

-- 储蓄交易表
savings_transactions (
    id, savings_account_id, transaction_date,
    description, amount, transaction_type, balance,
    customer_name_tag
)
```

---

## 核心算法总结

### 1. 财务健康评分算法
```
总分 = 信用利用率(20%) + 还款记录(30%) + DSR(20%) + 储蓄覆盖率(30%)
```

### 2. DSR计算算法
```
DSR = (现有月供 + 新贷款月供) / 月收入 × 100%
月供 = PMT(本金, APR, 年数)
```

### 3. 收据匹配算法
```
匹配度 = 卡号(40%) + 日期(30%) + 金额(20%) + 商户(10%)
```

### 4. 数据完整性评分算法
```
评分基于：账单验证（双重验证系统） + 收据覆盖率 + 发票确认
```

### 5. Top-3排名算法
```
排序: DSR状态 → 月供金额 → DSR百分比
```

---

## 支持的银行（基于archived资料）

### 信用卡（15家银行）
1. Maybank (马来亚银行)
2. CIMB
3. Public Bank (大众银行)
4. RHB Bank
5. Hong Leong Bank (丰隆银行)
6. AmBank
7. Alliance Bank
8. Affin Bank
9. HSBC (含OCR扫描PDF)
10. Standard Chartered (渣打银行)
11. OCBC Bank
12. UOB Malaysia (大华银行)
13. Bank Islam (伊斯兰银行)
14. Bank Rakyat (人民银行)
15. Bank Muamalat (木阿玛拉银行)

### 储蓄账户（7家银行）
1. Maybank Islamic
2. GX Bank
3. Hong Leong Bank
4. CIMB Savings
5. UOB Savings
6. OCBC Savings
7. Public Bank Savings

---

## 12大交易分类

1. Food & Dining (餐饮)
2. Transport (交通)
3. Shopping (购物)
4. Groceries (杂货)
5. Bills & Utilities (账单水电)
6. Entertainment (娱乐)
7. Healthcare (医疗)
8. Online Services (在线服务)
9. Travel (旅游)
10. Insurance (保险)
11. Education (教育)
12. Others (其他)

---

## 7大供应商（1%服务费）

1. 7SL ENTERPRISE
2. DINAS RESTAURANT
3. RAUB SYC HAINAN
4. AI SMART TECH
5. HUAWEI
6. PASAR RAYA
7. PUCHONG HERBS

---

© INFINITE GZ SDN. BHD. · CreditPilot 详细页面规格书 · 2025-11-07
