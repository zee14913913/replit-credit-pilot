# 储蓄账户月结单 - 双重人工验证工作流程（Web界面版）

## 📌 核心原则

**零容差、100%准确性**：每一笔交易的序号、日期、描述、金额、类型、余额都必须与PDF原件完全一致，一字不差。

---

## 🔄 完整验证工作流程（全自动化）

### 第一步：上传月结单PDF

1. **登录系统**
   - 访问系统网址
   - 使用Admin账号登录

2. **导航到上传页面**
   - 点击「储蓄账户」菜单
   - 点击「上传月结单」

3. **选择PDF文件并上传**
   - 选择客户
   - 选择银行
   - 上传PDF文件
   - 点击「上传」按钮

4. **系统自动处理**
   - 系统自动解析PDF
   - 提取所有交易记录
   - 保存到数据库
   - **自动跳转到验证页面**（无需任何额外操作）

---

### 第二步：双重人工验证（在Web界面完成）

**系统上传成功后会自动显示验证页面**，包含：

#### 页面布局
```
┌─────────────────────────────────────────────────────────┐
│ 🔍 储蓄账户月结单 - 双重人工验证系统                     │
├─────────────────────────────────────────────────────────┤
│ 📋 账单信息                                              │
│   账单ID: 207                                            │
│   客户名称: Tan Zee Liang                                │
│   银行账户: GX Bank ****8388                             │
│   账单日期: 2024-06-30                                   │
│   交易总数: 11 笔                                        │
│   验证状态: ⏳ 待验证                                     │
├─────────────────────────────────────────────────────────┤
│ 📝 双重验证步骤（必须完成）                               │
│                                                          │
│ ⚠️ 核心要求：每条交易的序号、日期、描述、金额、类型、   │
│    余额都必须与PDF原件100%一致，一字不差！               │
│                                                          │
│ 第一遍验证：                                             │
│ 1. 打开PDF原件：static/uploads/[路径]                    │
│ 2. 从第1笔交易开始，逐行对比下方表格                      │
│ 3. 在纸上记录：第1遍验证通过 ✓                           │
│                                                          │
│ 第二遍验证：                                             │
│ 1. 休息5分钟，让眼睛放松                                 │
│ 2. 再次从第1笔交易开始，重新逐行对比一遍                  │
│ 3. 在纸上记录：第2遍验证通过 ✓                           │
├─────────────────────────────────────────────────────────┤
│ 📊 交易记录详细对比表（请与PDF原件逐行核对）              │
│                                                          │
│ 序号 | 日期      | 描述           | 类型 | 金额    | 余额 │
│ ─────┼──────────┼────────────────┼─────┼────────┼──────│
│  1   | 1 Jun... | Interest...    | CR  | RM 0.10| RM...│
│  2   | 2 Jun... | Interest...    | CR  | RM 0.10| RM...│
│  ... | ...      | ...            | ... | ...    | ...  │
├─────────────────────────────────────────────────────────┤
│ 💰 财务汇总                                              │
│   Total Credit (入账):  RM 1,234.56                     │
│   Total Debit (出账):   RM 567.89                       │
│   期末余额:             RM 2,345.67                     │
├─────────────────────────────────────────────────────────┤
│          [✅ 确认验证完成（双重验证已完成）]              │
│                   [返回客户列表]                         │
└─────────────────────────────────────────────────────────┘
```

---

### 第三步：第一遍人工验证（逐行对比）

1. **打开PDF原件**
   - 根据页面显示的文件路径打开PDF
   - 例如：`static/uploads/customers/Be_rich_TZL/savings/Gx_Bank/2024-06/Gx_Bank_8388_2024-06-30.pdf`

2. **准备验证工具**
   - 纸和笔，用于记录验证结果
   - 双显示器（一个显示PDF，一个显示Web验证页面）

3. **逐行核对（从第1笔开始）**
   
   | 验证项目 | 检查内容 | 标记 |
   |---------|---------|------|
   | ✅ 序号 | 系统序号1 = PDF第1笔？ | □ |
   | ✅ 日期 | 系统日期是否与PDF完全一致？ | □ |
   | ✅ 描述 | 描述内容是否100%一致（一字不差）？ | □ |
   | ✅ 金额 | 金额数字是否完全相同？ | □ |
   | ✅ 类型 | CR/DR标识是否正确？ | □ |
   | ✅ 余额 | 每笔交易后的余额是否正确？ | □ |

4. **重点检查**
   - **描述内容**：是否有多字、少字、错字？
   - **特殊字符**：空格、标点符号是否一致？
   - **日期格式**：日期是否与PDF格式匹配？
   - **金额精度**：小数点后2位是否准确？

5. **记录第一遍验证结果**
   ```
   第1遍验证：
   - 日期：2024-10-29
   - 账单ID：207
   - 验证人：________
   - 结果：□ 通过 / □ 发现问题
   - 问题记录（如有）：
     _______________________________
     _______________________________
   ```

---

### 第四步：第二遍人工验证（重新核对）

**为什么需要第二遍？**
- 第一遍可能因疲劳、视觉误差而遗漏错误
- 双重验证确保100%准确性
- 符合银行级数据审核标准

**第二遍验证步骤**：
1. **休息5分钟**，让眼睛放松
2. **关闭第一遍的记录**，避免先入为主
3. **重新从第1笔交易开始**，再次逐行对比
4. **特别关注第一遍标记的疑问点**

**记录第二遍验证结果**：
```
第2遍验证：
- 日期：2024-10-29
- 账单ID：207
- 验证人：________
- 结果：□ 通过 / □ 发现问题
- 问题记录（如有）：
  _______________________________
  _______________________________
```

---

### 第五步：标记为已验证（一键完成）

#### ✅ 如果两遍验证都通过：

1. **点击「确认验证完成」按钮**
2. **系统弹出二次确认对话框**：
   ```
   ⚠️ 确认已完成双重人工验证？

   请确保：
   ✓ 第一遍验证通过
   ✓ 第二遍验证通过
   ✓ 所有交易记录与PDF原件100%一致

   点击"确定"标记为已验证。
   ```

3. **点击「确定」**
4. **系统自动更新验证状态**：
   - `verification_status` → `verified`
   - `verified_at` → 当前时间
   - 显示成功消息：「✅ 账单已标记为已验证！数据已确认100%准确。」

5. **自动跳转回客户列表**

---

#### ❌ 如果发现问题：

**常见问题类型**：
1. **描述不一致**：系统提取的描述与PDF不同
2. **金额错误**：金额解析错误
3. **余额不连续**：Balance-Change算法计算错误
4. **交易遗漏**：系统漏提取某些交易
5. **交易多余**：系统多提取了不该有的交易

**处理流程**：
1. **不要点击「确认验证完成」按钮**
2. **记录问题详情**：
   ```
   问题报告：
   - 账单ID：207
   - 问题交易序号：7
   - 问题类型：描述不一致
   - PDF原文："DT PRICE SOLUTION 07:46 PM Duitnow - Account number Transfer"
   - 系统记录："DT PRICE SOLUTION 07:46 PM Duitnow"
   - 发现人：________
   - 日期：2024-10-29
   ```

3. **联系技术人员修复解析器**
4. **技术人员修复后，重新上传PDF**
5. **系统会再次自动跳转到验证页面**
6. **重新执行双重验证流程**

---

## 📋 验证检查清单（Checklist）

打印此清单，每次验证时使用：

```
储蓄账户月结单验证检查清单（Web界面版）

账单信息：
□ 账单ID：________
□ 客户名称：________
□ 银行账户：________
□ 账单日期：________
□ PDF路径：________

第一遍验证：
□ 已打开PDF原件
□ 已逐行核对序号、日期、描述、金额、类型、余额
□ 已标记疑问点
□ 第1遍结果：□ 通过 / □ 发现问题

第二遍验证：
□ 已休息5分钟
□ 已重新逐行核对
□ 已确认疑问点
□ 第2遍结果：□ 通过 / □ 发现问题

最终确认：
□ 两遍验证都通过
□ 已点击「确认验证完成」按钮
□ 系统显示「✅ 账单已标记为已验证」
□ 验证人签名：________ 日期：________
```

---

## 🎯 验证标准（Quality Standards）

| 验证项目 | 准确性要求 | 检查方法 |
|---------|-----------|---------|
| **交易总数** | 100% | 系统记录数 = PDF交易总数 |
| **日期格式** | 100% | 逐行对比，格式一致 |
| **描述内容** | 100% | 一字不差，包括空格和标点 |
| **金额数值** | 100% | 小数点后2位完全相同 |
| **CR/DR类型** | 100% | 入账=CR，出账=DR |
| **余额连续性** | 100% | 每笔交易后余额正确 |
| **Total Credit** | 100% | 系统汇总 = PDF汇总 |
| **Total Debit** | 100% | 系统汇总 = PDF汇总 |
| **Closing Balance** | 100% | 期末余额完全一致 |

**不合格标准**：任何一项不符合100%要求，整个账单验证失败。

---

## 🆕 新工作流程优势

对比旧的命令行工作流程，新的Web界面工作流程有以下优势：

| 特性 | 旧工作流程（命令行） | 新工作流程（Web界面） |
|-----|-------------------|---------------------|
| **自动化程度** | 需要手动运行脚本 | 上传后自动跳转验证页面 |
| **用户体验** | 需要终端操作知识 | 纯图形界面，无需技术背景 |
| **验证界面** | 文本输出，不直观 | 专业对比表，清晰易读 |
| **标记验证** | 需要运行另一个脚本 | 一键点击完成 |
| **错误提示** | 命令行错误信息 | 友好的Web提示 |
| **效率** | 多步骤操作 | 全自动流程 |

---

## 📁 相关文件

- **上传路由**：`app.py` → `/savings/upload`
- **验证页面路由**：`app.py` → `/savings/verify/<statement_id>`
- **标记验证路由**：`app.py` → `/savings/mark_verified/<statement_id>`
- **验证页面模板**：`templates/savings/verify.html`
- **标准文档**：`docs/SAVINGS_ACCOUNT_STATEMENT_STANDARDS.md`

---

## ⏱️ 时间估算

| 账单交易数 | 第一遍验证 | 第二遍验证 | 总时间 |
|-----------|-----------|-----------|--------|
| 10笔以下 | 5分钟 | 3分钟 | 约10分钟 |
| 10-20笔 | 8分钟 | 5分钟 | 约15分钟 |
| 20-50笔 | 15分钟 | 10分钟 | 约30分钟 |
| 50笔以上 | 30分钟 | 20分钟 | 约60分钟 |

*注：建议每验证30分钟休息5分钟，保持注意力集中。*

---

## 🔒 安全性与审计

- **验证时间记录**：系统自动记录`verified_at`时间戳
- **验证人员**：建议在检查清单上签名
- **审计追踪**：所有验证状态变更记录在数据库
- **可逆性**：如发现问题，技术人员可将状态改回`pending`，重新验证

---

## 📞 技术支持

如遇到以下问题，请联系技术团队：
1. 解析器提取数据错误
2. Balance-Change算法计算错误
3. PDF格式无法识别
4. 系统崩溃或数据丢失
5. 验证页面无法显示

---

**版本**：2.0（Web界面自动化版本）  
**创建日期**：2024-10-29  
**更新日期**：2024-10-29  
**文档状态**：正式版  
**重大变更**：完全移除命令行工作流程，改为全自动Web界面工作流程
