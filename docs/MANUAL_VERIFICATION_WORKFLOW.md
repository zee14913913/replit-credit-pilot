# 储蓄账户月结单 - 双重人工验证工作流程

## 📌 核心原则

**零容差、100%准确性**：每一笔交易的序号、日期、描述、金额、类型、余额都必须与PDF原件完全一致，一字不差。

---

## 🔄 完整验证工作流程

### 第一步：上传月结单PDF
```bash
# 上传月结单到系统（手动或通过后台）
# 系统会自动解析PDF，提取交易记录，保存到数据库
```

### 第二步：运行验证系统
```bash
# 获取刚刚保存的账单ID（例如：207）
python3 scripts/verify_savings_statement.py <statement_id>

# 示例：
python3 scripts/verify_savings_statement.py 207
```

**输出示例**：
```
========================================================================================================================
🔍 储蓄账户月结单 - 双重人工验证系统
========================================================================================================================

📋 账单信息：
   账单ID:        207
   客户名称:      Tan Zee Liang (Tan Zee Liang)
   银行账户:      GX Bank ****8388
   账单日期:      2024-06-30
   PDF路径:       customers/Be_rich_TZL/savings/Gx_Bank/2024-06/Gx_Bank_8388_2024-06-30.pdf
   验证状态:      pending
   记录交易数:    11 笔
   系统交易数:    11 笔

========================================================================================================================
📊 交易记录详细对比表（请与PDF原件逐行核对）
========================================================================================================================

  序号 | 交易日期         | 描述（Description）                                              | 类型   |   金额（Amount） |  余额（Balance）
------------------------------------------------------------------------------------------------------------------------
   1 | 1 Jun 2024   | Interest earned 11:59 PM                                     | CR   | RM       0.10 | RM   1,217.92
   2 | 2 Jun 2024   | Interest earned 11:59 PM                                     | CR   | RM       0.10 | RM   1,218.02
   ...
```

### 第三步：第一遍人工验证（逐行对比）

1. **打开PDF原件**：
   - 找到`static/uploads/`目录下的PDF文件
   - 使用PDF阅读器打开（Adobe Reader、Preview等）

2. **准备验证工具**：
   - 纸和笔，用于记录验证结果
   - 对比表（从终端输出复制，或打印出来）

3. **逐行核对（从第1笔开始）**：
   
   | 验证项目 | 检查内容 | 标记 |
   |---------|---------|------|
   | ✅ 序号 | 系统序号1 = PDF第1笔？ | □ |
   | ✅ 日期 | 系统日期是否与PDF完全一致？ | □ |
   | ✅ 描述 | 描述内容是否100%一致（一字不差）？ | □ |
   | ✅ 金额 | 金额数字是否完全相同？ | □ |
   | ✅ 类型 | CR/DR标识是否正确？ | □ |
   | ✅ 余额 | 每笔交易后的余额是否正确？ | □ |

4. **重点检查**：
   - **描述内容**：是否有多字、少字、错字？
   - **特殊字符**：空格、标点符号是否一致？
   - **日期格式**：日期是否与PDF格式匹配？
   - **金额精度**：小数点后2位是否准确？

5. **记录第一遍验证结果**：
   ```
   第1遍验证：
   - 日期：2024-10-29
   - 账单ID：207
   - 验证人：________
   - 结果：□ 通过 / □ 发现问题
   - 问题记录（如有）：
     _______________________________
     _______________________________
   ```

### 第四步：第二遍人工验证（重新核对）

**为什么需要第二遍？**
- 第一遍可能因疲劳、视觉误差而遗漏错误
- 双重验证确保100%准确性
- 符合银行级数据审核标准

**第二遍验证步骤**：
1. **休息5分钟**，让眼睛放松
2. **关闭第一遍的记录**，避免先入为主
3. **重新从第1笔交易开始**，再次逐行对比
4. **特别关注第一遍标记的疑问点**

**记录第二遍验证结果**：
```
第2遍验证：
- 日期：2024-10-29
- 账单ID：207
- 验证人：________
- 结果：□ 通过 / □ 发现问题
- 问题记录（如有）：
  _______________________________
  _______________________________
```

### 第五步：处理验证结果

#### ✅ 如果两遍验证都通过：

```bash
# 标记账单为已验证
python3 scripts/mark_statement_verified.py 207
```

**输出示例**：
```
================================================================================
📌 标记账单为已验证
================================================================================

账单ID:      207
客户:        Tan Zee Liang
银行账户:    GX Bank ****8388
当前状态:    pending

⚠️  确认已完成双重人工验证？(输入 YES 确认): YES

✅ 账单已标记为 verified
✅ 验证时间: 2024-10-29 15:30:45

================================================================================
```

#### ❌ 如果发现问题：

**常见问题类型**：
1. **描述不一致**：系统提取的描述与PDF不同
2. **金额错误**：金额解析错误
3. **余额不连续**：Balance-Change算法计算错误
4. **交易遗漏**：系统漏提取某些交易
5. **交易多余**：系统多提取了不该有的交易

**处理流程**：
1. **记录问题详情**：
   ```
   问题报告：
   - 账单ID：207
   - 问题交易序号：7
   - 问题类型：描述不一致
   - PDF原文："DT PRICE SOLUTION 07:46 PM Duitnow - Account number Transfer"
   - 系统记录："DT PRICE SOLUTION 07:46 PM Duitnow"
   - 发现人：________
   - 日期：2024-10-29
   ```

2. **联系技术人员修复解析器**
3. **删除错误数据，重新解析**：
   ```bash
   # 删除错误的账单记录
   python3 scripts/delete_statement.py 207
   
   # 修复解析器后，重新上传PDF
   # 重新运行验证流程
   ```

---

## 📋 验证检查清单（Checklist）

打印此清单，每次验证时使用：

```
储蓄账户月结单验证检查清单

账单信息：
□ 账单ID：________
□ 客户名称：________
□ 银行账户：________
□ 账单日期：________
□ PDF路径：________

第一遍验证：
□ 已打开PDF原件
□ 已逐行核对序号、日期、描述、金额、类型、余额
□ 已标记疑问点
□ 第1遍结果：□ 通过 / □ 发现问题

第二遍验证：
□ 已休息5分钟
□ 已重新逐行核对
□ 已确认疑问点
□ 第2遍结果：□ 通过 / □ 发现问题

最终确认：
□ 两遍验证都通过
□ 已运行 mark_statement_verified.py
□ 验证状态已更新为 verified
□ 验证人签名：________ 日期：________
```

---

## 🎯 验证标准（Quality Standards）

| 验证项目 | 准确性要求 | 检查方法 |
|---------|-----------|---------|
| **交易总数** | 100% | 系统记录数 = PDF交易总数 |
| **日期格式** | 100% | 逐行对比，格式一致 |
| **描述内容** | 100% | 一字不差，包括空格和标点 |
| **金额数值** | 100% | 小数点后2位完全相同 |
| **CR/DR类型** | 100% | 入账=CR，出账=DR |
| **余额连续性** | 100% | 每笔交易后余额正确 |
| **Total Credit** | 100% | 系统汇总 = PDF汇总 |
| **Total Debit** | 100% | 系统汇总 = PDF汇总 |
| **Closing Balance** | 100% | 期末余额完全一致 |

**不合格标准**：任何一项不符合100%要求，整个账单验证失败。

---

## 📁 相关文件

- **验证脚本**：`scripts/verify_savings_statement.py`
- **标记脚本**：`scripts/mark_statement_verified.py`
- **删除脚本**：`scripts/delete_statement.py`（待创建）
- **标准文档**：`docs/SAVINGS_ACCOUNT_STATEMENT_STANDARDS.md`

---

## ⏱️ 时间估算

| 账单交易数 | 第一遍验证 | 第二遍验证 | 总时间 |
|-----------|-----------|-----------|--------|
| 10笔以下 | 5分钟 | 3分钟 | 约10分钟 |
| 10-20笔 | 8分钟 | 5分钟 | 约15分钟 |
| 20-50笔 | 15分钟 | 10分钟 | 约30分钟 |
| 50笔以上 | 30分钟 | 20分钟 | 约60分钟 |

*注：建议每验证30分钟休息5分钟，保持注意力集中。*

---

## 🔒 安全性与审计

- **验证时间记录**：系统自动记录`verified_at`时间戳
- **验证人员**：建议在检查清单上签名
- **审计追踪**：所有验证状态变更记录在数据库
- **可逆性**：如发现问题，可将状态改回`pending`，重新验证

---

## 📞 技术支持

如遇到以下问题，请联系技术团队：
1. 解析器提取数据错误
2. Balance-Change算法计算错误
3. PDF格式无法识别
4. 系统崩溃或数据丢失

---

**版本**：1.0  
**创建日期**：2024-10-29  
**更新日期**：2024-10-29  
**文档状态**：正式版
